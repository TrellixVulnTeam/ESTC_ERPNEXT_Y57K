{
  "version": 3,
  "sources": ["../../../../../apps/frappe/frappe/public/js/integrations/razorpay.js"],
  "sourcesContent": ["/* HOW-TO\n\nRazorpay Payment\n\n1. \tInclude checkout script in your code\n\t{{ include_script('checkout.bundle.js) }}\n\n2.\tCreate the Order controller in your backend\n\tdef get_razorpay_order(self):\n\t\tcontroller = get_payment_gateway_controller(\"Razorpay\")\n\n\t\tpayment_details = {\n\t\t\t\"amount\": 300,\n\t\t\t...\n\t\t\t\"reference_doctype\": \"Conference Participant\",\n\t\t\t\"reference_docname\": self.name,\n\t\t\t...\n\t\t\t\"receipt\": self.name\n\t\t}\n\n\t\treturn controller.create_order(**payment_details)\n\n3. \tInititate the payment in client using checkout API\n\tfunction make_payment(ticket) {\n\t\tvar options = {\n\t\t\t\"name\": \"<CHECKOUT MODAL TITLE>\",\n\t\t\t\"description\": \"<CHECKOUT MODAL DESCRIPTION>\",\n\t\t\t\"image\": \"<CHECKOUT MODAL LOGO>\",\n\t\t    \"prefill\": {\n\t\t\t\t\"name\": \"<CUSTOMER NAME>\",\n\t\t\t\t\"email\": \"<CUSTOMER EMAIL>\",\n\t\t\t\t\"contact\": \"<CUSTOMER PHONE>\"\n\t\t    },\n\t\t    \"theme\": {\n\t\t\t\t\"color\": \"<MODAL COLOR>\"\n\t\t    },\n\t\t    \"doctype\": \"<REFERENCE DOCTYPE>\",\n\t\t    \"docname\": \"<REFERENCE DOCNAME\"\n\t\t};\n\n\t\trazorpay = new frappe.checkout.razorpay(options)\n\t\trazorpay.on_open = () => {\n\t\t\t<SCRIPT TO RUN WHEN MODAL OPENS>\n\t\t}\n\t\trazorpay.on_success = () => {\n\t\t\t<SCRIPT TO RUN ON PAYMENT SUCCESS>\n\t\t}\n\t\trazorpay.on_fail = () => {\n\t\t\t<SCRIPT TO RUN ON PAYMENT FAILURE>\n\t\t}\n\t\trazorpay.init() // Creates the order and opens the modal\n\t}\n*/\n\nfrappe.provide(\"frappe.checkout\");\n\nfrappe.require('https://checkout.razorpay.com/v1/checkout.js').then(() => {\n\tfrappe.checkout.razorpay = class RazorpayCheckout {\n\t\tconstructor(opts) {\n\t\t\tObject.assign(this, opts);\n\t\t}\n\n\t\tinit() {\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => this.get_key(),\n\t\t\t\t() => this.make_order(),\n\t\t\t\t() => this.prepare_options(),\n\t\t\t\t() => this.setup_handler(),\n\t\t\t\t() => this.show()\n\t\t\t]);\n\t\t}\n\n\t\tshow() {\n\t\t\tthis.razorpay = new Razorpay(this.options);\n\t\t\tthis.razorpay.once('ready', (response) => {\n\t\t\t\tthis.on_open && this.on_open(response);\n\t\t\t})\n\t\t\tthis.razorpay.open();\n\t\t}\n\n\t\tget_key() {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.get_api_key\").then(res => {\n\t\t\t\t\tthis.key = res.message;\n\t\t\t\t\tresolve(true);\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\n\t\tmake_order() {\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.get_order\", {\n\t\t\t\t\tdoctype: this.doctype,\n\t\t\t\t\tdocname: this.docname\n\t\t\t\t}).then(res => {\n\t\t\t\t\tthis.order = res.message;\n\t\t\t\t\tresolve(true);\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\n\t\torder_success(response) {\n\t\t\tfrappe.call(\"frappe.integrations.doctype.razorpay_settings.razorpay_settings.order_payment_success\", {\n\t\t\t\tintegration_request: this.order.integration_request,\n\t\t\t\tparams: {\n\t\t\t\t\trazorpay_payment_id: response.razorpay_payment_id,\n\t\t\t\t\trazorpay_order_id: response.razorpay_order_id,\n\t\t\t\t\trazorpay_signature: response.razorpay_signature\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\torder_fail(response) {\n\t\t\tfrappe.call( \"frappe.integrations.doctype.razorpay_settings.razorpay_settings.order_payment_failure\", {\n\t\t\t\tintegration_request: this.order.integration_request,\n\t\t\t\tparams: response\n\t\t\t})\n\t\t}\n\n\t\tprepare_options() {\n\t\t\tthis.options = {\n\t\t\t\t\"key\": this.key,\n\t\t\t\t\"amount\": this.order.amount_due,\n\t\t\t\t\"currency\": this.order.currency,\n\t\t\t\t\"name\": this.name,\n\t\t\t\t\"description\": this.description,\n\t\t\t\t\"image\": this.image,\n\t\t\t\t\"order_id\": this.order.id,\n\t\t\t\t\"prefill\": this.prefill,\n\t\t\t\t\"theme\": this.theme,\n\t\t\t\t\"modal\": this.modal\n\t\t\t};\n\t\t}\n\n\t\tsetup_handler() {\n\t\t\tthis.options.handler = (response) => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\tthis.order_fail(response);\n\t\t\t\t\tthis.on_fail && this.on_fail(response);\n\t\t\t\t}\n\t\t\t\telse if (response.razorpay_payment_id) {\n\t\t\t\t\tthis.order_success(response);\n\t\t\t\t\tthis.on_success && this.on_success(response);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n"],
  "mappings": "MAsDA,OAAO,QAAQ,iBAAiB,EAEhC,OAAO,QAAQ,8CAA8C,EAAE,KAAK,IAAM,CACzE,OAAO,SAAS,SAAW,KAAuB,CACjD,YAAY,EAAM,CACjB,OAAO,OAAO,KAAM,CAAI,CACzB,CAEA,MAAO,CACN,OAAO,aAAa,CACnB,IAAM,KAAK,QAAQ,EACnB,IAAM,KAAK,WAAW,EACtB,IAAM,KAAK,gBAAgB,EAC3B,IAAM,KAAK,cAAc,EACzB,IAAM,KAAK,KAAK,CACjB,CAAC,CACF,CAEA,MAAO,CACN,KAAK,SAAW,GAAI,UAAS,KAAK,OAAO,EACzC,KAAK,SAAS,KAAK,QAAS,AAAC,GAAa,CACzC,KAAK,SAAW,KAAK,QAAQ,CAAQ,CACtC,CAAC,EACD,KAAK,SAAS,KAAK,CACpB,CAEA,SAAU,CACT,MAAO,IAAI,SAAQ,GAAW,CAC7B,OAAO,KAAK,6EAA6E,EAAE,KAAK,GAAO,CACtG,KAAK,IAAM,EAAI,QACf,EAAQ,EAAI,CACb,CAAC,CACF,CAAC,CACF,CAEA,YAAa,CACZ,MAAO,IAAI,SAAQ,GAAW,CAC7B,OAAO,KAAK,4EAA6E,CACxF,QAAS,KAAK,QACd,QAAS,KAAK,OACf,CAAC,EAAE,KAAK,GAAO,CACd,KAAK,MAAQ,EAAI,QACjB,EAAQ,EAAI,CACb,CAAC,CACF,CAAC,CACF,CAEA,cAAc,EAAU,CACvB,OAAO,KAAK,wFAAyF,CACpG,oBAAqB,KAAK,MAAM,oBAChC,OAAQ,CACP,oBAAqB,EAAS,oBAC9B,kBAAmB,EAAS,kBAC5B,mBAAoB,EAAS,kBAC9B,CACD,CAAC,CACF,CAEA,WAAW,EAAU,CACpB,OAAO,KAAM,wFAAyF,CACrG,oBAAqB,KAAK,MAAM,oBAChC,OAAQ,CACT,CAAC,CACF,CAEA,iBAAkB,CACjB,KAAK,QAAU,CACd,IAAO,KAAK,IACZ,OAAU,KAAK,MAAM,WACrB,SAAY,KAAK,MAAM,SACvB,KAAQ,KAAK,KACb,YAAe,KAAK,YACpB,MAAS,KAAK,MACd,SAAY,KAAK,MAAM,GACvB,QAAW,KAAK,QAChB,MAAS,KAAK,MACd,MAAS,KAAK,KACf,CACD,CAEA,eAAgB,CACf,KAAK,QAAQ,QAAU,AAAC,GAAa,CACpC,AAAI,EAAS,MACZ,MAAK,WAAW,CAAQ,EACxB,KAAK,SAAW,KAAK,QAAQ,CAAQ,GAE7B,EAAS,qBACjB,MAAK,cAAc,CAAQ,EAC3B,KAAK,YAAc,KAAK,WAAW,CAAQ,EAE7C,CACD,CACD,CACD,CAAC",
  "names": []
}
