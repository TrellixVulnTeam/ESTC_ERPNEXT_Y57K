(()=>{var Ii=Object.create;var qt=Object.defineProperty;var Di=Object.getOwnPropertyDescriptor;var Hi=Object.getOwnPropertyNames;var Mi=Object.getPrototypeOf,Ai=Object.prototype.hasOwnProperty;var ut=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var Ni=(o,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Hi(e))!Ai.call(o,r)&&r!==t&&qt(o,r,{get:()=>e[r],enumerable:!(i=Di(e,r))||i.enumerable});return o};var _t=(o,e,t)=>(t=o!=null?Ii(Mi(o)):{},Ni(e||!o||!o.__esModule?qt(t,"default",{value:o,enumerable:!0}):t,o));var Vt=ut((ln,ft)=>{(function(o,e){typeof ft!="undefined"?ft.exports=e():typeof define=="function"&&typeof define.amd=="object"?define(e):this[o]=e()})("Clusterize",function(){function o(l,d,p){return d.addEventListener?d.addEventListener(l,p,!1):d.attachEvent("on"+l,p)}function e(l,d,p){return d.removeEventListener?d.removeEventListener(l,p,!1):d.detachEvent("on"+l,p)}function t(l){return Object.prototype.toString.call(l)==="[object Array]"}function i(l,d){return window.getComputedStyle?window.getComputedStyle(d)[l]:d.currentStyle[l]}var r=function(){for(var l=3,d=document.createElement("b"),p=d.all||[];d.innerHTML="<!--[if gt IE "+ ++l+"]><i><![endif]-->",p[0];);return 4<l?l:document.documentMode}(),s=navigator.platform.toLowerCase().indexOf("mac")+1,a=function(l){if(!(this instanceof a))return new a(l);var d=this,p={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};d.options={};for(var m="rows_in_block blocks_in_cluster show_no_data_row no_data_class no_data_text keep_parity tag callbacks".split(" "),f=0,b;b=m[f];f++)d.options[b]=typeof l[b]!="undefined"&&l[b]!=null?l[b]:p[b];for(p=["scroll","content"],f=0;m=p[f];f++)if(d[m+"_elem"]=l[m+"Id"]?document.getElementById(l[m+"Id"]):l[m+"Elem"],!d[m+"_elem"])throw Error("Error! Could not find "+m+" element");d.content_elem.hasAttribute("tabindex")||d.content_elem.setAttribute("tabindex",0);var y=t(l.rows)?l.rows:d.fetchMarkup(),v={};l=d.scroll_elem.scrollTop,d.insertToDOM(y,v),d.scroll_elem.scrollTop=l;var w=!1,E=0,I=!1,L=function(){s&&(I||(d.content_elem.style.pointerEvents="none"),I=!0,clearTimeout(E),E=setTimeout(function(){d.content_elem.style.pointerEvents="auto",I=!1},50)),w!=(w=d.getClusterNum())&&d.insertToDOM(y,v),d.options.callbacks.scrollingProgress&&d.options.callbacks.scrollingProgress(d.getScrollProgress())},N=0,q=function(){clearTimeout(N),N=setTimeout(d.refresh,100)};o("scroll",d.scroll_elem,L),o("resize",window,q),d.destroy=function(k){e("scroll",d.scroll_elem,L),e("resize",window,q),d.html((k?d.generateEmptyRow():y).join(""))},d.refresh=function(k){(d.getRowsHeight(y)||k)&&d.update(y)},d.update=function(k){y=t(k)?k:[],k=d.scroll_elem.scrollTop,y.length*d.options.item_height<k&&(w=d.scroll_elem.scrollTop=0),d.insertToDOM(y,v),d.scroll_elem.scrollTop=k},d.clear=function(){d.update([])},d.getRowsAmount=function(){return y.length},d.getScrollProgress=function(){return this.options.scroll_top/(y.length*this.options.item_height)*100||0};var j=function(k,B){var P=t(B)?B:[];P.length&&(y=k=="append"?y.concat(P):P.concat(y),d.insertToDOM(y,v))};d.append=function(k){j("append",k)},d.prepend=function(k){j("prepend",k)}};return a.prototype={constructor:a,fetchMarkup:function(){for(var l=[],d=this.getChildNodes(this.content_elem);d.length;)l.push(d.shift().outerHTML);return l},exploreEnvironment:function(l,d){var p=this.options;p.content_tag=this.content_elem.tagName.toLowerCase(),l.length&&(r&&9>=r&&!p.tag&&(p.tag=l[0].match(/<([^>\s/]*)/)[1].toLowerCase()),1>=this.content_elem.children.length&&(d.data=this.html(l[0]+l[0]+l[0])),p.tag||(p.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(l))},getRowsHeight:function(l){var d=this.options,p=d.item_height;if(d.cluster_height=0,l.length){l=this.content_elem.children;var m=l[Math.floor(l.length/2)];return d.item_height=m.offsetHeight,d.tag=="tr"&&i("borderCollapse",this.content_elem)!="collapse"&&(d.item_height+=parseInt(i("borderSpacing",this.content_elem),10)||0),d.tag!="tr"&&(l=parseInt(i("marginTop",m),10)||0,m=parseInt(i("marginBottom",m),10)||0,d.item_height+=Math.max(l,m)),d.block_height=d.item_height*d.rows_in_block,d.rows_in_cluster=d.blocks_in_cluster*d.rows_in_block,d.cluster_height=d.blocks_in_cluster*d.block_height,p!=d.item_height}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Math.floor(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var l=this.options;if(!l.tag||!l.show_no_data_row)return[];var d=document.createElement(l.tag),p=document.createTextNode(l.no_data_text),m;return d.className=l.no_data_class,l.tag=="tr"&&(m=document.createElement("td"),m.colSpan=100,m.appendChild(p)),d.appendChild(m||p),[d.outerHTML]},generate:function(l,d){var b=this.options,y=l.length;if(y<b.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:y?l:this.generateEmptyRow()};var p=Math.max((b.rows_in_cluster-b.rows_in_block)*d,0),m=p+b.rows_in_cluster,f=Math.max(p*b.item_height,0),b=Math.max((y-m)*b.item_height,0),y=[],v=p;for(1>f&&v++;p<m;p++)l[p]&&y.push(l[p]);return{top_offset:f,bottom_offset:b,rows_above:v,rows:y}},renderExtraTag:function(l,d){var p=document.createElement(this.options.tag);return p.className=["clusterize-extra-row","clusterize-"+l].join(" "),d&&(p.style.height=d+"px"),p.outerHTML},insertToDOM:function(l,d){this.options.cluster_height||this.exploreEnvironment(l,d);var p=this.generate(l,this.getClusterNum()),m=p.rows.join(""),f=this.checkChanges("data",m,d),b=this.checkChanges("top",p.top_offset,d),y=this.checkChanges("bottom",p.bottom_offset,d),v=this.options.callbacks,w=[];f||b?(p.top_offset&&(this.options.keep_parity&&w.push(this.renderExtraTag("keep-parity")),w.push(this.renderExtraTag("top-space",p.top_offset))),w.push(m),p.bottom_offset&&w.push(this.renderExtraTag("bottom-space",p.bottom_offset)),v.clusterWillChange&&v.clusterWillChange(),this.html(w.join("")),this.options.content_tag=="ol"&&this.content_elem.setAttribute("start",p.rows_above),v.clusterChanged&&v.clusterChanged()):y&&(this.content_elem.lastChild.style.height=p.bottom_offset+"px")},html:function(l){var d=this.content_elem;if(r&&9>=r&&this.options.tag=="tr"){var p=document.createElement("div");for(p.innerHTML="<table><tbody>"+l+"</tbody></table>";l=d.lastChild;)d.removeChild(l);for(p=this.getChildNodes(p.firstChild.firstChild);p.length;)d.appendChild(p.shift())}else d.innerHTML=l},getChildNodes:function(l){l=l.children;for(var d=[],p=0,m=l.length;p<m;p++)d.push(l[p]);return d},checkChanges:function(l,d,p){var m=d!=p[l];return p[l]=d,m}},a})});var Yt=ut((hn,Be)=>{(function(e){"use strict";typeof define=="function"&&define.amd?define(e):typeof Be!="undefined"&&typeof Be.exports!="undefined"?Be.exports=e():window.Sortable=e()})(function(){"use strict";if(typeof window=="undefined"||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var e,t,i,r,s,a,l,d,p,m,f,b,y,v,w=[],E=!1,I=!1,L=!1,N=[],q,j,k,B,P,re,se,ye,we=!1,Ie=!1,he,De,St,ce,Rt=/\s+/g,G="Sortable"+new Date().getTime(),V=window,D=V.document,ae=V.parseInt,pe=V.setTimeout,$t=V.jQuery||V.Zepto,Qe=V.Polymer,Tt={capture:!1,passive:!1},te=!!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie|iemobile)/i),He=!!navigator.userAgent.match(/Edge/i),kt=He||te?"cssFloat":"float",gi="draggable"in D.createElement("div"),Ze=function(){if(te)return!1;var n=D.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}(),et=!1,tt=!1,oe=Math.abs,Et=Math.min,Me=[],It=function(n,c){var h=H(n),_=ae(h.width),g=ot(n,0,c),C=ot(n,1,c),x=g&&H(g),R=C&&H(C),S=x&&ae(x.marginLeft)+ae(x.marginRight)+z(g).width,T=R&&ae(R.marginLeft)+ae(R.marginRight)+z(C).width;if(h.display==="flex")return h.flexDirection==="column"||h.flexDirection==="column-reverse"?"vertical":"horizontal";if(g&&x.float!=="none"){var M=x.float==="left"?"left":"right";return C&&(R.clear==="both"||R.clear===M)?"vertical":"horizontal"}return g&&(x.display==="block"||x.display==="flex"||x.display==="table"||x.display==="grid"||S>=_&&h[kt]==="none"||C&&h[kt]==="none"&&S+T>_)?"vertical":"horizontal"},mi=function(n,c){for(var h=0;h<N.length;h++)if(!N[h].children.length){var _=z(N[h]),g=N[h][G].options.emptyInsertThreshold,C=n>=_.left-g&&n<=_.right+g,x=c>=_.top-g&&c<=_.bottom+g;if(C&&x)return N[h]}},bi=function(n,c,h,_,g){var C=z(h),x=_==="vertical"?C.left:C.top,R=_==="vertical"?C.right:C.bottom,S=_==="vertical"?n:c;return x<S&&S<R},yi=function(n,c,h){var _=n===e&&ce||z(n),g=c===e&&ce||z(c),C=h==="vertical"?_.left:_.top,x=h==="vertical"?_.right:_.bottom,R=h==="vertical"?_.width:_.height,S=h==="vertical"?g.left:g.top,T=h==="vertical"?g.right:g.bottom,M=h==="vertical"?g.width:g.height;return C===S||x===T||C+R/2===S+M/2},le=function(n,c){if(!n||!n.getBoundingClientRect)return V;var h=n,_=!1;do if(h.clientWidth<h.scrollWidth||h.clientHeight<h.scrollHeight){var g=H(h);if(h.clientWidth<h.scrollWidth&&(g.overflowX=="auto"||g.overflowX=="scroll")||h.clientHeight<h.scrollHeight&&(g.overflowY=="auto"||g.overflowY=="scroll")){if(!h||!h.getBoundingClientRect||h===D.body)return V;if(_||c)return h;_=!0}}while(h=h.parentNode);return V},it=Bt(function(n,c,h,_){if(c.scroll){var g=h?h[G]:window,C=c.scrollSensitivity,x=c.scrollSpeed,R=n.clientX,S=n.clientY,T=window.innerWidth,M=window.innerHeight,A=!1;p!==h&&(Ae(),d=c.scroll,m=c.scrollFn,d===!0&&(d=le(h,!0),p=d));var W=0,U=d;do{var Y=U,Z=z(Y),Ce=Z.top,lt=Z.bottom,xe=Z.left,Oe=Z.right,ue=Z.width,ne=Z.height,ie,Se,ee,Le,je,dt,ht,Fe,Pe;if(Y!==V?(ie=Y.scrollWidth,Se=Y.scrollHeight,ee=H(Y),dt=ue<ie&&(ee.overflowX==="auto"||ee.overflowX==="scroll"),ht=ne<Se&&(ee.overflowY==="auto"||ee.overflowY==="scroll"),Fe=Y.scrollLeft,Pe=Y.scrollTop):(ie=D.documentElement.scrollWidth,Se=D.documentElement.scrollHeight,ee=H(D.documentElement),dt=ue<ie&&(ee.overflowX==="auto"||ee.overflowX==="scroll"||ee.overflowX==="visible"),ht=ne<Se&&(ee.overflowY==="auto"||ee.overflowY==="scroll"||ee.overflowY==="visible"),Fe=D.documentElement.scrollLeft,Pe=D.documentElement.scrollTop),Le=dt&&(oe(Oe-R)<=C&&Fe+ue<ie)-(oe(xe-R)<=C&&!!Fe),je=ht&&(oe(lt-S)<=C&&Pe+ne<Se)-(oe(Ce-S)<=C&&!!Pe),!w[W])for(var We=0;We<=W;We++)w[We]||(w[We]={});(w[W].vx!=Le||w[W].vy!=je||w[W].el!==Y)&&(w[W].el=Y,w[W].vx=Le,w[W].vy=je,clearInterval(w[W].pid),Y&&(Le!=0||je!=0)&&(A=!0,w[W].pid=setInterval(function(){_&&this.layer===0&&X.active._emulateDragOver(!0);var ct=w[this.layer].vy?w[this.layer].vy*x:0,pt=w[this.layer].vx?w[this.layer].vx*x:0;typeof m=="function"&&m.call(g,pt,ct,n,P,w[this.layer].el)!=="continue"||(w[this.layer].el===V?V.scrollTo(V.pageXOffset+pt,V.pageYOffset+ct):(w[this.layer].el.scrollTop+=ct,w[this.layer].el.scrollLeft+=pt))}.bind({layer:W}),24))),W++}while(c.bubbleScroll&&U!==V&&(U=le(U,!1)));E=A}},30),Ae=function(){w.forEach(function(n){clearInterval(n.pid)}),w=[]},Dt=function(n){function c(g,C){return function(x,R,S,T){var M=x.options.group.name&&R.options.group.name&&x.options.group.name===R.options.group.name;if(g==null&&(C||M))return!0;if(g==null||g===!1)return!1;if(C&&g==="clone")return g;if(typeof g=="function")return c(g(x,R,S,T),C)(x,R,S,T);var A=(C?x:R).options.group.name;return g===!0||typeof g=="string"&&g===A||g.join&&g.indexOf(A)>-1}}var h={},_=n.group;(!_||typeof _!="object")&&(_={name:_}),h.name=_.name,h.checkPull=c(_.pull,!0),h.checkPut=c(_.put),h.revertClone=_.revertClone,n.group=h},Ht=function(n){!e||!e.parentNode||e.parentNode[G]&&e.parentNode[G]._computeIsAligned(n)},Mt=function(n,c){for(var h=c;!h[G];)h=h.parentNode;return n===h},At=function(n,c,h){for(var _=n.parentNode;_&&!_[G];)_=_.parentNode;_&&_[G][h](nt(c,{artificialBubble:!0}))},Nt=function(){!Ze&&i&&H(i,"display","none")},Ot=function(){!Ze&&i&&H(i,"display","")};D.addEventListener("click",function(n){if(L)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),L=!1,!1},!0);var rt=function(n){if(n=n.touches?n.touches[0]:n,e){var c=mi(n.clientX,n.clientY);c&&c[G]._onDragOver({clientX:n.clientX,clientY:n.clientY,target:c,rootEl:c})}};O(D,"dragover",rt),O(D,"mousemove",rt),O(D,"touchmove",rt);function X(n,c){if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be HTMLElement, not "+{}.toString.call(n);this.el=n,this.options=c=nt({},c),n[G]=this;var h={group:null,sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0,draggable:/[uo]l/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return It(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(C,x){C.setData("Text",x.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,touchStartThreshold:ae(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:X.supportPointer!==!1&&("PointerEvent"in window||window.navigator&&"msPointerEnabled"in window.navigator),emptyInsertThreshold:5};for(var _ in h)!(_ in c)&&(c[_]=h[_]);Dt(c);for(var g in this)g.charAt(0)==="_"&&typeof this[g]=="function"&&(this[g]=this[g].bind(this));this.nativeDraggable=c.forceFallback?!1:gi,c.supportPointer?O(n,"pointerdown",this._onTapStart):(O(n,"mousedown",this._onTapStart),O(n,"touchstart",this._onTapStart)),this.nativeDraggable&&(O(n,"dragover",this),O(n,"dragenter",this)),N.push(this.el),c.store&&c.store.get&&this.sort(c.store.get(this)||[])}X.prototype={constructor:X,_computeIsAligned:function(n){var c;if(i&&!Ze?(Nt(),c=D.elementFromPoint(n.clientX,n.clientY),Ot()):c=n.target,c=K(c,this.options.draggable,this.el,!1),!tt&&!(!e||e.parentNode!==this.el)){for(var h=this.el.children,_=0;_<h.length;_++)K(h[_],this.options.draggable,this.el,!1)&&h[_]!==c&&(h[_].sortableMouseAligned=bi(n.clientX,n.clientY,h[_],this._getDirection(n,null),this.options));K(c,this.options.draggable,this.el,!0)||(se=null),tt=!0,pe(function(){tt=!1},30)}},_getDirection:function(n,c){return typeof this.options.direction=="function"?this.options.direction.call(this,n,c,e):this.options.direction},_onTapStart:function(n){if(!!n.cancelable){var c=this,h=this.el,_=this.options,g=_.preventOnFilter,C=n.type,x=n.touches&&n.touches[0],R=(x||n).target,S=n.target.shadowRoot&&(n.path&&n.path[0]||n.composedPath&&n.composedPath()[0])||R,T=_.filter,M;if(ki(h),!(te&&!n.artificialBubble&&!Mt(h,R))&&!e&&!(/mousedown|pointerdown/.test(C)&&n.button!==0||_.disabled)&&!S.isContentEditable){if(R=K(R,_.draggable,h,!1),!R){te&&At(h,n,"_onTapStart");return}if(l!==R){if(M=de(R,_.draggable),typeof T=="function"){if(T.call(this,n,R,this)){J(c,S,"filter",R,h,h,M),g&&n.cancelable&&n.preventDefault();return}}else if(T&&(T=T.split(",").some(function(A){if(A=K(S,A.trim(),h,!1),A)return J(c,A,"filter",R,h,h,M),!0}),T)){g&&n.cancelable&&n.preventDefault();return}_.handle&&!K(S,_.handle,h,!1)||this._prepareDragStart(n,x,R,M)}}}},_handleAutoScroll:function(n,c){if(!(!e||!this.options.scroll)){var h=n.clientX,_=n.clientY,g=D.elementFromPoint(h,_),C=this;if(c||He||te){it(n,C.options,g,c);var x=le(g,!0);E&&(!q||h!==j||_!==k)&&(q&&clearInterval(q),q=setInterval(function(){if(!!e){var R=le(D.elementFromPoint(h,_),!0);R!==x&&(x=R,Ae(),it(n,C.options,x,c))}},10),j=h,k=_)}else{if(!C.options.bubbleScroll||le(g,!0)===window){Ae();return}it(n,C.options,le(g,!1),!1)}}},_prepareDragStart:function(n,c,h,_){var g=this,C=g.el,x=g.options,R=C.ownerDocument,S;h&&!e&&h.parentNode===C&&(s=C,e=h,t=e.parentNode,a=e.nextSibling,l=h,y=x.group,f=_,B={target:e,clientX:(c||n).clientX,clientY:(c||n).clientY},this._lastX=(c||n).clientX,this._lastY=(c||n).clientY,e.style["will-change"]="all",e.style.transition="",e.style.transform="",S=function(){g._disableDelayedDrag(),e.draggable=g.nativeDraggable,g._triggerDragStart(n,c),J(g,s,"choose",e,s,s,f),Q(e,x.chosenClass,!0)},x.ignore.split(",").forEach(function(T){Lt(e,T.trim(),Ft)}),x.supportPointer?O(R,"pointerup",g._onDrop):(O(R,"mouseup",g._onDrop),O(R,"touchend",g._onDrop),O(R,"touchcancel",g._onDrop)),x.delay?(O(R,"mouseup",g._disableDelayedDrag),O(R,"touchend",g._disableDelayedDrag),O(R,"touchcancel",g._disableDelayedDrag),O(R,"mousemove",g._delayedDragTouchMoveHandler),O(R,"touchmove",g._delayedDragTouchMoveHandler),x.supportPointer&&O(R,"pointermove",g._delayedDragTouchMoveHandler),g._dragStartTimer=pe(S,x.delay)):S())},_delayedDragTouchMoveHandler:function(n){var c=n.touches?n.touches[0]:n;Et(oe(c.clientX-this._lastX),oe(c.clientY-this._lastY))>=this.options.touchStartThreshold&&this._disableDelayedDrag()},_disableDelayedDrag:function(){var n=this.el.ownerDocument;clearTimeout(this._dragStartTimer),F(n,"mouseup",this._disableDelayedDrag),F(n,"touchend",this._disableDelayedDrag),F(n,"touchcancel",this._disableDelayedDrag),F(n,"mousemove",this._delayedDragTouchMoveHandler),F(n,"touchmove",this._delayedDragTouchMoveHandler),F(n,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(n,c){c=c||(n.pointerType=="touch"?n:null),!this.nativeDraggable||c?this.options.supportPointer?O(D,"pointermove",this._onTouchMove):c?O(D,"touchmove",this._onTouchMove):O(D,"mousemove",this._onTouchMove):(O(e,"dragend",this),O(s,"dragstart",this._onDragStart));try{D.selection?Ne(function(){D.selection.empty()}):window.getSelection().removeAllRanges()}catch(h){}},_dragStarted:function(n){if(I=!1,s&&e){this.nativeDraggable&&(O(D,"dragover",this._handleAutoScroll),O(D,"dragover",Ht));var c=this.options;!n&&Q(e,c.dragClass,!1),Q(e,c.ghostClass,!0),H(e,"transform",""),X.active=this,n&&this._appendGhost(),J(this,s,"start",e,s,s,f)}else this._nulling()},_emulateDragOver:function(n){if(P){if(this._lastX===P.clientX&&this._lastY===P.clientY&&!n)return;this._lastX=P.clientX,this._lastY=P.clientY,Nt();for(var c=D.elementFromPoint(P.clientX,P.clientY),h=c;c&&c.shadowRoot;)c=c.shadowRoot.elementFromPoint(P.clientX,P.clientY),h=c;if(h)do{if(h[G]){var _;if(_=h[G]._onDragOver({clientX:P.clientX,clientY:P.clientY,target:c,rootEl:h}),_&&!this.options.dragoverBubble)break}c=h}while(h=h.parentNode);e.parentNode[G]._computeIsAligned(P),Ot()}},_onTouchMove:function(n){if(B){var c=this.options,h=c.fallbackTolerance,_=c.fallbackOffset,g=n.touches?n.touches[0]:n,C=i&&st(i),x=i&&C&&C.a,R=i&&C&&C.d,S=(g.clientX-B.clientX+_.x)/(x||1),T=(g.clientY-B.clientY+_.y)/(R||1),M=n.touches?"translate3d("+S+"px,"+T+"px,0)":"translate("+S+"px,"+T+"px)";if(!X.active&&!I){if(h&&Et(oe(g.clientX-this._lastX),oe(g.clientY-this._lastY))<h)return;this._onDragStart(n,!0)}this._handleAutoScroll(g,!0),re=!0,P=g,H(i,"webkitTransform",M),H(i,"mozTransform",M),H(i,"msTransform",M),H(i,"transform",M),n.cancelable&&n.preventDefault()}},_appendGhost:function(){if(!i){var n=z(e,this.options.fallbackOnBody?D.body:s,!0),c=H(e),h=this.options;i=e.cloneNode(!0),Q(i,h.ghostClass,!1),Q(i,h.fallbackClass,!0),Q(i,h.dragClass,!0),H(i,"box-sizing","border-box"),H(i,"margin",0),H(i,"top",n.top),H(i,"left",n.left),H(i,"width",n.width),H(i,"height",n.height),H(i,"opacity","0.8"),H(i,"position","fixed"),H(i,"zIndex","100000"),H(i,"pointerEvents","none"),h.fallbackOnBody&&D.body.appendChild(i)||s.appendChild(i)}},_onDragStart:function(n,c){var h=this,_=n.dataTransfer,g=h.options;r=zt(e),r.draggable=!1,r.style["will-change"]="",this._hideClone(),Q(r,h.options.chosenClass,!1),h._cloneId=Ne(function(){h.options.removeCloneOnHide||s.insertBefore(r,e),J(h,s,"clone",e)}),!c&&Q(e,g.dragClass,!0),c?(L=!0,h._loopId=setInterval(h._emulateDragOver,50)):(F(D,"mouseup",h._onDrop),F(D,"touchend",h._onDrop),F(D,"touchcancel",h._onDrop),_&&(_.effectAllowed="move",g.setData&&g.setData.call(h,_,e)),O(D,"drop",h),H(e,"transform","translateZ(0)")),I=!0,h._dragStartId=Ne(h._dragStarted.bind(h,c)),O(D,"selectstart",h)},_onDragOver:function(n){var c=this.el,h=n.target,_,g,C,x=this.options,R=x.group,S=X.active,T=y===R,M=x.sort,A=this;if(et||te&&!n.rootEl&&!n.artificialBubble&&!Mt(c,h))return;function W(){return S&&(Q(e,v?v.options.ghostClass:S.options.ghostClass,!1),Q(e,x.ghostClass,!0)),v!==A&&A!==X.active?v=A:A===X.active&&(v=null),(h===e&&!e.animated||h===c&&!h.animated)&&(se=null),!x.dragoverBubble&&!n.rootEl&&h!==D&&(A._handleAutoScroll(n),e.parentNode[G]._computeIsAligned(n)),!x.dragoverBubble&&n.stopPropagation&&n.stopPropagation(),!0}function U(){J(A,s,"change",h,c,s,f,de(e,x.draggable),n)}if(n.preventDefault!==void 0&&n.cancelable&&n.preventDefault(),re=!0,h=K(h,x.draggable,c,!0),!!K(n.target,null,e,!0)||h.animated)return W();if(h!==e&&(L=!1),S&&!x.disabled&&(T?M||(C=!s.contains(e)):v===this||(this.lastPutMode=y.checkPull(this,S,e,n))&&R.checkPut(this,S,e,n))){var Y=this._getDirection(n,h);if(_=z(e),C)return this._hideClone(),t=s,a?s.insertBefore(e,a):s.appendChild(e),W();if(c.children.length===0||c.children[0]===i||xi(n,Y,c)&&!e.animated){if(c.children.length!==0&&c.children[0]!==i&&c===n.target&&(h=Pt(c)),h&&(g=z(h)),T?S._hideClone():S._showClone(this),jt(s,c,e,_,h,g,n,!!h)!==!1)return c.appendChild(e),t=c,ce=null,U(),this._animate(_,e),h&&this._animate(g,h),W()}else if(h&&h!==e&&h.parentNode===c){var Z=0,Ce,lt=h.sortableMouseAligned,xe=e.parentNode!==c,Oe=Ei(h,Y==="vertical"?"top":"left");if(se!==h&&(he=null,Ce=z(h)[Y==="vertical"?"top":"left"],we=!1),yi(e,h,Y)&&lt||xe||Oe||x.invertSwap||he==="insert"||he==="swap"?(he!=="swap"&&(Ie=x.invertSwap||xe||E||Oe),Z=Si(n,h,Y,x.swapThreshold,x.invertedSwapThreshold==null?x.swapThreshold:x.invertedSwapThreshold,Ie,se===h),he="swap"):(Z=Ri(h,x),he="insert"),Z===0)return W();ce=null,se=h,ye=Z,g=z(h);var ue=h.nextElementSibling,ne=!1;ne=Z===1;var ie=jt(s,c,e,_,h,g,n,ne);if(ie!==!1)return(ie===1||ie===-1)&&(ne=ie===1),et=!0,pe(Ci,30),T?S._hideClone():S._showClone(this),ne&&!ue?c.appendChild(e):h.parentNode.insertBefore(e,ne?ue:h),t=e.parentNode,Ce!==void 0&&!Ie&&(De=oe(Ce-z(h)[Y==="vertical"?"top":"left"])),U(),!xe&&this._animate(g,h),this._animate(_,e),W()}if(c.contains(e))return W()}return te&&!n.rootEl&&At(c,n,"_onDragOver"),!1},_animate:function(n,c){var h=this.options.animation;if(h){var _=z(c);if(c===e&&(ce=_),n.nodeType===1&&(n=z(n)),n.left+n.width/2!==_.left+_.width/2||n.top+n.height/2!==_.top+_.height/2){var g=st(this.el),C=g&&g.a,x=g&&g.d;H(c,"transition","none"),H(c,"transform","translate3d("+(n.left-_.left)/(C||1)+"px,"+(n.top-_.top)/(x||1)+"px,0)"),St=c.offsetWidth,H(c,"transition","transform "+h+"ms"+(this.options.easing?" "+this.options.easing:"")),H(c,"transform","translate3d(0,0,0)")}typeof c.animated=="number"&&clearTimeout(c.animated),c.animated=pe(function(){H(c,"transition",""),H(c,"transform",""),c.animated=!1},h)}},_offUpEvents:function(){var n=this.el.ownerDocument;F(D,"touchmove",this._onTouchMove),F(D,"pointermove",this._onTouchMove),F(n,"mouseup",this._onDrop),F(n,"touchend",this._onDrop),F(n,"pointerup",this._onDrop),F(n,"touchcancel",this._onDrop),F(D,"selectstart",this)},_onDrop:function(n){var c=this.el,h=this.options;I=!1,E=!1,Ie=!1,we=!1,clearInterval(this._loopId),clearInterval(q),Ae(),Ti(),clearTimeout(this._dragStartTimer),at(this._cloneId),at(this._dragStartId),F(D,"mousemove",this._onTouchMove),this.nativeDraggable&&(F(D,"drop",this),F(c,"dragstart",this._onDragStart),F(D,"dragover",this._handleAutoScroll),F(D,"dragover",Ht)),this._offUpEvents(),n&&(re&&(n.cancelable&&n.preventDefault(),!h.dropBubble&&n.stopPropagation()),i&&i.parentNode&&i.parentNode.removeChild(i),(s===t||v&&v.lastPutMode!=="clone")&&r&&r.parentNode&&r.parentNode.removeChild(r),e&&(this.nativeDraggable&&F(e,"dragend",this),Ft(e),e.style["will-change"]="",Q(e,v?v.options.ghostClass:this.options.ghostClass,!1),Q(e,this.options.chosenClass,!1),J(this,s,"unchoose",e,t,s,f,null,n),s!==t?(b=de(e,h.draggable),b>=0&&(J(null,t,"add",e,t,s,f,b,n),J(this,s,"remove",e,t,s,f,b,n),J(null,t,"sort",e,t,s,f,b,n),J(this,s,"sort",e,t,s,f,b,n)),v&&v.save()):e.nextSibling!==a&&(b=de(e,h.draggable),b>=0&&(J(this,s,"update",e,t,s,f,b,n),J(this,s,"sort",e,t,s,f,b,n))),X.active&&((b==null||b===-1)&&(b=f),J(this,s,"end",e,t,s,f,b,n),this.save()))),this._nulling()},_nulling:function(){s=e=t=i=a=r=l=d=p=w.length=q=j=k=B=P=re=b=f=se=ye=St=ce=v=y=X.active=null,Me.forEach(function(n){n.checked=!0}),Me.length=0},handleEvent:function(n){switch(n.type){case"drop":case"dragend":this._onDrop(n);break;case"dragenter":case"dragover":e&&(this._onDragOver(n),vi(n));break;case"selectstart":n.preventDefault();break}},toArray:function(){for(var n=[],c,h=this.el.children,_=0,g=h.length,C=this.options;_<g;_++)c=h[_],K(c,C.draggable,this.el,!1)&&n.push(c.getAttribute(C.dataIdAttr)||$i(c));return n},sort:function(n){var c={},h=this.el;this.toArray().forEach(function(_,g){var C=h.children[g];K(C,this.options.draggable,h,!1)&&(c[_]=C)},this),n.forEach(function(_){c[_]&&(h.removeChild(c[_]),h.appendChild(c[_]))})},save:function(){var n=this.options.store;n&&n.set&&n.set(this)},closest:function(n,c){return K(n,c||this.options.draggable,this.el,!1)},option:function(n,c){var h=this.options;if(c===void 0)return h[n];h[n]=c,n==="group"&&Dt(h)},destroy:function(){var n=this.el;n[G]=null,F(n,"mousedown",this._onTapStart),F(n,"touchstart",this._onTapStart),F(n,"pointerdown",this._onTapStart),this.nativeDraggable&&(F(n,"dragover",this),F(n,"dragenter",this)),Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(c){c.removeAttribute("draggable")}),this._onDrop(),N.splice(N.indexOf(this.el),1),this.el=n=null},_hideClone:function(){r.cloneHidden||(H(r,"display","none"),r.cloneHidden=!0,r.parentNode&&this.options.removeCloneOnHide&&r.parentNode.removeChild(r))},_showClone:function(n){if(n.lastPutMode!=="clone"){this._hideClone();return}r.cloneHidden&&(s.contains(e)&&!this.options.group.revertClone?s.insertBefore(r,e):a?s.insertBefore(r,a):s.appendChild(r),this.options.group.revertClone&&this._animate(e,r),H(r,"display",""),r.cloneHidden=!1)}};function K(n,c,h,_){if(n){h=h||D;do{if(c!=null&&(c[0]===">"&&n.parentNode===h&&Wt(n,c.substring(1))||Wt(n,c))||_&&n===h)return n;if(n===h)break}while(n=wi(n))}return null}function wi(n){return n.host&&n!==D&&n.host.nodeType?n.host:n.parentNode}function vi(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move"),n.cancelable&&n.preventDefault()}function O(n,c,h){n.addEventListener(c,h,Tt)}function F(n,c,h){n.removeEventListener(c,h,Tt)}function Q(n,c,h){if(n&&c)if(n.classList)n.classList[h?"add":"remove"](c);else{var _=(" "+n.className+" ").replace(Rt," ").replace(" "+c+" "," ");n.className=(_+(h?" "+c:"")).replace(Rt," ")}}function H(n,c,h){var _=n&&n.style;if(_){if(h===void 0)return D.defaultView&&D.defaultView.getComputedStyle?h=D.defaultView.getComputedStyle(n,""):n.currentStyle&&(h=n.currentStyle),c===void 0?h:h[c];!(c in _)&&c.indexOf("webkit")===-1&&(c="-webkit-"+c),_[c]=h+(typeof h=="string"?"":"px")}}function st(n){var c="";do{var h=H(n,"transform");h&&h!=="none"&&(c=h+" "+c)}while(n=n.parentNode);if(window.DOMMatrix)return new DOMMatrix(c);if(window.WebKitCSSMatrix)return new WebKitCSSMatrix(c);if(window.CSSMatrix)return new CSSMatrix(c)}function Lt(n,c,h){if(n){var _=n.getElementsByTagName(c),g=0,C=_.length;if(h)for(;g<C;g++)h(_[g],g);return _}return[]}function J(n,c,h,_,g,C,x,R,S){n=n||c[G];var T,M=n.options,A="on"+h.charAt(0).toUpperCase()+h.substr(1);window.CustomEvent&&!te&&!He?T=new CustomEvent(h,{bubbles:!0,cancelable:!0}):(T=D.createEvent("Event"),T.initEvent(h,!0,!0)),T.to=g||c,T.from=C||c,T.item=_||c,T.clone=r,T.oldIndex=x,T.newIndex=R,T.originalEvent=S,c&&c.dispatchEvent(T),M[A]&&M[A].call(n,T)}function jt(n,c,h,_,g,C,x,R){var S,T=n[G],M=T.options.onMove,A;return window.CustomEvent&&!te&&!He?S=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(S=D.createEvent("Event"),S.initEvent("move",!0,!0)),S.to=c,S.from=n,S.dragged=h,S.draggedRect=_,S.related=g||c,S.relatedRect=C||z(c),S.willInsertAfter=R,S.originalEvent=x,n.dispatchEvent(S),M&&(A=M.call(T,S,x)),A}function Ft(n){n.draggable=!1}function Ci(){et=!1}function ot(n,c,h){for(var _=0,g=0,C=n.children;g<C.length;){if(C[g].style.display!=="none"&&C[g]!==i&&C[g]!==e&&K(C[g],h.draggable,n,!1)){if(_===c)return C[g];_++}g++}return null}function Pt(n){for(var c=n.lastElementChild;(c===i||c.style.display==="none")&&(c=c.previousElementSibling,!!c););return c||null}function xi(n,c,h){var _=z(Pt(h)),g=c==="vertical"?n.clientY:n.clientX,C=c==="vertical"?n.clientX:n.clientY,x=c==="vertical"?_.bottom:_.right,R=c==="vertical"?_.left:_.top,S=c==="vertical"?_.right:_.bottom,T=10;return c==="vertical"?C>S+T||C<=S&&g>x&&C>=R:g>x&&C>R||g<=x&&C>S+T}function Si(n,c,h,_,g,C,x){var R=z(c),S=h==="vertical"?n.clientY:n.clientX,T=h==="vertical"?R.height:R.width,M=h==="vertical"?R.top:R.left,A=h==="vertical"?R.bottom:R.right,W=z(e),U=!1;if(!C){if(x&&De<T*_)if(!we&&(ye===1?S>M+T*g/2:S<A-T*g/2)&&(we=!0),we)U=!0;else{var Y=h==="vertical"?W.top:W.left,Z=h==="vertical"?W.bottom:W.right;if(ye===1?S<M+De:S>A-De)return ye*-1}else if(S>M+T*(1-_)/2&&S<A-T*(1-_)/2)return S>M+T/2?-1:1}return U=U||C,U&&(S<M+T*g/2||S>A-T*g/2)?S>M+T/2?1:-1:0}function Ri(n,c){var h=de(e,c.draggable),_=de(n,c.draggable);return h<_?1:-1}function $i(n){for(var c=n.tagName+n.className+n.src+n.href+n.textContent,h=c.length,_=0;h--;)_+=c.charCodeAt(h);return _.toString(36)}function de(n,c){var h=0;if(!n||!n.parentNode)return-1;for(;n&&(n=n.previousElementSibling);)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==r&&h++;return h}function Wt(n,c){if(n)try{if(n.matches)return n.matches(c);if(n.msMatchesSelector)return n.msMatchesSelector(c);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(c)}catch(h){return!1}return!1}var ve;function Bt(n,c){return function(){if(!ve){var h=arguments,_=this;ve=pe(function(){h.length===1?n.call(_,h[0]):n.apply(_,h),ve=void 0},c)}}}function Ti(){clearTimeout(ve),ve=void 0}function nt(n,c){if(n&&c)for(var h in c)c.hasOwnProperty(h)&&(n[h]=c[h]);return n}function zt(n){return Qe&&Qe.dom?Qe.dom(n).cloneNode(!0):$t?$t(n).clone(!0)[0]:n.cloneNode(!0)}function ki(n){Me.length=0;for(var c=n.getElementsByTagName("input"),h=c.length;h--;){var _=c[h];_.checked&&Me.push(_)}}function Ne(n){return pe(n,0)}function at(n){return clearTimeout(n)}function z(n,c,h){if(!(!n.getBoundingClientRect&&n!==V)){var _,g,C,x,R,S,T;if(n!==V?(_=n.getBoundingClientRect(),g=_.top,C=_.left,x=_.bottom,R=_.right,S=_.height,T=_.width):(g=0,C=0,x=window.innerHeight,R=window.innerWidth,S=window.innerHeight,T=window.innerWidth),h&&n!==V){if(c=c||n.parentNode,!te)do if(c&&c.getBoundingClientRect&&H(c,"transform")!=="none"){var M=c.getBoundingClientRect();g-=M.top+ae(H(c,"border-top-width")),C-=M.left+ae(H(c,"border-left-width")),x=g+_.height,R=C+_.width;break}while(c=c.parentNode);var A=st(n),W=A&&A.a,U=A&&A.d;A&&(g/=U,C/=W,T/=W,S/=U,x=g+S,R=C+T)}return{top:g,left:C,bottom:x,right:R,width:T,height:S}}}function Ei(n,c){for(var h=le(h,!0),_=z(n)[c];h;){var g=z(h)[c],C;if(c==="top"||c==="left"?C=_>=g:C=_<=g,!C)return!0;if(h===V)break;h=le(h,!1)}return!1}return O(D,"touchmove",function(n){(X.active||I)&&n.cancelable&&n.preventDefault()}),X.utils={on:O,off:F,css:H,find:Lt,is:function(n,c){return!!K(n,c,n,!1)},extend:nt,throttle:Bt,closest:K,toggleClass:Q,clone:zt,index:de,nextTick:Ne,cancelNextTick:at,detectDirection:It,getChild:ot},X.create=function(n,c){return new X(n,c)},X.version="1.8.3",X})});var Ct=ut((cn,_i)=>{"use strict";function Oi(o){return o&&typeof o=="object"&&"default"in o?o.default:o}var Li=Oi(Yt());function u(o,e){return typeof o=="string"?(e||document).querySelector(o):o||null}u.each=(o,e)=>typeof o=="string"?Array.from((e||document).querySelectorAll(o)):o||null;u.create=(o,e)=>{let t=document.createElement(o);for(let i in e){let r=e[i];if(i==="inside")u(r).appendChild(t);else if(i==="around"){let s=u(r);s.parentNode.insertBefore(t,s),t.appendChild(s)}else i==="styles"?typeof r=="object"&&Object.keys(r).map(s=>{t.style[s]=r[s]}):i in t?t[i]=r:t.setAttribute(i,r)}return t};u.on=(o,e,t,i)=>{i?u.delegate(o,e,t,i):(i=t,u.bind(o,e,i))};u.off=(o,e,t)=>{o.removeEventListener(e,t)};u.bind=(o,e,t)=>{e.split(/\s+/).forEach(function(i){o.addEventListener(i,t)})};u.delegate=(o,e,t,i)=>{o.addEventListener(e,function(r){let s=r.target.closest(t);s&&(r.delegatedTarget=s,i.call(this,r,s))})};u.unbind=(o,e)=>{if(o)for(let t in e){let i=e[t];t.split(/\s+/).forEach(function(r){o.removeEventListener(r,i)})}};u.fire=(o,e,t)=>{let i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0);for(let r in t)i[r]=t[r];return o.dispatchEvent(i)};u.data=(o,e)=>{if(!e)return o.dataset;for(let t in e)o.dataset[t]=e[t]};u.style=(o,e)=>{if(typeof e=="string")return u.getStyle(o,e);Array.isArray(o)||(o=[o]),o.map(t=>{for(let i in e)t.style[i]=e[i]})};u.removeStyle=(o,e)=>{Array.isArray(o)||(o=[o]),Array.isArray(e)||(e=[e]),o.map(t=>{for(let i of e)t.style[i]=""})};u.getStyle=(o,e)=>{if(!e)return getComputedStyle(o);let t=getComputedStyle(o)[e];return["width","height"].includes(e)&&(t=parseFloat(t)),t};u.closest=(o,e)=>e?e.matches(o)?e:u.closest(o,e.parentNode):null;u.inViewport=(o,e)=>{let{top:t,left:i,bottom:r,right:s}=o.getBoundingClientRect(),{top:a,left:l,bottom:d,right:p}=e.getBoundingClientRect();return t>=a&&i>=l&&r<=d&&s<=p};u.scrollTop=function(e,t){requestAnimationFrame(()=>{e.scrollTop=t})};u.scrollbarSize=function(){return u.scrollBarSizeValue||(u.scrollBarSizeValue=ji()),u.scrollBarSizeValue};function ji(){let o=document.createElement("div");u.style(o,{width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"}),document.body.appendChild(o);let e=o.offsetWidth-o.clientWidth;return document.body.removeChild(o),e}u.hasVerticalOverflow=function(o){return o.scrollHeight>o.offsetHeight+10};u.hasHorizontalOverflow=function(o){return o.scrollWidth>o.offsetWidth+10};u.measureTextWidth=function(o){let e=document.createElement("div");return e.style.position="absolute",e.style.visibility="hidden",e.style.height="auto",e.style.width="auto",e.style.whiteSpace="nowrap",e.innerText=o,document.body.appendChild(e),e.clientWidth+1};function Fi(o){var e=typeof o;return o!=null&&(e=="object"||e=="function")}var _e=Fi,ze=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function qe(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function Pi(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Wi(o,e){return e={exports:{}},o(e,e.exports),e.exports}var Bi=typeof ze=="object"&&ze&&ze.Object===Object&&ze,zi=Bi,qi=typeof self=="object"&&self&&self.Object===Object&&self,Vi=zi||qi||Function("return this")(),Ee=Vi,Yi=function(){return Ee.Date.now()},gt=Yi,Xi=Ee.Symbol,Xe=Xi,ei=Object.prototype,Gi=ei.hasOwnProperty,Ui=ei.toString,Re=Xe?Xe.toStringTag:void 0;function Ki(o){var e=Gi.call(o,Re),t=o[Re];try{o[Re]=void 0}catch(r){}var i=Ui.call(o);return e?o[Re]=t:delete o[Re],i}var Ji=Ki,Qi=Object.prototype,Zi=Qi.toString;function er(o){return Zi.call(o)}var tr=er,ir="[object Null]",rr="[object Undefined]",Xt=Xe?Xe.toStringTag:void 0;function sr(o){return o==null?o===void 0?rr:ir:Xt&&Xt in Object(o)?Ji(o):tr(o)}var ti=sr;function or(o){return o!=null&&typeof o=="object"}var nr=or,ar="[object Symbol]";function lr(o){return typeof o=="symbol"||nr(o)&&ti(o)==ar}var dr=lr,Gt=0/0,hr=/^\s+|\s+$/g,cr=/^[-+]0x[0-9a-f]+$/i,pr=/^0b[01]+$/i,ur=/^0o[0-7]+$/i,_r=parseInt;function fr(o){if(typeof o=="number")return o;if(dr(o))return Gt;if(_e(o)){var e=typeof o.valueOf=="function"?o.valueOf():o;o=_e(e)?e+"":e}if(typeof o!="string")return o===0?o:+o;o=o.replace(hr,"");var t=pr.test(o);return t||ur.test(o)?_r(o.slice(2),t?2:8):cr.test(o)?Gt:+o}var Ut=fr,gr="Expected a function",mr=Math.max,br=Math.min;function yr(o,e,t){var i,r,s,a,l,d,p=0,m=!1,f=!1,b=!0;if(typeof o!="function")throw new TypeError(gr);e=Ut(e)||0,_e(t)&&(m=!!t.leading,f="maxWait"in t,s=f?mr(Ut(t.maxWait)||0,e):s,b="trailing"in t?!!t.trailing:b);function y(k){var B=i,P=r;return i=r=void 0,p=k,a=o.apply(P,B),a}function v(k){return p=k,l=setTimeout(I,e),m?y(k):a}function w(k){var B=k-d,P=k-p,re=e-B;return f?br(re,s-P):re}function E(k){var B=k-d,P=k-p;return d===void 0||B>=e||B<0||f&&P>=s}function I(){var k=gt();if(E(k))return L(k);l=setTimeout(I,w(k))}function L(k){return l=void 0,b&&i?y(k):(i=r=void 0,a)}function N(){l!==void 0&&clearTimeout(l),p=0,i=d=r=l=void 0}function q(){return l===void 0?a:L(gt())}function j(){var k=gt(),B=E(k);if(i=arguments,r=this,d=k,B){if(l===void 0)return v(d);if(f)return l=setTimeout(I,e),y(d)}return l===void 0&&(l=setTimeout(I,e)),a}return j.cancel=N,j.flush=q,j}var ii=yr,wr="Expected a function";function vr(o,e,t){var i=!0,r=!0;if(typeof o!="function")throw new TypeError(wr);return _e(t)&&(i="leading"in t?!!t.leading:i,r="trailing"in t?!!t.trailing:r),ii(o,e,{leading:i,maxWait:e,trailing:r})}var Cr=vr,xr="[object AsyncFunction]",Sr="[object Function]",Rr="[object GeneratorFunction]",$r="[object Proxy]";function Tr(o){if(!_e(o))return!1;var e=ti(o);return e==Sr||e==Rr||e==xr||e==$r}var kr=Tr,Er=Ee["__core-js_shared__"],mt=Er,Kt=function(){var o=/[^.]+$/.exec(mt&&mt.keys&&mt.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}();function Ir(o){return!!Kt&&Kt in o}var Dr=Ir,Hr=Function.prototype,Mr=Hr.toString;function Ar(o){if(o!=null){try{return Mr.call(o)}catch(e){}try{return o+""}catch(e){}}return""}var Nr=Ar,Or=/[\\^$.*+?()[\]{}|]/g,Lr=/^\[object .+?Constructor\]$/,jr=Function.prototype,Fr=Object.prototype,Pr=jr.toString,Wr=Fr.hasOwnProperty,Br=RegExp("^"+Pr.call(Wr).replace(Or,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function zr(o){if(!_e(o)||Dr(o))return!1;var e=kr(o)?Br:Lr;return e.test(Nr(o))}var qr=zr;function Vr(o,e){return o==null?void 0:o[e]}var Yr=Vr;function Xr(o,e){var t=Yr(o,e);return qr(t)?t:void 0}var vt=Xr,Gr=vt(Object,"create"),ke=Gr;function Ur(){this.__data__=ke?ke(null):{},this.size=0}var Kr=Ur;function Jr(o){var e=this.has(o)&&delete this.__data__[o];return this.size-=e?1:0,e}var Qr=Jr,Zr="__lodash_hash_undefined__",es=Object.prototype,ts=es.hasOwnProperty;function is(o){var e=this.__data__;if(ke){var t=e[o];return t===Zr?void 0:t}return ts.call(e,o)?e[o]:void 0}var rs=is,ss=Object.prototype,os=ss.hasOwnProperty;function ns(o){var e=this.__data__;return ke?e[o]!==void 0:os.call(e,o)}var as=ns,ls="__lodash_hash_undefined__";function ds(o,e){var t=this.__data__;return this.size+=this.has(o)?0:1,t[o]=ke&&e===void 0?ls:e,this}var hs=ds;function fe(o){var e=-1,t=o==null?0:o.length;for(this.clear();++e<t;){var i=o[e];this.set(i[0],i[1])}}fe.prototype.clear=Kr;fe.prototype.delete=Qr;fe.prototype.get=rs;fe.prototype.has=as;fe.prototype.set=hs;var Jt=fe;function cs(){this.__data__=[],this.size=0}var ps=cs;function us(o,e){return o===e||o!==o&&e!==e}var _s=us;function fs(o,e){for(var t=o.length;t--;)if(_s(o[t][0],e))return t;return-1}var Ue=fs,gs=Array.prototype,ms=gs.splice;function bs(o){var e=this.__data__,t=Ue(e,o);if(t<0)return!1;var i=e.length-1;return t==i?e.pop():ms.call(e,t,1),--this.size,!0}var ys=bs;function ws(o){var e=this.__data__,t=Ue(e,o);return t<0?void 0:e[t][1]}var vs=ws;function Cs(o){return Ue(this.__data__,o)>-1}var xs=Cs;function Ss(o,e){var t=this.__data__,i=Ue(t,o);return i<0?(++this.size,t.push([o,e])):t[i][1]=e,this}var Rs=Ss;function ge(o){var e=-1,t=o==null?0:o.length;for(this.clear();++e<t;){var i=o[e];this.set(i[0],i[1])}}ge.prototype.clear=ps;ge.prototype.delete=ys;ge.prototype.get=vs;ge.prototype.has=xs;ge.prototype.set=Rs;var $s=ge,Ts=vt(Ee,"Map"),ks=Ts;function Es(){this.size=0,this.__data__={hash:new Jt,map:new(ks||$s),string:new Jt}}var Is=Es;function Ds(o){var e=typeof o;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?o!=="__proto__":o===null}var Hs=Ds;function Ms(o,e){var t=o.__data__;return Hs(e)?t[typeof e=="string"?"string":"hash"]:t.map}var Ke=Ms;function As(o){var e=Ke(this,o).delete(o);return this.size-=e?1:0,e}var Ns=As;function Os(o){return Ke(this,o).get(o)}var Ls=Os;function js(o){return Ke(this,o).has(o)}var Fs=js;function Ps(o,e){var t=Ke(this,o),i=t.size;return t.set(o,e),this.size+=t.size==i?0:1,this}var Ws=Ps;function me(o){var e=-1,t=o==null?0:o.length;for(this.clear();++e<t;){var i=o[e];this.set(i[0],i[1])}}me.prototype.clear=Is;me.prototype.delete=Ns;me.prototype.get=Ls;me.prototype.has=Fs;me.prototype.set=Ws;var Bs=me,zs="__lodash_hash_undefined__";function qs(o){return this.__data__.set(o,zs),this}var Vs=qs;function Ys(o){return this.__data__.has(o)}var Xs=Ys;function Ge(o){var e=-1,t=o==null?0:o.length;for(this.__data__=new Bs;++e<t;)this.add(o[e])}Ge.prototype.add=Ge.prototype.push=Vs;Ge.prototype.has=Xs;var Gs=Ge;function Us(o,e,t,i){for(var r=o.length,s=t+(i?1:-1);i?s--:++s<r;)if(e(o[s],s,o))return s;return-1}var Ks=Us;function Js(o){return o!==o}var Qs=Js;function Zs(o,e,t){for(var i=t-1,r=o.length;++i<r;)if(o[i]===e)return i;return-1}var eo=Zs;function to(o,e,t){return e===e?eo(o,e,t):Ks(o,Qs,t)}var io=to;function ro(o,e){var t=o==null?0:o.length;return!!t&&io(o,e,0)>-1}var so=ro;function oo(o,e,t){for(var i=-1,r=o==null?0:o.length;++i<r;)if(t(e,o[i]))return!0;return!1}var no=oo;function ao(o,e){return o.has(e)}var lo=ao,ho=vt(Ee,"Set"),bt=ho;function co(){}var po=co;function uo(o){var e=-1,t=Array(o.size);return o.forEach(function(i){t[++e]=i}),t}var ri=uo,_o=1/0,fo=bt&&1/ri(new bt([,-0]))[1]==_o?function(o){return new bt(o)}:po,go=fo,mo=200;function bo(o,e,t){var i=-1,r=so,s=o.length,a=!0,l=[],d=l;if(t)a=!1,r=no;else if(s>=mo){var p=e?null:go(o);if(p)return ri(p);a=!1,r=lo,d=new Gs}else d=e?[]:l;e:for(;++i<s;){var m=o[i],f=e?e(m):m;if(m=t||m!==0?m:0,a&&f===f){for(var b=d.length;b--;)if(d[b]===f)continue e;e&&d.push(f),l.push(m)}else r(d,f,t)||(d!==l&&d.push(f),l.push(m))}return l}var yo=bo;function wo(o){return o&&o.length?yo(o):[]}var vo=wo;function si(o){return o.replace(/([A-Z])/g,e=>`-${e[0].toLowerCase()}`)}function yt(o){return Object.keys(o).map(t=>{let i=si(t),r=o[t];return r===void 0?"":`data-${i}="${r}" `}).join("").trim()}function Qt(o){var e=document.createElement("textarea");e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=o,document.body.appendChild(e),e.select();try{document.execCommand("copy")}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(e)}function Co(o){return!isNaN(o)}var oi=Cr,xo=ii;function Te(o,e=null){return(...t)=>new Promise(i=>{setTimeout(()=>{let s=o.apply(e,t);i(s)})})}function Je(o,e,t){let i=t.reduce((r,s)=>(r[s]={get(){return e[s]}},r),{});Object.defineProperties(o,i)}function So(o){return o!==void 0||o!==null}function Ro(o){return!So(o)}function Ve(o){return!isNaN(o)}function $o(o){return Array.isArray(o)?o:[o]}function Zt(o){return vo(o)}function $e(o,e){return o-e}function To(o){return o.replace(/<[^>]*>/g,"")}function ko(o,e){return o&&(Object.keys(e).forEach(t=>{let i=new RegExp(`{(${t})}`,"g");o=o.replace(i,e[t])}),o)}var ni=class{constructor(e){this.options=e,this.sortRows=Te(this.sortRows,this),this.switchColumn=Te(this.switchColumn,this),this.removeColumn=Te(this.removeColumn,this),this.options.filterRows=Te(this.options.filterRows,this)}init(e,t){e||(e=this.options.data),t&&(this.options.columns=t),this.data=e,this.rowCount=0,this.columns=[],this.rows=[],this.prepareColumns(),this.prepareRows(),this.prepareTreeRows(),this.prepareRowView(),this.prepareNumericColumns()}get currentSort(){return this.columns.find(t=>t.sortOrder!=="none")||{colIndex:-1,sortOrder:"none"}}prepareColumns(){this.columns=[],this.validateColumns(),this.prepareDefaultColumns(),this.prepareHeader()}prepareDefaultColumns(){if(this.options.checkboxColumn&&!this.hasColumnById("_checkbox")){let e={id:"_checkbox",content:this.getCheckboxHTML(),editable:!1,resizable:!1,sortable:!1,focusable:!1,dropdown:!1,width:32};this.columns.push(e)}if(this.options.serialNoColumn&&!this.hasColumnById("_rowIndex")){let e={id:"_rowIndex",content:"",align:"center",editable:!1,resizable:!1,focusable:!1,dropdown:!1};this.columns.push(e)}}prepareHeader(){let e=this.columns.concat(this.options.columns),t={isHeader:1,editable:!0,sortable:!0,resizable:!0,focusable:!0,dropdown:!0,width:null,format:i=>i==null?"":i+""};this.columns=e.map((i,r)=>this.prepareCell(i,r)).map(i=>Object.assign({},t,i)).map(i=>(i.content=i.content||i.name||"",i.id=i.id||i.content,i))}prepareCell(e,t){let i={content:"",sortOrder:"none",colIndex:t,column:this.columns[t]};return e!==null&&typeof e=="object"?Object.assign(i,e):i.content=e,i}prepareNumericColumns(){let e=this.getRow(0);!e||(this.columns=this.columns.map((t,i)=>{let r=e[i].content;return!t.align&&Co(r)&&(t.align="right"),t}))}prepareRows(){this.validateData(this.data),this.rows=this.data.map((e,t)=>{let i=this._getNextRowCount(),r=[],s={rowIndex:i};if(Array.isArray(e))for(this.options.checkboxColumn&&r.push(this.getCheckboxHTML()),this.options.serialNoColumn&&r.push(i+1+""),r=r.concat(e);r.length<this.columns.length;)r.push("");else{for(let a of this.columns)a.id==="_checkbox"?r.push(this.getCheckboxHTML()):a.id==="_rowIndex"?r.push(i+1+""):r.push(e[a.id]);s.indent=e.indent||0}return this.prepareRow(r,s)})}prepareTreeRows(){this.rows.forEach((e,t)=>{if(Ve(e.meta.indent)){let i=this.getRow(t+1);e.meta.isLeaf=!i||Ro(i.meta.indent)||i.meta.indent<=e.meta.indent,e.meta.isTreeNodeClose=!1}})}prepareRowView(){this.rowViewOrder=this.rows.map(e=>e.meta.rowIndex)}prepareRow(e,t){let i={rowIndex:t.rowIndex,indent:t.indent};return e=e.map((r,s)=>this.prepareCell(r,s)).map(r=>Object.assign({},i,r)),e.meta=t,e}validateColumns(){let e=this.options.columns;if(!Array.isArray(e))throw new Ye("`columns` must be an array");e.forEach((t,i)=>{if(typeof t!="string"&&typeof t!="object")throw new Ye(`column "${i}" must be a string or an object`)})}validateData(e){if(Array.isArray(e)&&(e.length===0||Array.isArray(e[0])||typeof e[0]=="object"))return!0;throw new Ye("`data` must be an array of arrays or objects")}appendRows(e){this.validateData(e),this.rows.push(...this.prepareRows(e))}sortRows(e,t="none"){e=+e,this.getColumns().map(i=>{i.colIndex===e?i.sortOrder=t:i.sortOrder="none"}),this._sortRows(e,t)}_sortRows(e,t){if(this.currentSort.colIndex===e&&(this.currentSort.sortOrder==="asc"&&t==="desc"||this.currentSort.sortOrder==="desc"&&t==="asc")){this.reverseArray(this.rowViewOrder),this.currentSort.sortOrder=t;return}if(this.rowViewOrder.sort((i,r)=>{let s=i,a=r,l=this.getCell(e,i).content,d=this.getCell(e,r).content;if(l=l==null?"":l,d=d==null?"":d,t==="none")return s-a;if(t==="asc"){if(l<d)return-1;if(l>d)return 1;if(l===d)return 0}else if(t==="desc"){if(l<d)return 1;if(l>d)return-1;if(l===d)return 0}return 0}),this.hasColumnById("_rowIndex")){let i=this.getColumnIndexById("_rowIndex");this.rows.forEach((r,s)=>{let a=this.rowViewOrder.indexOf(s),l=r[i];l.content=a+1+""})}}reverseArray(e){let t=null,i=null,r=e.length;for(t=0,i=r-1;t<i;t+=1,i-=1){let s=e[t];e[t]=e[i],e[i]=s}}switchColumn(e,t){let i=this.columns[e];this.columns[e]=this.columns[t],this.columns[t]=i,this.columns[e].colIndex=e,this.columns[t].colIndex=t,this.rows.forEach(r=>{let s=Object.assign({},r[e],{colIndex:t}),a=Object.assign({},r[t],{colIndex:e});r[t]=s,r[e]=a})}removeColumn(e){e=+e;let t=r=>r.colIndex!==e,i=(r,s)=>Object.assign({},r,{colIndex:s});this.columns=this.columns.filter(t).map(i),this.rows.forEach(r=>{r.splice(e,1),r.forEach((s,a)=>{s.colIndex=a})})}updateRow(e,t){e.length<this.columns.length&&(this.hasColumnById("_rowIndex")&&(e=[t+1+""].concat(e)),this.hasColumnById("_checkbox")&&(e=['<input type="checkbox" />'].concat(e)));let i=this.prepareRow(e,{rowIndex:t}),r=this.rows.findIndex(s=>s[0].rowIndex===t);return this.rows[r]=i,i}updateCell(e,t,i){let r;typeof e=="object"&&(r=e,e=r.colIndex,t=r.rowIndex,i=r),r=this.getCell(e,t);for(let s in i){let a=i[s];a!==void 0&&(r[s]=a)}return r}updateColumn(e,t){let i=this.getColumn(e);for(let r in t){let s=t[r];s!==void 0&&(i[r]=s)}return i}filterRows(e){return this.options.filterRows(this.rows,e).then(t=>(t||(t=this.getAllRowIndices()),t.then||(t=Promise.resolve(t)),t.then(i=>(this._filteredRows=i,{rowsToHide:this.getAllRowIndices().filter(s=>!i.includes(s)),rowsToShow:i}))))}getFilteredRowIndices(){return this._filteredRows||this.getAllRowIndices()}getAllRowIndices(){return this.rows.map(e=>e.meta.rowIndex)}getRowCount(){return this.rowCount}_getNextRowCount(){let e=this.rowCount;return this.rowCount++,e}getRows(e,t){return this.rows.slice(e,t)}getRowsForView(e,t){return this.rowViewOrder.map(r=>this.rows[r]).slice(e,t)}getColumns(e){let t=this.columns;return e&&(t=t.slice(this.getStandardColumnCount())),t}getStandardColumnCount(){return this.options.checkboxColumn&&this.options.serialNoColumn?2:this.options.checkboxColumn||this.options.serialNoColumn?1:0}getColumnCount(e){let t=this.columns.length;return e&&(t=t-this.getStandardColumnCount()),t}getColumn(e){return e=+e,e<0&&(e=this.columns.length+e),this.columns.find(t=>t.colIndex===e)}getColumnById(e){return this.columns.find(t=>t.id===e)}getRow(e){return e=+e,this.rows[e]}getCell(e,t){return t=+t,e=+e,this.getRow(t)[e]}getChildren(e){e=+e;let t=this.getRow(e).meta.indent,i=[];for(let r=e+1;r<this.rowCount;r++){let s=this.getRow(r);if(!isNaN(s.meta.indent)&&(s.meta.indent>t&&i.push(r),s.meta.indent===t))break}return i}getImmediateChildren(e){e=+e;let t=this.getRow(e).meta.indent,i=[],r=t+1;for(let s=e+1;s<this.rowCount;s++){let a=this.getRow(s);if(!(isNaN(a.meta.indent)||a.meta.indent>r)&&(a.meta.indent===r&&i.push(s),a.meta.indent===t))break}return i}get(){return{columns:this.columns,rows:this.rows}}getData(e){return this.data[e]}hasColumn(e){return Boolean(this.columns.find(t=>t.content===e))}hasColumnById(e){return Boolean(this.columns.find(t=>t.id===e))}getColumnIndex(e){return this.columns.findIndex(t=>t.content===e)}getColumnIndexById(e){return this.columns.findIndex(t=>t.id===e)}getCheckboxHTML(){return'<input type="checkbox" />'}},Ye=class extends TypeError{},wt={chevronDown:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>',chevronRight:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>'},ai=class{constructor(e){this.instance=e,Je(this,this.instance,["wrapper","options","style","header","bodyScrollable","columnmanager","rowmanager","datamanager","keyboard"]),this.bindEvents()}bindEvents(){this.bindFocusCell(),this.bindEditCell(),this.bindKeyboardSelection(),this.bindCopyCellContents(),this.bindMouseEvents(),this.bindTreeEvents()}bindFocusCell(){this.bindKeyboardNav()}bindEditCell(){this.$editingCell=null,u.on(this.bodyScrollable,"dblclick",".dt-cell",(e,t)=>{this.activateEditing(t)}),this.keyboard.on("enter",()=>{this.$focusedCell&&!this.$editingCell?this.activateEditing(this.$focusedCell):this.$editingCell&&this.deactivateEditing()})}bindKeyboardNav(){let e=t=>{if(!this.$focusedCell||this.$editingCell)return!1;let i=this.$focusedCell,{rowIndex:r,colIndex:s}=u.data(i);return t==="left"?i=this.getLeftMostCell$(r):t==="right"?i=this.getRightMostCell$(r):t==="up"?i=this.getTopMostCell$(s):t==="down"&&(i=this.getBottomMostCell$(s)),this.focusCell(i),!0};["left","right","up","down","tab","shift+tab"].map(t=>this.keyboard.on(t,()=>this.focusCellInDirection(t))),["left","right","up","down"].map(t=>this.keyboard.on(`ctrl+${t}`,()=>e(t))),this.keyboard.on("esc",()=>{this.deactivateEditing(!1),this.columnmanager.toggleFilter(!1)}),this.options.inlineFilters&&(this.keyboard.on("ctrl+f",t=>{let i=u.closest(".dt-cell",t.target),{colIndex:r}=u.data(i);return this.activateFilter(r),!0}),u.on(this.header,"focusin",".dt-filter",()=>{this.unfocusCell(this.$focusedCell)}))}bindKeyboardSelection(){let e=t=>{let i=this.getSelectionCursor();return t==="left"?i=this.getLeftCell$(i):t==="right"?i=this.getRightCell$(i):t==="up"?i=this.getAboveCell$(i):t==="down"&&(i=this.getBelowCell$(i)),i};["left","right","up","down"].map(t=>this.keyboard.on(`shift+${t}`,()=>this.selectArea(e(t))))}bindCopyCellContents(){this.keyboard.on("ctrl+c",()=>{let e=this.copyCellContents(this.$focusedCell,this.$selectionCursor),t=this.instance.translate("{count} cells copied",{count:e});e&&this.instance.showToastMessage(t,2)}),this.options.pasteFromClipboard&&this.keyboard.on("ctrl+v",e=>(this.instance.pasteTarget.focus(),setTimeout(()=>{let t=this.instance.pasteTarget.value;this.instance.pasteTarget.value="",this.pasteContentInCell(t)},10),!1))}bindMouseEvents(){let e=null;u.on(this.bodyScrollable,"mousedown",".dt-cell",i=>{e=!0,this.focusCell(u(i.delegatedTarget))}),u.on(this.bodyScrollable,"mouseup",()=>{e=!1});let t=i=>{!e||this.selectArea(u(i.delegatedTarget))};u.on(this.bodyScrollable,"mousemove",".dt-cell",oi(t,50))}bindTreeEvents(){u.on(this.bodyScrollable,"click",".dt-tree-node__toggle",(e,t)=>{let i=u.closest(".dt-cell",t),{rowIndex:r}=u.data(i);i.classList.contains("dt-cell--tree-close")?this.rowmanager.openSingleNode(r):this.rowmanager.closeSingleNode(r)})}focusCell(e,{skipClearSelection:t=0,skipDOMFocus:i=0,skipScrollToCell:r=0}={}){if(!e||e===this.$editingCell)return;let{colIndex:s,isHeader:a}=u.data(e);a||this.columnmanager.getColumn(s).focusable===!1||(r||this.scrollToCell(e),this.deactivateEditing(),t||this.clearSelection(),this.$focusedCell&&this.$focusedCell.classList.remove("dt-cell--focus"),this.$focusedCell=e,e.classList.add("dt-cell--focus"),i||e.focus(),this.highlightRowColumnHeader(e))}unfocusCell(e){!e||(e.classList.remove("dt-cell--focus"),this.$focusedCell=null,this.lastHeaders&&this.lastHeaders.forEach(t=>t&&t.classList.remove("dt-cell--highlight")))}highlightRowColumnHeader(e){let{colIndex:t,rowIndex:i}=u.data(e),r=this.datamanager.getColumnIndexById("_rowIndex"),s=`.dt-cell--header-${t}`,a=`.dt-cell--${r}-${i}`;this.lastHeaders&&this.lastHeaders.forEach(p=>p&&p.classList.remove("dt-cell--highlight"));let l=u(s,this.wrapper),d=u(a,this.wrapper);this.lastHeaders=[l,d],this.lastHeaders.forEach(p=>p&&p.classList.add("dt-cell--highlight"))}selectAreaOnClusterChanged(){if(!(this.$focusedCell&&this.$selectionCursor))return;let{colIndex:e,rowIndex:t}=u.data(this.$selectionCursor),i=this.getCell$(e,t);if(!i||i===this.$selectionCursor)return;let r=u.data(this.$focusedCell);this.$focusedCell=this.getCell$(r.colIndex,r.rowIndex),this.selectArea(i)}focusCellOnClusterChanged(){if(!this.$focusedCell)return;let{colIndex:e,rowIndex:t}=u.data(this.$focusedCell),i=this.getCell$(e,t);!i||this.focusCell(i,{skipClearSelection:1,skipDOMFocus:1,skipScrollToCell:1})}selectArea(e){!this.$focusedCell||this._selectArea(this.$focusedCell,e)&&(this.$selectionCursor=e)}_selectArea(e,t){if(e===t)return!1;let i=this.getCellsInRange(e,t);return i?(this.clearSelection(),this._selectedCells=i.map(r=>this.getCell$(...r)),requestAnimationFrame(()=>{this._selectedCells.map(r=>r.classList.add("dt-cell--highlight"))}),!0):!1}getCellsInRange(e,t){let i,r,s,a;if(typeof e=="number")[i,r,s,a]=arguments;else if(typeof e=="object"){if(!(e&&t))return!1;let f=u.data(e),b=u.data(t);i=+f.colIndex,r=+f.rowIndex,s=+b.colIndex,a=+b.rowIndex}if(r>a&&([r,a]=[a,r]),i>s&&([i,s]=[s,i]),this.isStandardCell(i)||this.isStandardCell(s))return!1;let l=[],d=i,p=r,m=[];for(;p<=a;)m.push(p),p+=1;return m.map(f=>{for(;d<=s;)l.push([d,f]),d++;d=i}),l}clearSelection(){(this._selectedCells||[]).forEach(e=>e.classList.remove("dt-cell--highlight")),this._selectedCells=[],this.$selectionCursor=null}getSelectionCursor(){return this.$selectionCursor||this.$focusedCell}activateEditing(e){this.focusCell(e);let{rowIndex:t,colIndex:i}=u.data(e),r=this.columnmanager.getColumn(i);if(r&&(r.editable===!1||r.focusable===!1))return;let s=this.getCell(i,t);if(s&&s.editable===!1)return;if(this.$editingCell){let{_rowIndex:d,_colIndex:p}=u.data(this.$editingCell);if(t===d&&i===p)return}this.$editingCell=e,e.classList.add("dt-cell--editing");let a=u(".dt-cell__edit",e);a.innerHTML="";let l=this.getEditor(i,t,s.content,a);l&&(this.currentCellEditor=l,l.initValue(s.content,t,r))}deactivateEditing(e=!0){e&&this.submitEditing(),this.$focusedCell&&this.$focusedCell.focus(),this.$editingCell&&(this.$editingCell.classList.remove("dt-cell--editing"),this.$editingCell=null)}getEditor(e,t,i,r){let s=this.datamanager.getColumn(e),a=this.datamanager.getRow(t),l=this.datamanager.getData(t),d=this.options.getEditor?this.options.getEditor(e,t,i,r,s,a,l):this.getDefaultEditor(r);return d===!1?!1:(d===void 0&&(d=this.getDefaultEditor(r)),d)}getDefaultEditor(e){let t=u.create("input",{class:"dt-input",type:"text",inside:e});return{initValue(i){t.focus(),t.value=i},getValue(){return t.value},setValue(i){t.value=i}}}submitEditing(){let e=Promise.resolve();if(!this.$editingCell)return e;let t=this.$editingCell,{rowIndex:i,colIndex:r}=u.data(t),s=this.datamanager.getColumn(r);if(t){let a=this.currentCellEditor;if(a){let l=a.getValue();l.then||(l=Promise.resolve(l)),e=l.then(d=>{let p=a.setValue(d,i,s),m=this.getCell(r,i).content;return this.updateCell(r,i,d),t.focus(),p&&p.then&&p.catch(f=>{console.log(f),this.updateCell(r,i,m)}),p})}}return this.currentCellEditor=null,e}copyCellContents(e,t){if(!t&&e){let{colIndex:a,rowIndex:l}=u.data(e),d=this.getCell(a,l);return Qt(d.content),1}let i=this.getCellsInRange(e,t);if(!i)return 0;let r=i.map(a=>this.getCell(...a)).reduce((a,l)=>{let d=l.rowIndex;return a[d]=a[d]||[],a[d].push(l.content),a},[]),s=r.map(a=>a.join("	")).join(`
`);return Qt(s),r.reduce((a,l)=>a+l.length,0)}pasteContentInCell(e){if(!this.$focusedCell)return;let t=e.split(`
`).map(a=>a.split("	")).filter(a=>a.length&&a.every(l=>l)),{colIndex:i,rowIndex:r}=u.data(this.$focusedCell),s={colIndex:+i,rowIndex:+r};t.forEach((a,l)=>{let d=l+s.rowIndex;a.forEach((p,m)=>{let f=m+s.colIndex;this.updateCell(f,d,p)})})}activateFilter(e){this.columnmanager.toggleFilter(),this.columnmanager.focusFilter(e),this.columnmanager.isFilterShown||this.$focusedCell&&this.$focusedCell.focus()}updateCell(e,t,i){let r=this.datamanager.updateCell(e,t,{content:i});this.refreshCell(r)}refreshCell(e){let t=u(this.selector(e.colIndex,e.rowIndex),this.bodyScrollable);t.innerHTML=this.getCellContent(e)}toggleTreeButton(e,t){let i=this.columnmanager.getFirstColumnIndex(),r=this.getCell$(i,e);r&&r.classList[t?"remove":"add"]("dt-cell--tree-close")}isStandardCell(e){return e<this.columnmanager.getFirstColumnIndex()}focusCellInDirection(e){if(this.$focusedCell)this.$editingCell&&["tab","shift+tab"].includes(e)&&this.deactivateEditing();else return!1;let t=this.$focusedCell;if(e==="left"||e==="shift+tab"?t=this.getLeftCell$(t):e==="right"||e==="tab"?t=this.getRightCell$(t):e==="up"?t=this.getAboveCell$(t):e==="down"&&(t=this.getBelowCell$(t)),!t)return!1;let{colIndex:i}=u.data(t);if(!this.columnmanager.getColumn(i).focusable){let s=this.$focusedCell;this.unfocusCell(s),this.$focusedCell=t;let a=this.focusCellInDirection(e);return a||this.focusCell(s),a}return this.focusCell(t),!0}getCell$(e,t){return u(this.selector(e,t),this.bodyScrollable)}getAboveCell$(e){let{colIndex:t}=u.data(e),i=e.parentElement.previousElementSibling;for(;i&&i.classList.contains("dt-row--hide");)i=i.previousElementSibling;return i?u(`.dt-cell--col-${t}`,i):e}getBelowCell$(e){let{colIndex:t}=u.data(e),i=e.parentElement.nextElementSibling;for(;i&&i.classList.contains("dt-row--hide");)i=i.nextElementSibling;return i?u(`.dt-cell--col-${t}`,i):e}getLeftCell$(e){return e.previousElementSibling}getRightCell$(e){return e.nextElementSibling}getLeftMostCell$(e){return this.getCell$(this.columnmanager.getFirstColumnIndex(),e)}getRightMostCell$(e){return this.getCell$(this.columnmanager.getLastColumnIndex(),e)}getTopMostCell$(e){return this.getCell$(e,this.rowmanager.getFirstRowIndex())}getBottomMostCell$(e){return this.getCell$(e,this.rowmanager.getLastRowIndex())}getCell(e,t){return this.instance.datamanager.getCell(e,t)}getRowHeight(){return u.style(u(".dt-row",this.bodyScrollable),"height")}scrollToCell(e){if(u.inViewport(e,this.bodyScrollable))return!1;let{rowIndex:t}=u.data(e);return this.rowmanager.scrollToRow(t),!1}getRowCountPerPage(){return Math.ceil(this.instance.getViewportHeight()/this.getRowHeight())}getCellHTML(e){let{rowIndex:t,colIndex:i,isHeader:r,isFilter:s,isTotalRow:a}=e,l=yt({rowIndex:t,colIndex:i,isHeader:r,isFilter:s,isTotalRow:a}),d=this.datamanager.getRow(t),p=!(r||s||a);return`
            <div class="${["dt-cell","dt-cell--col-"+i,p?`dt-cell--${i}-${t}`:"",p?"dt-cell--row-"+t:"",r?"dt-cell--header":"",r?`dt-cell--header-${i}`:"",s?"dt-cell--filter":"",p&&d&&d.meta.isTreeNodeClose?"dt-cell--tree-close":""].join(" ")}" ${l} tabindex="0">
                ${this.getCellContent(e)}
            </div>
        `}getCellContent(e){let{isHeader:t,isFilter:i,colIndex:r}=e,a=!t&&e.editable!==!1?this.getEditCellHTML(r):"",d=t&&e.sortable!==!1?`<span class="sort-indicator">
                ${this.options.sortIndicator[e.sortOrder]}
            </span>`:"",m=t&&e.resizable!==!1?'<span class="dt-cell__resize-handle"></span>':"",b=t&&e.dropdown!==!1?this.columnmanager.getDropdownHTML():"",y=e.format||e.column&&e.column.format||null,v;if(t||i||!y)v=e.content;else{let E=this.datamanager.getRow(e.rowIndex),I=this.datamanager.getData(e.rowIndex);v=y(e.content,E,e.column,I)}if(e.html=v,this.options.treeView&&!(t||i)&&e.indent!==void 0){let E=this.datamanager.getRow(e.rowIndex+1),I=E&&E.meta.indent>e.indent,L=20,N="px";if(this.datamanager.getColumnIndexById("_rowIndex")+1===e.colIndex){let j=(e.indent||0)*L,k=I?`<span class="dt-tree-node__toggle" style="left: ${j-L}${N}">
                        <span class="icon-open">${wt.chevronDown}</span>
                        <span class="icon-close">${wt.chevronRight}</span>
                    </span>`:"";v=`<span class="dt-tree-node" style="padding-left: ${j}${N}">
                    ${k}
                    <span>${v}</span>
                </span>`}}return`
            <div class="${["dt-cell__content",t?`dt-cell__content--header-${r}`:`dt-cell__content--col-${r}`].join(" ")}">
                ${v}
                ${d}
                ${m}
                ${b}
            </div>
            ${a}
        `}getEditCellHTML(e){return`<div class="dt-cell__edit dt-cell__edit--col-${e}"></div>`}selector(e,t){return`.dt-cell--${e}-${t}`}},li=class{constructor(e){this.instance=e,Je(this,this.instance,["options","fireEvent","header","datamanager","cellmanager","style","wrapper","rowmanager","bodyScrollable","bodyRenderer"]),this.bindEvents()}renderHeader(){this.header.innerHTML="<div></div>",this.refreshHeader()}refreshHeader(){let e=this.datamanager.getColumns();u("div",this.header).innerHTML=this.getHeaderHTML(e),this.$filterRow=u(".dt-row-filter",this.header),this.$filterRow&&u.style(this.$filterRow,{display:"none"}),this.$columnMap=[],this.bindMoveColumn()}getHeaderHTML(e){let t=this.rowmanager.getRowHTML(e,{isHeader:1});return this.options.inlineFilters&&(t+=this.rowmanager.getRowHTML(e,{isFilter:1})),t}bindEvents(){this.bindDropdown(),this.bindResizeColumn(),this.bindPerfectColumnWidth(),this.bindFilter()}bindDropdown(){let e=".dt-dropdown__toggle",t=".dt-dropdown__list";this.instance.dropdownContainer.innerHTML=this.getDropdownListHTML(),this.$dropdownList=this.instance.dropdownContainer.firstElementChild,u.on(this.header,"click",e,a=>{this.openDropdown(a)});let i=a=>{let l=[e,e+" *",t,t+" *"].join(",");a.target.matches(l)||s()};u.on(document.body,"click",i),document.addEventListener("scroll",s,!0),this.instance.on("onDestroy",()=>{u.off(document.body,"click",i),u.off(document,"scroll",s)}),u.on(this.$dropdownList,"click",".dt-dropdown__list-item",(a,l)=>{if(!this._dropdownActiveColIndex)return;let d=this.options.headerDropdown,{index:p}=u.data(l),m=this._dropdownActiveColIndex,f=d[p].action;f&&f.call(this.instance,this.getColumn(m)),this.hideDropdown()});let r=this;function s(a){r.hideDropdown()}this.hideDropdown()}openDropdown(e){this._dropdownWidth||(u.style(this.$dropdownList,{display:""}),this._dropdownWidth=u.style(this.$dropdownList,"width")),u.style(this.$dropdownList,{display:"",left:e.clientX-this._dropdownWidth+4+"px",top:e.clientY+4+"px"});let t=u.closest(".dt-cell",e.target),{colIndex:i}=u.data(t);this._dropdownActiveColIndex=i}hideDropdown(){u.style(this.$dropdownList,{display:"none"}),this._dropdownActiveColIndex=null}bindResizeColumn(){let e=!1,t,i,r;u.on(this.header,"mousedown",".dt-cell .dt-cell__resize-handle",(l,d)=>{document.body.classList.add("dt-resize"),t=d.parentNode.parentNode;let{colIndex:m}=u.data(t),f=this.getColumn(m);f&&f.resizable===!1||(e=!0,i=u.style(u(".dt-cell__content",t),"width"),r=l.pageX)});let s=l=>{if(document.body.classList.remove("dt-resize"),!t)return;e=!1;let{colIndex:d}=u.data(t);this.setColumnWidth(d),this.style.setBodyStyle(),t=null};u.on(document.body,"mouseup",s),this.instance.on("onDestroy",()=>{u.off(document.body,"mouseup",s)});let a=l=>{if(!e)return;let d=l.pageX-r;this.options.direction==="rtl"&&(d=-1*d);let p=i+d,{colIndex:m}=u.data(t);this.options.minimumColumnWidth>p||(this.datamanager.updateColumn(m,{width:p}),this.setColumnHeaderWidth(m))};u.on(document.body,"mousemove",a),this.instance.on("onDestroy",()=>{u.off(document.body,"mousemove",a)})}bindPerfectColumnWidth(){u.on(this.header,"dblclick",".dt-cell .dt-cell__resize-handle",(e,t)=>{let i=t.parentNode.parentNode,{colIndex:r}=u.data(i),s=this.bodyRenderer.visibleRows.map(w=>w[r]).reduce((w,E)=>w.content.length>E.content.length?w:E),a=this.cellmanager.getCellHTML(s),l=document.createElement("div");l.innerHTML=a;let d=l.querySelector(".dt-cell__content").textContent,{borderLeftWidth:p,borderRightWidth:m,paddingLeft:f,paddingRight:b}=u.getStyle(this.bodyScrollable.querySelector(".dt-cell__content")),y=[p,m,f,b].map(parseFloat).reduce((w,E)=>w+E),v=u.measureTextWidth(d)+y;this.datamanager.updateColumn(r,{width:v}),this.setColumnHeaderWidth(r),this.setColumnWidth(r)})}bindMoveColumn(){if(this.options.disableReorderColumn)return;let e=u(".dt-row",this.header);this.sortable=Li.create(e,{onEnd:t=>{let{oldIndex:i,newIndex:r}=t,s=t.item,{colIndex:a}=u.data(s);+a!==r&&this.switchColumn(i,r)},preventOnFilter:!1,filter:".dt-cell__resize-handle, .dt-dropdown",chosenClass:"dt-cell--dragging",animation:150})}sortColumn(e,t){this.instance.freeze(),this.sortRows(e,t).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>this.instance.unfreeze()).then(()=>{this.fireEvent("onSortColumn",this.getColumn(e))})}removeColumn(e){let t=this.getColumn(e);this.instance.freeze(),this.datamanager.removeColumn(e).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>this.instance.unfreeze()).then(()=>{this.fireEvent("onRemoveColumn",t)})}switchColumn(e,t){this.instance.freeze(),this.datamanager.switchColumn(e,t).then(()=>(this.refreshHeader(),this.rowmanager.refreshRows())).then(()=>{this.setColumnWidth(e),this.setColumnWidth(t),this.instance.unfreeze()}).then(()=>{this.fireEvent("onSwitchColumn",this.getColumn(e),this.getColumn(t))})}toggleFilter(e){if(!this.options.inlineFilters)return;let t;e===void 0?t=!this.isFilterShown:t=e,t?u.style(this.$filterRow,{display:""}):u.style(this.$filterRow,{display:"none"}),this.isFilterShown=t,this.style.setBodyStyle()}focusFilter(e){if(!this.isFilterShown)return;u(`.dt-cell--col-${e} .dt-filter`,this.$filterRow).focus()}bindFilter(){if(!this.options.inlineFilters)return;let e=t=>{this.applyFilter(this.getAppliedFilters())};u.on(this.header,"keydown",".dt-filter",xo(e,300))}applyFilter(e){this.datamanager.filterRows(e).then(({rowsToShow:t})=>{this.rowmanager.showRows(t)})}getAppliedFilters(){let e={};return u.each(".dt-filter",this.header).map(t=>{let i=t.value;i&&(e[t.dataset.colIndex]=i)}),e}applyDefaultSortOrder(){let e=this.getColumns().filter(t=>t.sortOrder!=="none");if(e.length===1){let t=e[0];this.sortColumn(t.colIndex,t.sortOrder)}}sortRows(e,t){return this.datamanager.sortRows(e,t)}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}setColumnWidth(e,t){e=+e;let i=t||this.getColumn(e).width,r=[`.dt-cell__content--col-${e}`,`.dt-cell__edit--col-${e}`].join(", "),s={width:i+"px"};this.style.setStyle(r,s)}setColumnHeaderWidth(e){e=+e,this.$columnMap=this.$columnMap||[];let t=`.dt-cell__content--header-${e}`,{width:i}=this.getColumn(e),r=this.$columnMap[e];r||(r=this.header.querySelector(t),this.$columnMap[e]=r),r.style.width=i+"px"}getColumnMinWidth(e){return e=+e,this.getColumn(e).minWidth||24}getFirstColumnIndex(){return this.datamanager.getColumnIndexById("_rowIndex")+1}getHeaderCell$(e){return u(`.dt-cell--header-${e}`,this.header)}getLastColumnIndex(){return this.datamanager.getColumnCount()-1}getDropdownHTML(){let{dropdownButton:e}=this.options;return`
            <div class="dt-dropdown">
                <div class="dt-dropdown__toggle">${e}</div>
            </div>
      `}getDropdownListHTML(){let{headerDropdown:e}=this.options;return`
            <div class="dt-dropdown__list">
            ${e.map((t,i)=>`
                <div class="dt-dropdown__list-item" data-index="${i}">${t.label}</div>
            `).join("")}
            </div>
        `}},di=class{constructor(e){this.instance=e,Je(this,this.instance,["options","fireEvent","wrapper","bodyScrollable","bodyRenderer","style"]),this.bindEvents(),this.refreshRows=Te(this.refreshRows,this)}get datamanager(){return this.instance.datamanager}get cellmanager(){return this.instance.cellmanager}bindEvents(){this.bindCheckbox()}bindCheckbox(){!this.options.checkboxColumn||(this.checkMap=[],u.on(this.wrapper,"click",'.dt-cell--col-0 [type="checkbox"]',(e,t)=>{let i=t.closest(".dt-cell"),{rowIndex:r,isHeader:s}=u.data(i),a=t.checked;s?this.checkAll(a):this.checkRow(r,a)}))}refreshRows(){this.instance.renderBody(),this.instance.setDimensions()}refreshRow(e,t){this.datamanager.updateRow(e,t).forEach(r=>{this.cellmanager.refreshCell(r)})}getCheckedRows(){if(!this.checkMap)return[];let e=[];for(let t in this.checkMap)this.checkMap[t]===1&&e.push(t);return e}highlightCheckedRows(){this.getCheckedRows().map(e=>this.checkRow(e,!0))}checkRow(e,t){let i=t?1:0,r=s=>`.dt-cell--0-${s} [type="checkbox"]`;this.checkMap[e]=i,u.each(r(e),this.bodyScrollable).map(s=>{s.checked=t}),this.highlightRow(e,t),this.showCheckStatus(),this.fireEvent("onCheckRow",this.datamanager.getRow(e))}checkAll(e){let t=e?1:0;e?this.checkMap=Array.from(Array(this.getTotalRows())).map(i=>t):this.checkMap=[],u.each('.dt-cell--col-0 [type="checkbox"]',this.bodyScrollable).map(i=>{i.checked=e}),this.highlightAll(e),this.showCheckStatus(),this.fireEvent("onCheckRow")}showCheckStatus(){if(!this.options.checkedRowStatus)return;let t=this.getCheckedRows().length;if(t>0){let i=this.instance.translate("{count} rows selected",{count:t});this.bodyRenderer.showToastMessage(i)}else this.bodyRenderer.clearToastMessage()}highlightRow(e,t=!0){let i=this.getRow$(e);if(!!i){if(!t&&this.bodyScrollable.classList.contains("dt-scrollable--highlight-all")){i.classList.add("dt-row--unhighlight");return}t&&i.classList.contains("dt-row--unhighlight")&&i.classList.remove("dt-row--unhighlight"),this._highlightedRows=this._highlightedRows||{},t?(i.classList.add("dt-row--highlight"),this._highlightedRows[e]=i):(i.classList.remove("dt-row--highlight"),delete this._highlightedRows[e])}}highlightAll(e=!0){if(e)this.bodyScrollable.classList.add("dt-scrollable--highlight-all");else{this.bodyScrollable.classList.remove("dt-scrollable--highlight-all");for(let t in this._highlightedRows)this._highlightedRows[t].classList.remove("dt-row--highlight");this._highlightedRows={}}}showRows(e){e=$o(e);let t=e.map(i=>this.datamanager.getRow(i));this.bodyRenderer.renderRows(t)}showAllRows(){let e=this.datamanager.getAllRowIndices();this.showRows(e)}getChildrenToShowForNode(e){let t=this.datamanager.getRow(e);return t.meta.isTreeNodeClose=!1,this.datamanager.getImmediateChildren(e)}openSingleNode(e){let t=this.getChildrenToShowForNode(e),i=this.bodyRenderer.visibleRowIndices,r=Zt([...t,...i]).sort($e);this.showRows(r)}getChildrenToHideForNode(e){let t=this.datamanager.getRow(e);t.meta.isTreeNodeClose=!0;let i=this.datamanager.getChildren(e);return i.forEach(r=>{let s=this.datamanager.getRow(r);s.meta.isLeaf||(s.meta.isTreeNodeClose=!0)}),i}closeSingleNode(e){let t=this.getChildrenToHideForNode(e),r=this.bodyRenderer.visibleRowIndices.filter(s=>!t.includes(s)).sort($e);this.showRows(r)}expandAllNodes(){let i=this.datamanager.getRows().filter(a=>!a.meta.isLeaf).map(a=>this.getChildrenToShowForNode(a.meta.rowIndex)).flat(),r=this.bodyRenderer.visibleRowIndices,s=Zt([...i,...r]).sort($e);this.showRows(s)}collapseAllNodes(){let i=this.datamanager.getRows().filter(a=>a.meta.indent===0).map(a=>this.getChildrenToHideForNode(a.meta.rowIndex)).flat(),s=this.bodyRenderer.visibleRowIndices.filter(a=>!i.includes(a)).sort($e);this.showRows(s)}setTreeDepth(e){let t=this.datamanager.getRows(),i=t.filter(l=>l.meta.indent<e),r=t.filter(l=>l.meta.indent>=e),s=r.filter(l=>l.meta.indent>e);r.forEach(l=>{l.meta.isLeaf||(l.meta.isTreeNodeClose=!0)}),i.forEach(l=>{l.meta.isLeaf||(l.meta.isTreeNodeClose=!1)});let a=t.filter(l=>!s.includes(l)).map(l=>l.meta.rowIndex).sort($e);this.showRows(a)}getRow$(e){return u(this.selector(e),this.bodyScrollable)}getTotalRows(){return this.datamanager.getRowCount()}getFirstRowIndex(){return 0}getLastRowIndex(){return this.datamanager.getRowCount()-1}scrollToRow(e){e=+e,this._lastScrollTo=this._lastScrollTo||0;let t=this.getRow$(e);if(u.inViewport(t,this.bodyScrollable))return;let{height:i}=t.getBoundingClientRect(),{top:r,bottom:s}=this.bodyScrollable.getBoundingClientRect(),a=Math.floor((s-r)/i),l=0;e>this._lastScrollTo?l=i*(e+1-a):l=i*(e+1-1),this._lastScrollTo=e,u.scrollTop(this.bodyScrollable,l)}getRowHTML(e,t){let i=yt(t),r=t.rowIndex;return t.isFilter&&(e=e.map(s=>Object.assign({},s,{content:this.getFilterInput({colIndex:s.colIndex}),isFilter:1,isHeader:void 0,editable:!1})),r="filter"),t.isHeader&&(r="header"),`
            <div class="dt-row dt-row-${r}" ${i}>
                ${e.map(s=>this.cellmanager.getCellHTML(s)).join("")}
            </div>
        `}getFilterInput(e){return`<input class="dt-filter dt-input" type="text" ${yt(e)} tabindex="1" />`}selector(e){return`.dt-row-${e}`}},Eo=Wi(function(o,e){(function(t){o.exports=t()})(function(){return function t(i,r,s){function a(p,m){if(!r[p]){if(!i[p]){var f=typeof qe=="function"&&qe;if(!m&&f)return f(p,!0);if(l)return l(p,!0);var b=new Error("Cannot find module '"+p+"'");throw b.code="MODULE_NOT_FOUND",b}var y=r[p]={exports:{}};i[p][0].call(y.exports,function(v){var w=i[p][1][v];return a(w||v)},y,y.exports,t,i,r,s)}return r[p].exports}for(var l=typeof qe=="function"&&qe,d=0;d<s.length;d++)a(s[d]);return a}({1:[function(t,i,r){Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function m(f,b){for(var y=0;y<b.length;y++){var v=b[y];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}return function(f,b,y){return b&&m(f.prototype,b),y&&m(f,y),f}}();function a(m,f){if(!(m instanceof f))throw new TypeError("Cannot call a class as a function")}var l={width:"100%",height:"100%"},d=function(f){return Number(f)===Number(f)},p=function(){s(m,null,[{key:"create",value:function(b,y){return new m(b,y)}},{key:"mergeStyle",value:function(b,y){for(var v in y)b.style[v]!==y[v]&&(b.style[v]=y[v])}},{key:"getMaxBrowserHeight",value:function(){var b=document.createElement("div"),y=document.createElement("div");m.mergeStyle(b,{position:"absolute",height:"1px",opacity:0}),m.mergeStyle(y,{height:"1e7px"}),b.appendChild(y),document.body.appendChild(b);var v=y.offsetHeight;return document.body.removeChild(b),v}}]);function m(f,b){var y=this;a(this,m),this._config={},this._lastRepaint=null,this._maxElementHeight=m.getMaxBrowserHeight(),this.refresh(f,b);var v=this._config,w=function E(){var I=y._getScrollPosition(),L=y._lastRepaint;if(y._renderAnimationFrame=window.requestAnimationFrame(E),I!==L&&(!L||Math.abs(I-L)>y._averageHeight)){var N=y._renderChunk();y._lastRepaint=I,N!==!1&&typeof v.afterRender=="function"&&v.afterRender()}};w()}return s(m,[{key:"destroy",value:function(){window.cancelAnimationFrame(this._renderAnimationFrame)}},{key:"refresh",value:function(b,y){var v=this;if(Object.assign(this._config,l,y),!b||b.nodeType!==1)throw new Error("HyperList requires a valid DOM Node container");this._element=b;var w=this._config,E=this._scroller||w.scroller||document.createElement(w.scrollerTagName||"tr");if(typeof w.useFragment!="boolean"&&(this._config.useFragment=!0),!w.generate)throw new Error("Missing required `generate` function");if(!d(w.total))throw new Error("Invalid required `total` value, expected number");if(!Array.isArray(w.itemHeight)&&!d(w.itemHeight))throw new Error("\n        Invalid required `itemHeight` value, expected number or array\n      ".trim());d(w.itemHeight)?this._itemHeights=Array(w.total).fill(w.itemHeight):this._itemHeights=w.itemHeight,Object.keys(l).filter(function(j){return j in w}).forEach(function(j){var k=w[j],B=d(k),P=B?!1:k.slice(-1)==="%";if(k&&typeof k!="string"&&typeof k!="number"){var re="Invalid optional `"+j+"`, expected string or number";throw new Error(re)}else B&&(w[j]=k+"px");if(j==="height"){var se=B?k:parseInt(k.replace(/px|%/,""),10);P?v._containerHeight=window.innerHeight*se/100:v._containerHeight=d(k)?k:se}});var I={width:""+w.width,height:""+w.height,overflow:"auto",position:"relative"};m.mergeStyle(b,I);var L=w.itemHeight*w.total,N=this._maxElementHeight;L>N&&console.warn(["HyperList: The maximum element height",N+"px has","been exceeded; please reduce your item height."].join(" "));var q={opacity:"0",position:"absolute",width:"1px",height:L+"px"};m.mergeStyle(E,q),this._scroller||b.appendChild(E),this._scroller=E,this._scrollHeight=this._computeScrollHeight(),this._itemPositions=this._itemPositions||Array(w.total).fill(0),this._computePositions(0),this._renderChunk(this._lastRepaint!==null),typeof w.afterRender=="function"&&w.afterRender()}},{key:"_getRow",value:function(b){var y=this._config,v=y.generate(b),w=v.height;if(w!==void 0&&d(w)?(v=v.element,w!==this._itemHeights&&(this._itemHeights[b]=w,this._computePositions(b),this._scrollHeight=this._computeScrollHeight(b))):w=this._itemHeights[b],!v||v.nodeType!==1)throw new Error("Generator did not return a DOM Node for index: "+b);var E=v.getAttribute("class")||"";v.setAttribute("class",E+" "+(y.rowClassName||"vrow"));var I=this._itemPositions[b];return m.mergeStyle(v,{position:"absolute",top:I+"px"}),v}},{key:"_getScrollPosition",value:function(){var b=this._config;return typeof b.overrideScrollPosition=="function"?b.overrideScrollPosition():this._element.scrollTop}},{key:"_renderChunk",value:function(b){var y=this._config,v=this._element,w=this._getScrollPosition(),E=y.total,I=y.reverse?this._getReverseFrom(w):this._getFrom(w)-1;if((I<0||I-this._screenItemsLen<0)&&(I=0),!b&&this._lastFrom===I)return!1;this._lastFrom=I;var L=I+this._cachedItemsLen;(L>E||L+this._cachedItemsLen>E)&&(L=E);var N=y.useFragment?document.createDocumentFragment():[],q=this._scroller;N[y.useFragment?"appendChild":"push"](q);for(var j=I;j<L;j++){var k=this._getRow(j);N[y.useFragment?"appendChild":"push"](k)}if(y.applyPatch)return y.applyPatch(v,N);v.innerHTML="",v.appendChild(N)}},{key:"_computePositions",value:function(){var b=arguments.length<=0||arguments[0]===void 0?1:arguments[0],y=this._config,v=y.total,w=y.reverse;b<1&&!w&&(b=1);for(var E=b;E<v;E++)w?E===0?this._itemPositions[0]=this._scrollHeight-this._itemHeights[0]:this._itemPositions[E]=this._itemPositions[E-1]-this._itemHeights[E]:this._itemPositions[E]=this._itemHeights[E-1]+this._itemPositions[E-1]}},{key:"_computeScrollHeight",value:function(){var b=this,y=this._config,v=y.total,w=this._itemHeights.reduce(function(q,j){return q+j},0);m.mergeStyle(this._scroller,{opacity:0,position:"absolute",width:"1px",height:w+"px"});var E=this._itemHeights.slice(0).sort(function(q,j){return q-j}),I=Math.floor(v/2),L=v%2===0?(E[I]+E[I-1])/2:E[I],N=this._element.clientHeight?this._element.clientHeight:this._containerHeight;return this._screenItemsLen=Math.ceil(N/L),this._containerHeight=N,this._cachedItemsLen=Math.max(this._cachedItemsLen||0,this._screenItemsLen*3),this._averageHeight=L,y.reverse&&window.requestAnimationFrame(function(){b._element.scrollTop=w}),w}},{key:"_getFrom",value:function(b){for(var y=0;this._itemPositions[y]<b;)y++;return y}},{key:"_getReverseFrom",value:function(b){for(var y=this._config.total-1;y>0&&this._itemPositions[y]<b+this._containerHeight;)y--;return y}}]),m}();r.default=p,i.exports=r.default},{}]},{},[1])(1)})}),Io=Pi(Eo),hi=class{constructor(e){this.instance=e,this.options=e.options,this.datamanager=e.datamanager,this.rowmanager=e.rowmanager,this.cellmanager=e.cellmanager,this.bodyScrollable=e.bodyScrollable,this.footer=this.instance.footer,this.log=e.log}renderRows(e){if(this.visibleRows=e,this.visibleRowIndices=e.map(s=>s.meta.rowIndex),e.length===0){this.bodyScrollable.innerHTML=this.getNoDataHTML();return}let t=this.datamanager.rowViewOrder.map(s=>this.visibleRowIndices.includes(s)?s:null).filter(s=>s!==null),i=getComputedStyle(this.bodyScrollable),r={width:i.width,height:i.height,itemHeight:this.options.cellHeight,total:e.length,generate:s=>{let a=document.createElement("div"),l=t[s],d=this.datamanager.getRow(l),p=this.rowmanager.getRowHTML(d,d.meta);return a.innerHTML=p,a.children[0]},afterRender:()=>{this.restoreState()}};this.hyperlist?this.hyperlist.refresh(this.bodyScrollable,r):this.hyperlist=new Io(this.bodyScrollable,r),this.renderFooter()}render(){let e=this.datamanager.getRowsForView();this.renderRows(e),this.instance.setDimensions()}renderFooter(){if(!this.options.showTotalRow)return;let e=this.getTotalRow(),t=this.rowmanager.getRowHTML(e,{isTotalRow:1,rowIndex:"totalRow"});this.footer.innerHTML=t}getTotalRow(){return this.datamanager.getColumns().map(r=>{let s=null;return["_rowIndex","_checkbox"].includes(r.id)&&(s=""),{content:s,isTotalRow:1,colIndex:r.colIndex,column:r}}).map((r,s)=>{if(r.content==="")return r;if(this.options.hooks.columnTotal){let a=this.visibleRows.map(d=>d[s].content),l=this.options.hooks.columnTotal.call(this.instance,a,r);if(l!=null)return r.content=l,r}return r.content=this.visibleRows.reduce((a,l)=>{let d=l[s];return typeof d.content=="number"?(a==null&&(a=0),a+d.content):a},r.content),r})}restoreState(){this.rowmanager.highlightCheckedRows(),this.cellmanager.selectAreaOnClusterChanged(),this.cellmanager.focusCellOnClusterChanged()}showToastMessage(e,t){this.instance.toastMessage.innerHTML=this.getToastMessageHTML(e),t&&setTimeout(()=>{this.clearToastMessage()},t*1e3)}clearToastMessage(){this.instance.toastMessage.innerHTML=""}getNoDataHTML(){return`<div class="dt-scrollable__no-data">${this.options.noDataMessage}</div>`}getToastMessageHTML(e){return`<span class="dt-toast__message">${e}</span>`}},ci=class{constructor(e){this.instance=e,Je(this,this.instance,["options","datamanager","columnmanager","header","footer","bodyScrollable","datatableWrapper","getColumn","bodyRenderer"]),this.scopeClass="dt-instance-"+e.constructor.instances,e.datatableWrapper.classList.add(this.scopeClass);let t=document.createElement("style");e.wrapper.insertBefore(t,e.datatableWrapper),this.styleEl=t,this.bindResizeWindow(),this.bindScrollHeader()}get stylesheet(){return this.styleEl.sheet}bindResizeWindow(){this.onWindowResize=this.onWindowResize.bind(this),this.onWindowResize=oi(this.onWindowResize,300),this.options.layout==="fluid"&&u.on(window,"resize",this.onWindowResize)}bindScrollHeader(){this._settingHeaderPosition=!1,u.on(this.bodyScrollable,"scroll",e=>{this._settingHeaderPosition||(this._settingHeaderPosition=!0,requestAnimationFrame(()=>{let t=-e.target.scrollLeft;u.style(this.header,{transform:`translateX(${t}px)`}),u.style(this.footer,{transform:`translateX(${t}px)`}),this._settingHeaderPosition=!1}))})}onWindowResize(){this.distributeRemainingWidth(),this.refreshColumnWidth(),this.setBodyStyle()}destroy(){this.styleEl.remove(),u.off(window,"resize",this.onWindowResize)}setStyle(e,t){if(e.includes(",")){e.split(",").map(a=>a.trim()).forEach(a=>{this.setStyle(a,t)});return}if(e=e.trim(),!e)return;this._styleRulesMap=this._styleRulesMap||{};let i=this._getPrefixedSelector(e);this._styleRulesMap[i]&&(this.removeStyle(e),t=Object.assign({},this._styleRulesMap[i],t));let r=this._getRuleString(t),s=`${i} { ${r} }`;this._styleRulesMap[i]=t,this.stylesheet.insertRule(s)}removeStyle(e){if(e.includes(",")){e.split(",").map(r=>r.trim()).forEach(r=>{this.removeStyle(r)});return}if(e=e.trim(),!e)return;let t=this._getPrefixedSelector(e),i=Array.from(this.stylesheet.cssRules).findIndex(r=>r.selectorText===t);i!==-1&&this.stylesheet.deleteRule(i)}_getPrefixedSelector(e){return`.${this.scopeClass} ${e}`}_getRuleString(e){return Object.keys(e).map(t=>{let i=t;return t.includes("-")||(i=si(t)),`${i}:${e[t]};`}).join("")}setDimensions(){this.setCellHeight(),this.setupMinWidth(),this.setupNaturalColumnWidth(),this.setupColumnWidth(),this.distributeRemainingWidth(),this.setColumnStyle(),this.setBodyStyle()}setCellHeight(){this.setStyle(".dt-cell",{height:this.options.cellHeight+"px"})}setupMinWidth(){u.each(".dt-cell--header",this.header).map(e=>{let{colIndex:t}=u.data(e),i=this.getColumn(t);if(!i.minWidth){let r=u.style(u(".dt-cell__content",e),"width");i.minWidth=r}})}setupNaturalColumnWidth(){!u(".dt-row")||(u.each(".dt-row-header .dt-cell",this.header).map(e=>{let{colIndex:t}=u.data(e),i=this.datamanager.getColumn(t),r=u.style(u(".dt-cell__content",e),"width");typeof r=="number"&&r>=this.options.minimumColumnWidth?i.naturalWidth=r:i.naturalWidth=this.options.minimumColumnWidth}),u.each(".dt-row-0 .dt-cell",this.bodyScrollable).map(e=>{let{colIndex:t}=u.data(e),i=this.datamanager.getColumn(t),r=u.style(u(".dt-cell__content",e),"width");typeof r=="number"&&r>=i.naturalWidth?i.naturalWidth=r:i.naturalWidth=i.naturalWidth}))}setupColumnWidth(){if(this.options.layout==="ratio"){let e=u.style(this.datatableWrapper,"width");if(this.options.serialNoColumn){let r=this.datamanager.getColumnById("_rowIndex");e=e-r.width-1}if(this.options.checkboxColumn){let r=this.datamanager.getColumnById("_checkbox");e=e-r.width-1}let t=this.datamanager.getColumns().map(r=>r.id==="_rowIndex"||r.id==="_checkbox"?0:(r.width||(r.width=1),r.ratioWidth=parseInt(r.width,10),r.ratioWidth)).reduce((r,s)=>r+s),i=e/t;this.datamanager.getColumns().map(r=>{r.id==="_rowIndex"||r.id==="_checkbox"||(r.width=Math.floor(i*r.ratioWidth)-1)})}else this.datamanager.getColumns().map(e=>{e.width||(e.width=e.naturalWidth),e.id==="_rowIndex"&&(e.width=this.getRowIndexColumnWidth()),e.width<this.options.minimumColumnWidth&&(e.width=this.options.minimumColumnWidth)})}distributeRemainingWidth(){if(this.options.layout!=="fluid")return;let e=u.style(this.instance.datatableWrapper,"width"),t=u(".dt-row",this.bodyScrollable),i=e;if(t)i=u.style(t,"width");else{let a=u(".dt-row",this.instance.header);i=Array.from(a.children).map(d=>d.offsetWidth).reduce((d,p)=>d+p,0)}let r=this.datamanager.getColumns().filter(a=>a.resizable),s=(e-i)/r.length;r.map(a=>{let l=u.style(this.getColumnHeaderElement(a.colIndex),"width"),d=Math.floor(l+s)-2;this.datamanager.updateColumn(a.colIndex,{width:d})})}setColumnStyle(){this.datamanager.getColumns().map(e=>{e.align||(e.align="left"),["left","center","right"].includes(e.align)||(e.align="left"),this.setStyle(`.dt-cell--col-${e.colIndex}`,{"text-align":e.align}),this.columnmanager.setColumnHeaderWidth(e.colIndex),this.columnmanager.setColumnWidth(e.colIndex)})}refreshColumnWidth(){this.datamanager.getColumns().map(e=>{this.columnmanager.setColumnHeaderWidth(e.colIndex),this.columnmanager.setColumnWidth(e.colIndex)})}setBodyStyle(){let e=u.style(this.datatableWrapper,"width"),t=u(".dt-row",this.bodyScrollable);if(!t)return;let i=u.style(t,"width"),r=e>i?i:e;u.style(this.bodyScrollable,{width:r+"px"}),u.removeStyle(this.bodyScrollable,"height");let s=u.getStyle(this.bodyScrollable,"height"),a=(this.bodyRenderer.hyperlist||{})._scrollHeight||1/0,l=u.hasHorizontalOverflow(this.bodyScrollable),d;a<s&&(d=a,l&&(d+=u.scrollbarSize()),u.style(this.bodyScrollable,{height:d+"px"})),this.bodyScrollable.scrollHeight-this.bodyScrollable.offsetHeight<u.scrollbarSize()&&u.style(this.bodyScrollable,{overflowY:"hidden"}),this.options.layout==="fluid"&&u.style(this.bodyScrollable,{overflowX:"hidden"})}getColumnHeaderElement(e){return e=+e,e<0?null:u(`.dt-cell--col-${e}`,this.header)}getRowIndexColumnWidth(){let e=this.datamanager.getRowCount(),t=22;return u.measureTextWidth(e+"")+t}},Do={13:"enter",91:"meta",16:"shift",17:"ctrl",18:"alt",37:"left",38:"up",39:"right",40:"down",9:"tab",27:"esc",67:"c",70:"f",86:"v"},pi=class{constructor(e){this.listeners={},u.on(e,"keydown",this.handler.bind(this))}handler(e){let t=Do[e.keyCode];e.shiftKey&&t!=="shift"&&(t="shift+"+t),(e.ctrlKey&&t!=="ctrl"||e.metaKey&&t!=="meta")&&(t="ctrl+"+t);let i=this.listeners[t];if(i&&i.length>0)for(let r of i){let s=r(e);(s===void 0||s===!0)&&e.preventDefault()}}on(e,t){e.split(",").map(r=>r.trim()).map(r=>{this.listeners[r]=this.listeners[r]||[],this.listeners[r].push(t)})}},Ho={"Sort Ascending":"Sort Ascending","Sort Descending":"Sort Descending","Reset sorting":"Reset sorting","Remove column":"Remove column","No Data":"No Data","{count} cells copied":{"1":"{count} cell copied",default:"{count} cells copied"},"{count} rows selected":{"1":"{count} row selected",default:"{count} rows selected"}},Mo={"Sort Ascending":"Aufsteigend sortieren","Sort Descending":"Absteigend sortieren","Reset sorting":"Sortierung zur\xFCcksetzen","Remove column":"Spalte entfernen","No Data":"Keine Daten","{count} cells copied":{"1":"{count} Zelle kopiert",default:"{count} Zellen kopiert"},"{count} rows selected":{"1":"{count} Zeile ausgew\xE4hlt",default:"{count} Zeilen ausgew\xE4hlt"}},Ao={"Sort Ascending":"Trier par ordre croissant","Sort Descending":"Trier par ordre d\xE9croissant","Reset sorting":"R\xE9initialiser le tri","Remove column":"Supprimer colonne","No Data":"Pas de donn\xE9es","{count} cells copied":{"1":"{count} cellule copi\xE9e",default:"{count} cellules copi\xE9es"},"{count} rows selected":{"1":"{count} ligne s\xE9lectionn\xE9e",default:"{count} lignes s\xE9lectionn\xE9es"}},No={"Sort Ascending":"Ordinamento ascendente","Sort Descending":"Ordinamento decrescente","Reset sorting":"Azzeramento ordinamento","Remove column":"Rimuovi colonna","No Data":"Nessun dato","{count} cells copied":{"1":"Copiato {count} cella",default:"{count} celle copiate"},"{count} rows selected":{"1":"{count} linea selezionata",default:"{count} linee selezionate"}};function Oo(){return{en:Ho,de:Mo,fr:Ao,it:No}}var ui=class{constructor(e){this.language=e,this.translations=Oo()}addTranslations(e){this.translations=Object.assign(this.translations,e)}translate(e,t){let i=this.translations[this.language]&&this.translations[this.language][e]||e;return typeof i=="object"&&(i=t&&t.count?this.getPluralizedTranslation(i,t.count):e),ko(i,t||{})}getPluralizedTranslation(e,t){return e[t]||e.default}};function Lo(o,e){let t=[];if(Object.keys(e).length===0)return o.map(i=>i.meta.rowIndex);for(let i in e){let r=e[i],a=(t.length?t.map(p=>o[p]):o).map(p=>p[i]),l=Fo(r),d=jo(l);d?t=d(l.text,a):t=a.map(p=>p.rowIndex)}return t}function jo(o){let e=s=>String(To(s.html||"")||s.content||"").toLowerCase(),t=s=>parseFloat(s.content),i=(s,a)=>{if(s.column.compareValue){let d=s.column.compareValue(s,a);if(d&&Array.isArray(d))return d}let l=t(s);return isNaN(l)?[e(s),a]:[l,a]};return{contains(s,a){return a.filter(l=>{let d=e(l),p=(s||"").toLowerCase();return!p||d.includes(p)}).map(l=>l.rowIndex)},greaterThan(s,a){return a.filter(l=>{let[d,p]=i(l,s);return d>p}).map(l=>l.rowIndex)},lessThan(s,a){return a.filter(l=>{let[d,p]=i(l,s);return d<p}).map(l=>l.rowIndex)},equals(s,a){return a.filter(l=>parseFloat(l.content)===s).map(l=>l.rowIndex)},notEquals(s,a){return a.filter(l=>parseFloat(l.content)!==s).map(l=>l.rowIndex)},range(s,a){return a.filter(l=>{let d=i(l,s[0]),p=i(l,s[1]),m=d[0];return m>=d[1]&&m<=p[1]}).map(l=>l.rowIndex)},containsNumber(s,a){return a.filter(l=>{let d=parseFloat(s,10),p=s,m=t(l),f=e(l);return d===m||f.includes(p)}).map(l=>l.rowIndex)}}[o.type]}function Fo(o=""){if(o.length===0)return{};let e=o;return[">","<","="].includes(e[0])?e=o.slice(1):e.startsWith("!=")&&(e=o.slice(2)),o.startsWith(">")&&e?{type:"greaterThan",text:e.trim()}:o.startsWith("<")&&e?{type:"lessThan",text:e.trim()}:o.startsWith("=")&&Ve(e)?{type:"equals",text:Number(o.slice(1).trim())}:Ve(e)?{type:"containsNumber",text:e}:o.startsWith("!=")&&Ve(e)?{type:"notEquals",text:Number(o.slice(2).trim())}:o.split(":").length===2?(e=o.split(":"),{type:"range",text:e.map(t=>t.trim())}):{type:"contains",text:e.toLowerCase()}}function Po(o){return{columns:[],data:[],dropdownButton:wt.chevronDown,headerDropdown:[{label:o.translate("Sort Ascending"),action:function(e){this.sortColumn(e.colIndex,"asc")}},{label:o.translate("Sort Descending"),action:function(e){this.sortColumn(e.colIndex,"desc")}},{label:o.translate("Reset sorting"),action:function(e){this.sortColumn(e.colIndex,"none")}},{label:o.translate("Remove column"),action:function(e){this.removeColumn(e.colIndex)}}],events:{onRemoveColumn(e){},onSwitchColumn(e,t){},onSortColumn(e){},onCheckRow(e){},onDestroy(){}},hooks:{columnTotal:null},sortIndicator:{asc:"\u2191",desc:"\u2193",none:""},overrideComponents:{},filterRows:Lo,freezeMessage:"",getEditor:null,serialNoColumn:!0,checkboxColumn:!1,clusterize:!0,logs:!1,layout:"fixed",noDataMessage:o.translate("No Data"),cellHeight:40,minimumColumnWidth:30,inlineFilters:!1,treeView:!1,checkedRowStatus:!0,dynamicRowHeight:!1,pasteFromClipboard:!1,showTotalRow:!1,direction:"ltr",disableReorderColumn:!1}}var Wo={DataManager:ni,CellManager:ai,ColumnManager:li,RowManager:di,BodyRenderer:hi,Style:ci,Keyboard:pi},be=class{constructor(e,t){if(be.instances++,typeof e=="string"&&(e=document.querySelector(e)),this.wrapper=e,!(this.wrapper instanceof HTMLElement))throw new Error("Invalid argument given for `wrapper`");this.initializeTranslations(t),this.setDefaultOptions(),this.buildOptions(t),this.prepare(),this.initializeComponents(),this.options.data&&(this.refresh(),this.columnmanager.applyDefaultSortOrder())}initializeTranslations(e){this.language=e.language||"en",this.translationManager=new ui(this.language),e.translations&&this.translationManager.addTranslations(e.translations)}setDefaultOptions(){this.DEFAULT_OPTIONS=Po(this)}buildOptions(e){this.options=this.options||{},this.options=Object.assign({},this.DEFAULT_OPTIONS,this.options||{},e),e.headerDropdown=e.headerDropdown||[],this.options.headerDropdown=[...this.DEFAULT_OPTIONS.headerDropdown,...e.headerDropdown],this.events=Object.assign({},this.DEFAULT_OPTIONS.events,this.options.events||{},e.events||{}),this.fireEvent=this.fireEvent.bind(this)}prepare(){this.prepareDom(),this.unfreeze()}initializeComponents(){let e=Object.assign({},Wo,this.options.overrideComponents),{Style:t,Keyboard:i,DataManager:r,RowManager:s,ColumnManager:a,CellManager:l,BodyRenderer:d}=e;this.style=new t(this),this.keyboard=new i(this.wrapper),this.datamanager=new r(this.options),this.rowmanager=new s(this),this.columnmanager=new a(this),this.cellmanager=new l(this),this.bodyRenderer=new d(this)}prepareDom(){this.wrapper.innerHTML=`
            <div class="datatable" dir="${this.options.direction}">
                <div class="dt-header"></div>
                <div class="dt-scrollable"></div>
                <div class="dt-footer"></div>
                <div class="dt-freeze">
                    <span class="dt-freeze__message">
                        ${this.options.freezeMessage}
                    </span>
                </div>
                <div class="dt-toast"></div>
                <div class="dt-dropdown-container"></div>
                <textarea class="dt-paste-target"></textarea>
            </div>
        `,this.datatableWrapper=u(".datatable",this.wrapper),this.header=u(".dt-header",this.wrapper),this.footer=u(".dt-footer",this.wrapper),this.bodyScrollable=u(".dt-scrollable",this.wrapper),this.freezeContainer=u(".dt-freeze",this.wrapper),this.toastMessage=u(".dt-toast",this.wrapper),this.pasteTarget=u(".dt-paste-target",this.wrapper),this.dropdownContainer=u(".dt-dropdown-container",this.wrapper)}refresh(e,t){this.datamanager.init(e,t),this.render(),this.setDimensions()}destroy(){this.wrapper.innerHTML="",this.style.destroy(),this.fireEvent("onDestroy")}appendRows(e){this.datamanager.appendRows(e),this.rowmanager.refreshRows()}refreshRow(e,t){this.rowmanager.refreshRow(e,t)}render(){this.renderHeader(),this.renderBody()}renderHeader(){this.columnmanager.renderHeader()}renderBody(){this.bodyRenderer.render()}setDimensions(){this.style.setDimensions()}showToastMessage(e,t){this.bodyRenderer.showToastMessage(e,t)}clearToastMessage(){this.bodyRenderer.clearToastMessage()}getColumn(e){return this.datamanager.getColumn(e)}getColumns(){return this.datamanager.getColumns()}getRows(){return this.datamanager.getRows()}getCell(e,t){return this.datamanager.getCell(e,t)}getColumnHeaderElement(e){return this.columnmanager.getColumnHeaderElement(e)}getViewportHeight(){return this.viewportHeight||(this.viewportHeight=u.style(this.bodyScrollable,"height")),this.viewportHeight}sortColumn(e,t){this.columnmanager.sortColumn(e,t)}removeColumn(e){this.columnmanager.removeColumn(e)}scrollToLastColumn(){this.datatableWrapper.scrollLeft=9999}freeze(){u.style(this.freezeContainer,{display:""})}unfreeze(){u.style(this.freezeContainer,{display:"none"})}updateOptions(e){this.buildOptions(e)}fireEvent(e,...t){let i=[...this._internalEventHandlers[e]||[],this.events[e]].filter(Boolean);for(let r of i)r.apply(this,t)}on(e,t){this._internalEventHandlers=this._internalEventHandlers||{},this._internalEventHandlers[e]=this._internalEventHandlers[e]||[],this._internalEventHandlers[e].push(t)}log(){this.options.logs&&console.log.apply(console,arguments)}translate(e,t){return this.translationManager.translate(e,t)}};be.instances=0;var Bo="frappe-datatable",zo="0.0.0-development",qo="A modern datatable library for the web",Vo="dist/frappe-datatable.cjs.js",Yo="dist/frappe-datatable.min.js",Xo="dist/frappe-datatable.min.js",Go={start:"yarn run dev",build:"rollup -c && NODE_ENV=production rollup -c",dev:"rollup -c -w","cy:server":"http-server -p 8989","cy:open":"cypress open","cy:run":"cypress run",test:"start-server-and-test cy:server http://localhost:8989 cy:run","test-local":"start-server-and-test cy:server http://localhost:8989 cy:open","travis-deploy-once":"travis-deploy-once","semantic-release":"semantic-release",lint:"eslint src","lint-and-build":"yarn lint && yarn build",commit:"npx git-cz"},Uo=["dist","src"],Ko={autoprefixer:"^9.0.0",chai:"3.5.0",cypress:"^9.2.0","cz-conventional-changelog":"^2.1.0",deepmerge:"^2.0.1",eslint:"^5.0.1","eslint-config-airbnb":"^16.1.0","eslint-config-airbnb-base":"^12.1.0","eslint-plugin-import":"^2.11.0","http-server":"^0.11.1",mocha:"3.3.0","postcss-custom-properties":"^7.0.0","postcss-nested":"^3.0.0",rollup:"^0.59.4","rollup-plugin-commonjs":"^8.3.0","rollup-plugin-eslint":"^4.0.0","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.3","rollup-plugin-postcss":"^1.2.8","rollup-plugin-uglify-es":"^0.0.1","semantic-release":"^17.1.1","start-server-and-test":"^1.4.1","travis-deploy-once":"^5.0.1"},Jo={type:"git",url:"https://github.com/frappe/datatable.git"},Qo=["datatable","data","grid","table"],Zo="Faris Ansari",en="MIT",tn={url:"https://github.com/frappe/datatable/issues"},rn="https://frappe.github.io/datatable",sn={hyperlist:"^1.0.0-beta",lodash:"^4.17.5",sortablejs:"^1.7.0"},on={commitizen:{path:"cz-conventional-changelog"}},nn={name:Bo,version:zo,description:qo,main:Vo,unpkg:Yo,jsdelivr:Xo,scripts:Go,files:Uo,devDependencies:Ko,repository:Jo,keywords:Qo,author:Zo,license:en,bugs:tn,homepage:rn,dependencies:sn,config:on};be.__version__=nn.version;_i.exports=be});var _n=_t(Vt());frappe.views.ReportFactory=class extends frappe.views.Factory{make(e){let t=["List",e[1],"Report"];e[2]&&t.push(e[2]),frappe.set_route(t)}};var xt=_t(Ct());window.DataTable=xt.default;frappe.provide("frappe.views");frappe.views.ReportView=class extends frappe.views.ListView{get view_name(){return"Report"}render_header(){}setup_defaults(){super.setup_defaults(),this.page_title=__("Report:")+" "+this.page_title,this.view="Report";let e=frappe.get_route();if(e.length===4&&(this.report_name=e[3]),this.report_name)return this.get_report_doc().then(t=>{this.report_doc=t,this.report_doc.json=JSON.parse(this.report_doc.json),this.filters=this.report_doc.json.filters,this.order_by=this.report_doc.json.order_by,this.add_totals_row=this.report_doc.json.add_totals_row,this.page_title=this.report_name,this.page_length=this.report_doc.json.page_length||20,this.order_by=this.report_doc.json.order_by||"modified desc",this.chart_args=this.report_doc.json.chart_args});this.add_totals_row=this.view_user_settings.add_totals_row||0,this.chart_args=this.view_user_settings.chart_args}setup_view(){this.setup_columns(),super.setup_new_doc_event(),this.page.main.addClass("report-view")}setup_page(){this.menu_items=this.report_menu_items(),super.setup_page()}toggle_side_bar(){super.toggle_side_bar(),this.render(!0)}setup_result_area(){super.setup_result_area(),this.setup_charts_area(),this.$datatable_wrapper=$('<div class="datatable-wrapper">'),this.$result.append(this.$datatable_wrapper)}setup_charts_area(){this.$charts_wrapper=$(`<div class="charts-wrapper hidden">
			<div class="text-right"><button class="btn btn-default btn-xs btn-chart-configure"
				style="margin-right: 15px; margin-top: 15px">Configure</button></div>
			<div class="charts-inner-wrapper"></div>
		</div>`),this.$result.append(this.$charts_wrapper),this.$charts_wrapper.find(".btn-chart-configure").on("click",()=>{this.setup_charts()})}setup_paging_area(){super.setup_paging_area();let e=__("For comparison, use >5, <10 or =324. For ranges, use 5:10 (for values between 5 & 10).");this.$paging_area.find(".level-left").append(`<span class="comparison-message text-muted">${e}</span>`)}setup_sort_selector(){this.sort_selector=new frappe.ui.SortSelector({parent:this.filter_area.$filter_list_wrapper,doctype:this.doctype,args:this.order_by,onchange:this.on_sort_change.bind(this)}),this.group_by_control=new frappe.ui.GroupBy(this),this.report_doc&&this.report_doc.json.group_by&&this.group_by_control.apply_settings(this.report_doc.json.group_by),this.view_user_settings&&this.view_user_settings.group_by&&this.group_by_control.apply_settings(this.view_user_settings.group_by)}get_args(){let e=super.get_args();return delete e.group_by,this.group_by_control.set_args(e),e}before_refresh(){return this.report_doc?Promise.resolve():super.before_refresh()}after_render(){this.report_doc?$.isEmptyObject(this.report_doc.json)||this.set_dirty_state_for_custom_report():this.save_report_settings(),this.group_by||this.init_chart()}set_dirty_state_for_custom_report(){let e={filters:this.filter_area.get(),fields:this.fields,order_by:this.sort_selector.get_sql_string(),add_totals_row:this.add_totals_row,page_length:this.page_length,column_widths:this.get_column_widths(),group_by:this.group_by_control.get_settings(),chart_args:this.get_chart_settings()},t={filters:this.report_doc.json.filters,fields:this.report_doc.json.fields,order_by:this.report_doc.json.order_by,add_totals_row:this.report_doc.json.add_totals_row,page_length:this.report_doc.json.page_length,column_widths:this.report_doc.json.column_widths,group_by:this.report_doc.json.group_by,chart_args:this.report_doc.json.chart_args};frappe.utils.deep_equal(e,t)?this.page.clear_indicator():this.page.set_indicator(__("Not Saved"),"orange")}save_report_settings(){frappe.model.user_settings.save(this.doctype,"last_view",this.view_name),this.report_name||this.save_view_user_settings({fields:this.fields,filters:this.filter_area.get(),order_by:this.sort_selector.get_sql_string(),group_by:this.group_by_control.get_settings(),chart_args:this.get_chart_settings(),add_totals_row:this.add_totals_row})}prepare_data(e){let t=e.message||{};t=frappe.utils.dict(t.keys,t.values),this.start===0?this.data=t:this.data=this.data.concat(t)}render(e){if(this.data.length!==0){if(this.render_count(),this.setup_columns(),this.group_by?this.$charts_wrapper.addClass("hidden"):this.chart&&this.refresh_charts(),this.datatable&&!e){this.datatable.refresh(this.get_data(this.data),this.columns);return}this.setup_datatable(this.data)}}render_count(){let e=this.$paging_area.find(".list-count");e.length||(e=$("<span>").addClass("text-muted list-count").prependTo(this.$paging_area.find(".level-right"))),this.get_count_str().then(t=>{e.text(t)})}on_update(e){if(this.doctype===e.doctype&&e.name){let t=e.user!==frappe.session.user;this.data.find(i=>i.name===e.name)?frappe.db.get_doc(e.doctype,e.name).then(i=>this.update_row(i,t)):this.refresh()}}update_row(e,t){let i=[];this.data=this.data.map((s,a)=>{if(s.name===e.name){for(let l in s)if(l.includes(":")){let[d,p]=l.split(":"),m=Object.keys(e).filter(f=>Array.isArray(e[f])&&e[f].length&&e[f][0].doctype===d).map(f=>e[f]).map(f=>f[0]).filter(f=>f.name===s[d+":name"])[0];m&&(s[l]=m[p])}else s[l]=e[l];i.push([s,a])}return s});let r=s=>{if(!t)return;let a=this.$result.find(`.dt-row[data-row-index="${s}"]`);a.addClass("row-update"),setTimeout(()=>a.removeClass("row-update"),500)};i.forEach(([s,a])=>{let l=this.build_row(s);this.datatable.refreshRow(l,a),r(a)})}setup_datatable(e){this.$datatable_wrapper.empty(),this.datatable=new xt.default(this.$datatable_wrapper[0],{columns:this.columns,data:this.get_data(e),getEditor:this.get_editing_object.bind(this),language:frappe.boot.lang,translations:frappe.utils.datatable.get_translations(),checkboxColumn:!0,inlineFilters:!0,cellHeight:35,direction:frappe.utils.is_rtl()?"rtl":"ltr",events:{onRemoveColumn:t=>{this.remove_column_from_datatable(t)},onSwitchColumn:(t,i)=>{this.switch_column(t,i)},onCheckRow:()=>{let t=this.get_checked_items();this.toggle_actions_menu_button(t.length>0)}},hooks:{columnTotal:frappe.utils.report_column_total},headerDropdown:[{label:__("Add Column"),action:t=>{let i=[],r=this.get_columns_for_picker();i=r[this.doctype].filter(a=>!this.is_column_added(a)).map(a=>({label:__(a.label),value:a.fieldname})),delete r[this.doctype];for(let a in r)r[a].filter(l=>!this.is_column_added(l)).map(l=>({label:__(l.label)+` (${a})`,value:l.fieldname+","+a})).forEach(l=>i.push(l));let s=new frappe.ui.Dialog({title:__("Add Column"),fields:[{label:__("Select Column"),fieldname:"column",fieldtype:"Autocomplete",options:i},{label:__("Insert Column Before {0}",[__(t.docfield.label).bold()]),fieldname:"insert_before",fieldtype:"Check"}],primary_action:({column:a,insert_before:l})=>{if(!i.map(m=>m.value).includes(a)){frappe.show_alert({message:__("Invalid column"),indicator:"orange"}),s.hide();return}let d=this.doctype;a.includes(",")&&([a,d]=a.split(","));let p=t.colIndex;l&&(p=p-1),this.add_column_to_datatable(a,d,p),s.hide()}});s.show()}}]})}toggle_charts(){if(!this.chart){this.setup_charts();return}this.$charts_wrapper.hasClass("hidden")?(this.$charts_wrapper.removeClass("hidden"),this.refresh_charts()):(this.$charts_wrapper.addClass("hidden"),this.save_view_user_settings({chart_args:null}),this.chart_args=null)}init_chart(){this.chart||this.chart_args&&(this.build_chart_args(this.chart_args.x_axis,this.chart_args.y_axes,this.chart_args.chart_type),this.make_chart())}setup_charts(){let e=[],t=[];for(let s of this.columns)e.push({label:s.content,fieldname:s.id,value:s.id}),s.docfield&&frappe.model.numeric_fieldtypes.includes(s.docfield.fieldtype)&&t.push({label:s.content,fieldname:s.id,value:s.id});let i=this.chart_args||{},r=new frappe.ui.Dialog({title:__("Configure Chart"),fields:[{label:__("X Axis Field"),fieldtype:"Select",fieldname:"x_axis",options:e,default:i.x_axis},{label:__("Y Axis Fields"),fieldtype:"MultiSelect",fieldname:"y_axes",options:t,description:__("Showing only Numeric fields from Report"),default:i.y_axes?i.y_axes.join(", "):null},{label:__("Chart Type"),fieldtype:"Select",options:["Bar","Line","Pie","Percentage","Donut"],fieldname:"chart_type",default:i.chart_type?frappe.utils.to_title_case(i.chart_type):"Bar"}],primary_action:s=>{s.y_axes=s.y_axes.split(",").map(a=>a.trim()).filter(Boolean),this.build_chart_args(s.x_axis,s.y_axes,s.chart_type),this.make_chart(),r.hide()}});r.show()}build_chart_args(e,t,i){let r=t.map(s=>({name:this.columns_map[s].content,values:this.data.map(a=>a[s])}));this.chart_args={chart_type:i.toLowerCase(),x_axis:e,y_axes:t,labels:this.data.map(s=>s[e]),datasets:r},this.save_view_user_settings({chart_args:this.get_chart_settings()})}get_chart_settings(){if(this.chart_args)return{chart_type:this.chart_args.chart_type,x_axis:this.chart_args.x_axis,y_axes:this.chart_args.y_axes}}make_chart(){let e=this.chart_args,t={labels:e.labels,datasets:e.datasets};this.last_chart_type=e.chart_type;let i=s=>this.columns_map[s].docfield,r=(s,a)=>this.data.find(l=>l[a]===s);this.$charts_wrapper.removeClass("hidden"),this.chart=new frappe.Chart(this.$charts_wrapper.find(".charts-inner-wrapper")[0],{title:__("{0} Chart",[this.doctype]),data:t,type:e.chart_type,truncateLegends:1,colors:["#70E078","light-blue","orange","red"],axisOptions:{shortenYAxisNumbers:1},tooltipOptions:{formatTooltipY:s=>frappe.format(s,i(this.chart_args.y_axes[0]),{always_show_decimals:!0,inline:!0},r(s.doc))}})}refresh_charts(){if(!this.chart||!this.chart_args)return;this.$charts_wrapper.removeClass("hidden");let{x_axis:e,y_axes:t,chart_type:i}=this.chart_args;this.build_chart_args(e,t,i),this.chart.update(this.chart_args)}get_editing_object(e,t,i,r){let s=this.render_editing_input(e,i,r);return s?(s.df.change=()=>s.set_focus(),{initValue:a=>s.set_value(a),setValue:a=>{let l=this.datatable.getCell(e,t),d=this.datatable.getColumn(e).docfield.fieldname,p=l.name,m=l.doctype;return s.set_value(a),this.set_control_value(m,p,d,a).then(f=>{let b=this.data.filter(y=>y.name===f.name).find(y=>m!=f.doctype&&y[m+":name"]==p||m==f.doctype);for(let y in b)if(y.includes(":")){let[v,w]=y.split(":"),E=Object.keys(f).filter(I=>Array.isArray(f[I])&&f[I].length&&f[I][0].doctype===v).map(I=>f[I])[0].filter(I=>I.name===b[v+":name"])[0];E&&(b[y]=E[w])}else b[y]=f[y]}).then(()=>this.refresh_charts())},getValue:()=>s.get_value()}):!1}set_control_value(e,t,i,r){return this.last_updated_doc=t,new Promise((s,a)=>{frappe.db.set_value(e,t,{[i]:r}).then(l=>{l.message?s(l.message):a()}).fail(a)})}render_editing_input(e,t,i){let r=this.datatable.getColumn(e),s=null;if(r.docfield.fieldtype==="Text Editor"){let a=new frappe.ui.Dialog({title:__("Edit {0}",[r.docfield.label]),fields:[r.docfield],primary_action:()=>{this.datatable.cellmanager.submitEditing(),this.datatable.cellmanager.deactivateEditing(),a.hide()}});a.show(),s=a.fields_dict[r.docfield.fieldname]}else s=frappe.ui.form.make_control({df:r.docfield,parent:i,render_input:!0}),s.set_value(t),s.toggle_label(!1),s.toggle_description(!1);return s}is_editable(e,t){return!!(e&&frappe.model.can_write(this.doctype)&&(t.docstatus!==1||e.allow_on_submit)&&t.docstatus!==2&&!e.read_only&&!e.is_virtual&&!e.hidden&&frappe.model.is_non_std_field(e.fieldname))}get_data(e){return this.build_rows(e)}set_fields(){if(["name","docstatus"].map(e=>this._add_field(e)),this.report_name&&this.report_doc.json.fields){this.report_doc.json.fields.slice().forEach(t=>this._add_field(t[0],t[1]));return}else if(this.view_user_settings.fields){this.view_user_settings.fields.forEach(t=>this._add_field(t[0],t[1]));return}this.set_default_fields()}set_default_fields(){this.fields=this.fields||[];let e=i=>this._add_field(i);[this.meta.title_field,this.meta.image_field].map(e);let t=this.meta.fields.filter(i=>(i.in_list_view||i.in_standard_filter)&&frappe.perm.has_perm(this.doctype,i.permlevel,"read")&&frappe.model.is_value_type(i.fieldtype)&&!i.report_hide);t.map(e),t.filter(i=>i.fieldtype==="Currency"&&i.options).map(i=>{i.options.includes(":")?e(i.options.split(":")[1]):e(i.options)}),(this.settings.add_fields||[]).map(e)}build_fields(){super.build_fields()}reorder_fields(){let e=this.columns.map(r=>[r.field,r.docfield.parent]),t=e.filter(r=>this.fields.find(s=>r[0]==s[0]&&r[1]==s[1])),i=this.fields.filter(r=>!e.find(s=>r[0]==s[0]&&r[1]==s[1]));this.fields=[...t,...i]}get_fields(){let e=this.fields.map(i=>{let r=frappe.model.get_full_column_name(i[0],i[1]);return i[1]!==this.doctype&&(r=r+` as '${i[1]}:${i[0]}'`),r}),t=this.get_unique_cdt_in_view().map(i=>frappe.model.get_full_column_name("name",i)+` as '${i}:name'`);return e=e.concat(t),e}get_unique_cdt_in_view(){return this.fields.filter(e=>e[1]!==this.doctype).map(e=>e[1]).uniqBy(e=>e)}add_column_to_datatable(e,t,i){let r=[e,t];this.fields.splice(i,0,r),this.add_currency_column(e,t,i),this.build_fields(),this.setup_columns(),this.datatable&&this.datatable.destroy(),this.datatable=null,this.refresh()}add_currency_column(e,t,i){let r=frappe.meta.get_docfield(t,e);if(r&&r.fieldtype==="Currency"&&r.options&&!r.options.includes(":")&&frappe.meta.has_field(t,r.options)){let s=[r.options,t];i===void 0?this.fields.push(s):this.fields.splice(i,0,s);let a=frappe.meta.get_label(t,s[0]);frappe.show_alert(__("Also adding the dependent currency field {0}",[__(a).bold()]))}}add_status_dependency_column(e,t){if(!this.fields.find(i=>i[0]===e)){let i=[e,t];this.fields.push(i),this.refresh();let r=frappe.meta.get_label(t,i[0]);frappe.show_alert(__("Also adding the status dependency field {0}",[__(r).bold()]))}}remove_column_from_datatable(e){let t=this.fields.findIndex(r=>e.field===r[0]);if(t===-1)return;this.fields[t][0]==="name"&&(this.refresh(),frappe.throw(__("Cannot remove ID field"))),this.fields.splice(t,1),this.build_fields(),this.setup_columns(),this.refresh()}switch_column(e,t){let i=this.fields.findIndex(l=>e.field===l[0]),r=this.fields.findIndex(l=>t.field===l[0]),s=this.fields.slice(),a=s[i];s[i]=s[r],s[r]=a,this.fields=s,this.build_fields(),this.setup_columns(),this.refresh()}get_columns_for_picker(){let e={},t=l=>!in_list(frappe.model.no_value_type,l.fieldtype),i=frappe.meta.get_docfields(this.doctype).filter(t),r=frappe.model.std_fields.filter(l=>l.fieldname!=="docstatus"),s=!1;return this.data&&(s=frappe.get_indicator(this.data[0],this.doctype)),!frappe.meta.has_field(this.doctype,"status")&&s&&(i=[{label:__("Status"),fieldname:"docstatus",fieldtype:"Data"}].concat(i)),i=[{label:__("ID",null,"Label of name column in report"),fieldname:"name",fieldtype:"Data",reqd:1}].concat(i,r),e[this.doctype]=i,frappe.meta.get_table_fields(this.doctype).forEach(l=>{let d=l.options,p=frappe.meta.get_docfields(d).filter(t);e[d]=p,e[d].push({label:__("Index"),fieldname:"idx",fieldtype:"Int",parent:d})}),e}get_dialog_fields(){let e=[],t=this.get_columns_for_picker();return e.push({label:__(this.doctype),fieldname:this.doctype,fieldtype:"MultiCheck",columns:2,options:t[this.doctype].filter(r=>!r.hidden&&r.fieldname!=="name").map(r=>({label:__(r.label),value:r.fieldname,checked:this.fields.find(s=>s[0]===r.fieldname&&s[1]===this.doctype)}))}),delete t[this.doctype],frappe.meta.get_table_fields(this.doctype).filter(r=>!r.hidden).forEach(r=>{let s=r.options;e.push({label:__(r.label)+` (${__(s)})`,fieldname:r.options,fieldtype:"MultiCheck",columns:2,options:t[s].filter(a=>!a.hidden).map(a=>({label:__(a.label),value:a.fieldname,checked:this.fields.find(l=>l[0]===a.fieldname&&l[1]===s)}))})}),e}is_column_added(e){return Boolean(this.fields.find(t=>t[0]===e.fieldname&&e.parent===t[1]))}setup_columns(){let e=null;this.columns&&(e=this.get_column_widths()),this.columns=[],this.columns_map={};for(let t of this.fields){let i;t[0]!=="docstatus"?i=this.build_column(t):!this.fields.includes(["status",this.doctype])&&!frappe.meta.has_field(this.doctype,"status")&&(i=this.build_column(["docstatus",this.doctype])),i&&(e&&(i.width=e[i.id]||i.width||120),this.columns.push(i),this.columns_map[i.id]=i)}}build_column(e){let[t,i]=e,r=frappe.meta.docfield_map[i||this.doctype][t];if(t==="_aggregate_column"&&(r=this.group_by_control.get_group_by_docfield()),t==="idx"&&i!==this.doctype&&(r={label:"Index",fieldtype:"Int",parent:i}),r||(r=frappe.model.get_std_field(t,!0),r&&(r.label||(r.label=toTitle(t),r.label.includes("_")&&(r.label=r.label.replace("_"," "))),r.parent=this.doctype,t=="name"&&(r.options=this.doctype),t=="docstatus"&&!frappe.meta.has_field(this.doctype,"status")&&(r.label="Status",r.fieldtype="Data",r.name="status"))),!r||r.report_hide)return;let s=__(r.label);i!==this.doctype&&(s+=` (${__(i)})`);let a=frappe.model.is_non_std_field(t)&&!r.read_only&&!r.is_virtual,l=(()=>frappe.model.is_numeric_field(r)||r.fieldtype==="Date"?"right":"left")(),d=t;i!==this.doctype&&t!=="_aggregate_column"&&(d=`${i}:${t}`);let p=(r?cint(r.width):null)||null;this.report_doc&&(p=(this.report_doc.json.column_widths||{})[d]||p);let m=null;return r.fieldtype==="Date"&&(m=(f,b)=>{if(!f.content||b.length!==10)return null;let y=frappe.datetime.user_to_obj(b);return[+frappe.datetime.str_to_obj(f.content),+y]}),{id:d,field:t,name:s,content:s,docfield:r,width:p,editable:a,align:l,compareValue:m,format:(f,b,y,v)=>{let w=null;return Array.isArray(b)?w=b.reduce((E,I)=>(I.column.docfield&&(E[I.column.docfield.fieldname]=I.content),E),{}):w=b,frappe.format(f,y.docfield,{always_show_decimals:!0},w)}}}build_rows(e){let t=e.map(i=>this.build_row(i));if(this.add_totals_row){let i=this.get_columns_totals(e),r=this.columns.map((s,a)=>({name:__("Totals Row"),content:i[s.id],format:l=>{let d=frappe.format(l,s.docfield,{always_show_decimals:!0},e[0]);return a===0?this.format_total_cell(d,s):d}}));t.push(r)}return t}format_total_cell(e,t){let i=__("Totals").bold();return frappe.model.is_numeric_field(t.docfield)&&(i=`<span class="flex justify-between">
				${i} ${$(e).text()}
			</span>`),i}build_row(e){return this.columns.map(t=>{if(t.docfield.parent!==this.doctype){let i=s=>`${t.docfield.parent}:${s}`,r=e[i("name")];return{name:r,doctype:t.docfield.parent,content:e[i(t.field)]||e[t.field],editable:Boolean(r&&this.is_editable(t.docfield,e)),format:s=>frappe.format(s,t.docfield,{always_show_decimals:!0},e)}}if(t.field==="docstatus"&&!frappe.meta.has_field(this.doctype,"status")){let i=frappe.get_indicator(e,this.doctype);if(i){if(!i[0]){let r=i[2].split(",")[0];this.add_status_dependency_column(r,this.doctype)}return{name:e.name,doctype:t.docfield.parent,content:i[0],editable:!1}}else this.remove_column_from_datatable(t)}else if(t.field in e){let i=e[t.field];return{name:e.name,doctype:t.docfield.parent,content:i,editable:this.is_editable(t.docfield,e)}}return{content:""}})}get_checked_items(e){let i=this.datatable.rowmanager.getCheckedRows().map(r=>this.data[r]).filter(r=>r!=null);return e?i.map(r=>r.name):i}save_report(e){let t=i=>{let r={filters:this.filter_area.get(),fields:this.fields,order_by:this.sort_selector.get_sql_string(),add_totals_row:this.add_totals_row,page_length:this.page_length,column_widths:this.get_column_widths(),group_by:this.group_by_control.get_settings(),chart_args:this.get_chart_settings()};return frappe.call({method:"frappe.desk.reportview.save_report",args:{name:i,doctype:this.doctype,report_settings:JSON.stringify(r)},callback:s=>{if(s.exc){frappe.msgprint(__("Report was not saved (there were errors)"));return}if(s.message!=this.report_name){frappe.boot.user.all_reports[s.message]={ref_doctype:this.doctype,report_type:"Report Builder",title:s.message},frappe.set_route("List",this.doctype,"Report",s.message);return}this.report_doc.json=r,this.set_dirty_state_for_custom_report()}})};this.report_name&&e=="save"?t(this.report_name):frappe.prompt({fieldname:"name",label:__("New Report name"),reqd:1,fieldtype:"Data"},i=>{t(i.name)},__("Save As"))}delete_report(){return frappe.call({method:"frappe.desk.reportview.delete_report",args:{name:this.report_name},callback(e){e.exc||window.history.back()}})}get_column_widths(){return this.datatable?this.datatable.datamanager.getColumns(!0).reduce((e,t)=>(e[t.id]=parseInt(t.width),e),{}):{}}get_report_doc(){return new Promise(e=>{frappe.model.with_doc("Report",this.report_name,()=>{e(frappe.get_doc("Report",this.report_name))})})}get_filters_html_for_print(){return this.filter_area.get().map(t=>{let[i,r,s,a]=t;if(s!=="=")return"";let l=frappe.meta.get_label(i,r);return`<h6>${__(l)}: ${a}</h6>`}).join("")}get_columns_totals(e){if(!this.add_totals_row)return[];let t={};return this.columns.forEach((i,r)=>{let s=e.reduce((a,l)=>{if(i.id in l&&frappe.model.is_numeric_field(i.docfield))return a+=flt(l[i.id]),a},0);t[i.id]=s}),t}report_menu_items(){let e=[{label:__("Show Totals"),action:()=>{this.add_totals_row=!this.add_totals_row,this.save_view_user_settings({add_totals_row:this.add_totals_row}),this.datatable.refresh(this.get_data(this.data))}},{label:__("Print"),action:()=>{let i=this.datatable.datamanager.rowViewOrder.map(r=>{if(this.datatable.bodyRenderer.visibleRowIndices.includes(r))return this.data[r]}).filter(Boolean);if(this.add_totals_row){let r=this.get_columns_totals(this.data);r.name=__("Totals").bold(),i.push(r)}frappe.ui.get_print_settings(!1,r=>{var s=this.report_name||__(this.doctype);frappe.render_grid({title:s,subtitle:this.get_filters_html_for_print(),print_settings:r,columns:this.columns,data:i})})}},{label:__("Toggle Chart"),action:()=>this.toggle_charts()},{label:__("Toggle Sidebar"),action:()=>this.toggle_side_bar(),shortcut:"Ctrl+K"},{label:__("Pick Columns"),action:()=>{let i=new frappe.ui.Dialog({title:__("Pick Columns"),fields:this.get_dialog_fields(),primary_action:r=>{let s=r[this.doctype].map(a=>[a,this.doctype]);delete r[this.doctype];for(let a in r)s=s.concat(r[a].map(l=>[l,a]));this.fields=[["name",this.doctype],...s],this.fields.map(a=>this.add_currency_column(a[0],a[1])),this.reorder_fields(),this.build_fields(),this.setup_columns(),this.datatable.destroy(),this.datatable=null,this.refresh(),i.hide()}});i.$body.prepend(`
						<div class="columns-search">
							<input type="text" placeholder="${__("Search")}" data-element="search" class="form-control input-xs">
						</div>
					`),frappe.utils.setup_search(i.$body,".unit-checkbox",".label-area"),i.show()}}];frappe.model.can_export(this.doctype)&&e.push({label:__("Export"),action:()=>{let i=this.get_args(),r=this.get_checked_items(!0),s=[{fieldtype:"Select",label:__("Select File Type"),fieldname:"file_format_type",options:["Excel","CSV"],default:"Excel"}];(this.total_count>this.count_without_children||i.page_length)&&s.push({fieldtype:"Check",fieldname:"export_all_rows",label:__("Export All {0} rows?",[(this.total_count+"").bold()])});let a=new frappe.ui.Dialog({title:__("Export Report: {0}",[__(this.doctype)]),fields:s,primary_action_label:__("Download"),primary_action:l=>{i.cmd="frappe.desk.reportview.export_query",i.file_format_type=l.file_format_type,i.title=this.report_name||this.doctype,this.add_totals_row&&(i.add_totals_row=1),r.length>0&&(i.selected_items=r),l.export_all_rows?(delete i.start,delete i.page_length):(i.start=0,i.page_length=this.data.length),open_url_post(frappe.request.url,i),a.hide()}});a.show()}}),e.push({label:__("Setup Auto Email"),action:()=>{this.report_name?frappe.set_route("List","Auto Email Report",{report:this.report_name}):frappe.msgprint(__("Please save the report first"))}});let t=i=>{let r=i=="delete"?"can_delete":"can_write";return this.report_doc&&this.report_doc.is_standard!=="Yes"&&(frappe.model[r]("Report")||this.report_doc.owner===frappe.session.user)};return t()&&e.push({label:__("Save"),action:()=>this.save_report("save")}),e.push({label:__("Save As"),action:()=>this.save_report("save_as")}),t("delete")&&e.push({label:__("Delete"),action:()=>frappe.confirm("Are you sure you want to delete this report?",()=>this.delete_report()),shortcut:"Shift+Ctrl+D"}),this.report_name&&frappe.model.can_set_user_permissions("Report")&&e.push({label:__("User Permissions"),action:()=>{let i={doctype:"Report",name:this.report_name};frappe.set_route("List","User Permission",i)}}),e.map(i=>Object.assign(i,{standard:!0}))}};var fi=_t(Ct());frappe.provide("frappe.widget.utils");frappe.provide("frappe.views");frappe.provide("frappe.query_reports");frappe.standard_pages["query-report"]=function(){var o=frappe.container.add_page("query-report");frappe.ui.make_app_page({parent:o,title:__("Query Report"),single_column:!0}),frappe.query_report=new frappe.views.QueryReport({parent:o}),$(o).bind("show",function(){frappe.query_report.show()})};frappe.views.QueryReport=class extends frappe.views.BaseList{show(){this.init().then(()=>this.load())}init(){if(this.init_promise)return this.init_promise;let e=[this.setup_defaults,this.setup_page,this.setup_report_wrapper,this.setup_events].map(t=>t.bind(this));return this.init_promise=frappe.run_serially(e),this.init_promise}setup_defaults(){this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.primary_action=null,this.refresh=frappe.utils.throttle(this.refresh,300),this.menu_items=[]}set_default_secondary_action(){this.refresh_button&&this.refresh_button.remove(),this.refresh_button=this.page.add_action_icon("refresh",()=>{this.setup_progress_bar(),this.refresh()})}get_no_result_message(){return`<div class="msg-box no-border">
			<div>
				<img src="/assets/frappe/images/ui-states/list-empty-state.svg" alt="Generic Empty State" class="null-state">
			</div>
			<p>${__("Nothing to show")}</p>
		</div>`}setup_events(){frappe.realtime.on("report_generated",e=>{if(this.toggle_primary_button_disabled(!1),e.report_name)if(this.prepared_report_action="Rebuild",e.name==this.prepared_report_doc_name)this.refresh();else{let t=`Report ${this.report_name} generated.
						<a href="#query-report/${this.report_name}/?prepared_report_name=${e.name}">View</a>`;frappe.show_alert({message:t,indicator:"orange"})}}),this.page.wrapper.on("click","[data-action]",e=>{let t=$(e.currentTarget).data("action"),i=this[t];i.call&&i.call(this,e)})}load(){if(frappe.get_route().length<2){this.toggle_nothing_to_show(!0);return}let e={};e=Object.assign(e,frappe.route_options),this.report_name!==frappe.get_route()[1]?this.load_report(e):frappe.has_route_options()&&this.refresh_report(e)}load_report(e){this.page.clear_inner_toolbar(),this.route=frappe.get_route(),this.page_name=frappe.get_route_str(),this.report_name=this.route[1],this.page_title=__(this.report_name),this.show_save=!1,this.menu_items=this.get_menu_items(),this.datatable=null,this.prepared_report_action="New",frappe.run_serially([()=>this.get_report_doc(),()=>this.get_report_settings(),()=>this.setup_progress_bar(),()=>this.setup_page_head(),()=>this.refresh_report(e),()=>this.add_chart_buttons_to_toolbar(!0),()=>this.add_card_button_to_toolbar(!0)])}add_card_button_to_toolbar(){this.page.add_inner_button(__("Create Card"),()=>{this.add_card_to_dashboard()})}add_chart_buttons_to_toolbar(e){e?(this.create_chart_button&&this.create_chart_button.remove(),this.create_chart_button=this.page.add_button(__("Set Chart"),()=>{this.open_create_chart_dialog()}),(this.chart_fields||this.chart_options)&&(this.add_to_dashboard_button&&this.add_to_dashboard_button.remove(),this.add_to_dashboard_button=this.page.add_button(__("Add Chart to Dashboard"),()=>{this.add_chart_to_dashboard()}))):(this.create_chart_button&&this.create_chart_button.remove(),this.add_to_dashboard_button&&this.add_to_dashboard_button.remove())}add_card_to_dashboard(){let e=frappe.report_utils.get_field_options_from_report(this.columns,this.raw_data),t=frappe.dashboard_utils.get_dashboard_link_field(),i=frappe.boot.developer_mode,r=new frappe.ui.Dialog({title:__("Create Card"),fields:[{fieldname:"report_field",label:__("Field"),fieldtype:"Select",options:e.numeric_fields},{fieldname:"cb_1",fieldtype:"Column Break"},{fieldname:"report_function",label:__("Function"),options:["Sum","Average","Minimum","Maximum"],fieldtype:"Select"},{fieldname:"sb_1",label:__("Add to Dashboard"),fieldtype:"Section Break"},t,{fieldname:"cb_2",fieldtype:"Column Break"},{fieldname:"label",label:__("Card Label"),fieldtype:"Data"}],primary_action_label:__("Add"),primary_action:s=>{s.label||(s.label=`${s.report_function} of ${toTitle(s.report_field)}`),this.create_number_card(s,s.dashboard,s.label,i),r.hide()}});r.show()}add_chart_to_dashboard(){if(this.chart_fields||this.chart_options){let e=frappe.dashboard_utils.get_dashboard_link_field(),t=frappe.boot.developer_mode,i=new frappe.ui.Dialog({title:__("Create Chart"),fields:[{fieldname:"dashboard_chart_name",label:"Chart Name",fieldtype:"Data"},e],primary_action_label:__("Add"),primary_action:r=>{this.create_dashboard_chart(this.chart_fields||this.chart_options,r.dashboard,r.dashboard_chart_name,t),i.hide()}});i.show()}else frappe.msgprint(__("Please Set Chart"))}create_number_card(e,t,i,r){let s={dashboard:t||null,type:"Report",report_name:this.report_name,filters_json:JSON.stringify(this.get_filter_values()),set_standard:r};Object.assign(s,e),this.add_to_dashboard("frappe.desk.doctype.number_card.number_card.create_report_number_card",s,t,i,"Number Card")}create_dashboard_chart(e,t,i,r){let s={dashboard:t||null,chart_type:"Report",report_name:this.report_name,type:e.chart_type||frappe.model.unscrub(e.type),color:e.color,filters_json:JSON.stringify(this.get_filter_values()),custom_options:{},set_standard:r};for(let a in e)a!="data"&&(s.custom_options[a]=e[a]);if(this.chart_fields){let a=toTitle(e.x_field),l=toTitle(e.y_fields[0]);i=i||`${this.report_name}: ${a} vs ${l}`,Object.assign(s,{chart_name:i,x_field:e.x_field,y_axis:e.y_axis_fields.map(d=>({y_field:d.y_field,color:d.color})),use_report_chart:0})}else i=i||this.report_name,Object.assign(s,{chart_name:i,use_report_chart:1});this.add_to_dashboard("frappe.desk.doctype.dashboard_chart.dashboard_chart.create_report_chart",s,t,i,"Dashboard Chart")}add_to_dashboard(e,t,i,r,s){frappe.xcall(e,{args:t}).then(()=>{let a;if(i){let l=`<a href="#dashboard-view/${i}">${i}</a>`;a=__("New {0} {1} added to Dashboard {2}",[__(s),r,l])}else a=__("New {0} {1} created",[__(s),r]);frappe.msgprint(a,__("New {0} Created",[__(s)]))})}refresh_report(e){return this.toggle_message(!0),this.toggle_report(!1),frappe.run_serially([()=>this.setup_filters(),()=>this.set_route_filters(e),()=>this.page.clear_custom_actions(),()=>this.report_settings.onload&&this.report_settings.onload(this),()=>this.refresh()])}get_report_doc(){return frappe.model.with_doc("Report",this.report_name).then(e=>{this.report_doc=e}).then(()=>frappe.model.with_doctype(this.report_doc.ref_doctype))}get_report_settings(){return new Promise((e,t)=>{frappe.query_reports[this.report_name]?(this.report_settings=frappe.query_reports[this.report_name],e()):frappe.xcall("frappe.desk.query_report.get_script",{report_name:this.report_name}).then(i=>{frappe.dom.eval(i.script||""),frappe.after_ajax(()=>{this.report_settings=this.get_local_report_settings(),this.report_settings.html_format=i.html_format,this.report_settings.execution_time=i.execution_time||0,frappe.query_reports[this.report_name]=this.report_settings,this.report_doc.filters&&!this.report_settings.filters&&(this.report_settings.filters=this.report_doc.filters),e()})}).catch(t)})}get_local_report_settings(){let e=this.report_doc.report_type==="Custom Report"?this.report_doc.reference_report:this.report_name;return frappe.query_reports[e]||{}}setup_progress_bar(){let e=0,t=this.report_settings.execution_time||0;t<5||(this.interval=setInterval(function(){e+=1,frappe.show_progress(__("Preparing Report"),e,t)},1e3))}refresh_filters_dependency(){this.filters.forEach(e=>{e.guardian_has_value=!0,e.df.depends_on&&(e.guardian_has_value=this.evaluate_depends_on_value(e.df.depends_on,e.df.label),e.guardian_has_value?e.df.hidden_due_to_dependency&&(e.df.hidden_due_to_dependency=!1,this.toggle_filter_display(e.df.fieldname,!1)):e.df.hidden_due_to_dependency||(e.df.hidden_due_to_dependency=!0,this.toggle_filter_display(e.df.fieldname,!0),e.set_value(e.df.default||null)))})}evaluate_depends_on_value(e,t){let i=null,r=this.get_filter_values();if(r)if(typeof e=="boolean")i=e;else if(e.substr(0,5)=="eval:")try{i=frappe.utils.eval(e.substr(5),{doc:r})}catch(a){frappe.throw(__('Invalid "depends_on" expression set in filter {0}',[t]))}else{var s=r[e];$.isArray(s)?i=!!s.length:i=!!s}return i}setup_filters(){this.clear_filters();let{filters:e=[]}=this.report_settings,t=this.page.page_form;this.filters=e.map(i=>{if(i.fieldtype==="Break")return;let r=this.page.add_field(i,t);return i.default&&r.set_input(i.default),i.get_query&&(r.get_query=i.get_query),i.on_change&&(r.on_change=i.on_change),i.onchange=()=>{this.refresh_filters_dependency();let s=this.get_filter_values();this.previous_filters&&JSON.stringify(this.previous_filters)===JSON.stringify(s)||(this.previous_filters=s,setTimeout(()=>this.previous_filters=null,1e4),r.on_change?r.on_change(this):this.prepared_report?this.reset_report_view():this._no_refresh||this.refresh())},r=Object.assign(r,i),r}).filter(Boolean),this.refresh_filters_dependency(),this.filters.length===0?this.page.hide_form():this.page.show_form()}set_filters(e){this.filters.map(t=>{t.set_input(e[t.fieldname])})}set_route_filters(e){if(e||(e=frappe.route_options),e){let t=Object.keys(e),r=this.filters.filter(s=>t.includes(s.df.fieldname)).map(s=>()=>{let a=e[s.df.fieldname];s.set_value(a)});return r.push(()=>{frappe.route_options=null}),frappe.run_serially(r)}}clear_filters(){this.page.clear_fields()}refresh(){this.toggle_message(!0),this.toggle_report(!1),this.show_loading_screen();let e=this.get_filter_values(!0);this.last_ajax&&this.last_ajax.abort();let t=this.get_query_params();return t.prepared_report_name&&(e.prepared_report_name=t.prepared_report_name),new Promise(i=>{this.last_ajax=frappe.call({method:"frappe.desk.query_report.run",type:"GET",args:{report_name:this.report_name,filters:e,is_tree:this.report_settings.tree,parent_field:this.report_settings.parent_field},callback:i,always:()=>this.page.btn_secondary.prop("disabled",!1)})}).then(i=>{let r=i.message;if(this.hide_status(),clearInterval(this.interval),this.execution_time=r.execution_time||.1,r.prepared_report){if(this.prepared_report=!0,t.prepared_report_name){this.prepared_report_action="Edit";let s=JSON.parse(r.doc.filters);Object.values(this.filters).forEach(function(a){s[a.fieldname]&&a.set_input(s[a.fieldname]),a.input&&(a.input.disabled=!0)})}this.add_prepared_report_buttons(r.doc)}r.report_summary&&(this.$summary.empty(),this.render_summary(r.report_summary)),r.message&&!r.prepared_report&&this.show_status(r.message),this.toggle_message(!1),r.result&&r.result.length?(this.prepare_report_data(r),this.chart_options=this.get_chart_options(r),this.$chart.empty(),this.chart_options?this.render_chart(this.chart_options):(this.$chart.empty(),this.chart_fields&&(this.chart_options=frappe.report_utils.make_chart_options(this.columns,this.raw_data,this.chart_fields),this.chart_options&&this.render_chart(this.chart_options))),this.render_datatable(),this.add_chart_buttons_to_toolbar(!0),this.add_card_button_to_toolbar(),this.$report.show()):(this.data=[],this.toggle_nothing_to_show(!0),this.add_chart_buttons_to_toolbar(!1)),this.show_footer_message(),frappe.hide_progress()}).finally(()=>{this.hide_loading_screen()})}render_summary(e){e.forEach(t=>{frappe.utils.build_summary_item(t).appendTo(this.$summary)}),this.$summary.show()}get_query_params(){let e=frappe.utils.get_query_string(frappe.get_route_str());return frappe.utils.get_query_params(e)}add_prepared_report_buttons(e){if(e){this.page.add_inner_button(__("Download Report"),function(){window.open(frappe.urllib.get_full_url("/api/method/frappe.core.doctype.prepared_report.prepared_report.download_attachment?dn="+encodeURIComponent(e.name)))});let i=__("This report was generated {0}.",[frappe.datetime.comment_when(e.report_end_time)]),r=__("To get the updated report, click on {0}.",[__("Rebuild")]),s=__("See all past reports.");this.show_status(`
				<div class="indicator orange">
					<span>
						${i}
						${r}
						<a href="/app/List/Prepared%20Report?report_name=${this.report_name}"> ${s}</a>
					</span>
				</div>
			`)}this.primary_action_map={New:{label:__("Generate New Report"),click:()=>{this.show_warning_or_generate_report()}},Edit:{label:__("Edit"),click:()=>{frappe.set_route(frappe.get_route())}},Rebuild:{label:__("Rebuild"),click:()=>{this.show_warning_or_generate_report()}}};let t=this.primary_action_map[this.prepared_report_action];(!this.primary_button||this.primary_button.text()!==t.label)&&(this.primary_button=this.page.set_primary_action(t.label,t.click))}toggle_primary_button_disabled(e){this.primary_button.prop("disabled",e)}show_warning_or_generate_report(){frappe.xcall("frappe.core.doctype.prepared_report.prepared_report.get_reports_in_queued_state",{filters:this.get_filter_values(),report_name:this.report_name}).then(e=>{if(this.queued_prepared_reports=e,e.length){let t=this.get_queued_prepared_reports_warning_message(e);this.prepared_report_dialog=frappe.warn(__("Reports already in Queue"),t,()=>this.generate_background_report(),__("Proceed Anyway"),!0),this.prepared_report_dialog.footer.prepend(`
					<button type="button" class="btn btn-sm btn-default pull-left" data-action="delete_old_queued_reports">
						${__("Delete and Generate New")}
					</button>`),frappe.utils.bind_actions_with_object(this.prepared_report_dialog.wrapper,this)}else this.generate_background_report()})}get_queued_prepared_reports_warning_message(e){let t=`/app/List/Prepared Report/List?status=Queued&report_name=${this.report_name}`,i=e.length==1?`<a class="underline" href="${t}">${__("1 Report")}</a>`:`<a class="underline" href="${t}">${__("{0} Reports",[e.length])}</a>`,r=e.length==1?`${__("There is {0} with the same filters already in the queue:",[i])}`:`${__("There are {0} with the same filters already in the queue:",[i])}`,s=`
			<p>
				${__("Are you sure you want to generate a new report?")}
				${r}
			</p>`,a=l=>`<a class="underline" href="/app/prepared-report/${l.name}">${l.name}</a>`;return s+=e.map(a).join(", "),s}delete_old_queued_reports(){this.prepared_report_dialog.hide(),frappe.xcall("frappe.core.doctype.prepared_report.prepared_report.delete_prepared_reports",{reports:this.queued_prepared_reports}).then(()=>this.generate_background_report())}generate_background_report(){if(this.toggle_primary_button_disabled(!0),!this.filters.filter(i=>i.df.reqd).filter(i=>!i.get_value()).length){let i=this.get_filter_values(!0);return new Promise(r=>frappe.call({method:"frappe.desk.query_report.background_enqueue_run",type:"GET",args:{report_name:this.report_name,filters:i},callback:r})).then(r=>{let s=r.message;this.prepared_report_doc_name=s.name;let a=`<a href='/app/prepared-report/${s.name}'>`+__("Report initiated, click to view status")+"</a>";frappe.show_alert({message:a,indicator:"orange"},10),this.toggle_nothing_to_show(!0)})}}prepare_report_data(e){this.raw_data=e,this.columns=this.prepare_columns(e.columns),this.custom_columns=[],this.data=this.prepare_data(e.result),this.linked_doctypes=this.get_linked_doctypes(),this.tree_report=this.data.some(t=>"indent"in t)}render_datatable(){let e=this.data,t=this.columns.filter(i=>!i.hidden);if(this.raw_data.add_total_row&&!this.report_settings.tree&&(e=e.slice(),e.splice(-1,1)),this.$report.show(),this.datatable&&this.datatable.options&&this.datatable.options.showTotalRow===this.raw_data.add_total_row)this.datatable.options.treeView=this.tree_report,this.datatable.refresh(e,t);else{let i={columns:t,data:e,inlineFilters:!0,language:frappe.boot.lang,translations:frappe.utils.datatable.get_translations(),treeView:this.tree_report,layout:"fixed",cellHeight:33,showTotalRow:this.raw_data.add_total_row&&!this.report_settings.tree,direction:frappe.utils.is_rtl()?"rtl":"ltr",hooks:{columnTotal:frappe.utils.report_column_total}};this.report_settings.get_datatable_options&&(i=this.report_settings.get_datatable_options(i)),this.datatable=new fi.default(this.$report[0],i)}typeof this.report_settings.initial_depth=="number"&&this.datatable.rowmanager.setTreeDepth(this.report_settings.initial_depth),this.report_settings.after_datatable_render&&this.report_settings.after_datatable_render(this.datatable)}show_loading_screen(){let e=`<div class="msg-box no-border">
			<div>
				<img src="/assets/frappe/images/ui-states/list-empty-state.svg" alt="Generic Empty State" class="null-state">
			</div>
			<p>${__("Loading")}...</p>
		</div>`;this.$loading.find("div").html(e),this.$report.hide(),this.$loading.show()}hide_loading_screen(){this.$loading.hide()}get_chart_options(e){let t=this.report_settings.get_chart_data?this.report_settings.get_chart_data(e.columns,e.result):e.chart?e.chart:void 0;if(!!(t&&t.data&&t.data.labels&&t.data.labels.length>0))return t.fieldtype&&(t.tooltipOptions={formatTooltipY:i=>frappe.format(i,{fieldtype:t.fieldtype,options:t.options})}),t.axisOptions={shortenYAxisNumbers:1},t.height=280,t}render_chart(e){this.$chart.empty(),this.$chart.show(),this.chart=new frappe.Chart(this.$chart[0],e)}open_create_chart_dialog(){let e=this,t=frappe.report_utils.get_field_options_from_report(this.columns,this.raw_data);function i(a){return a.y_fields=[],a.colors=[],a.y_axis_fields&&a.y_axis_fields.map(l=>{a.y_fields.push(l.y_field),a.colors.push(l.color)}),a.y_fields=a.y_fields.map(l=>l.trim()).filter(Boolean),a}function r(){let a=$(s.fields_dict.chart_preview.wrapper),l=s.get_values(!0);if(l=i(l),l.x_field&&l.y_fields.length){let d=frappe.report_utils.make_chart_options(e.columns,e.raw_data,l);e.chart_fields=l,a.empty(),new frappe.Chart(a[0],d),a.find(".chart-container .title, .chart-container .sub-title").hide(),a.show(),s.fields_dict.create_dashoard_chart.df.hidden=0,s.refresh()}else a[0].innerHTML=`<div class="flex justify-center align-center text-muted" style="height: 120px; display: flex;">
					<div>${__("Please select X and Y fields")}</div>
				</div>`}let s=new frappe.ui.Dialog({title:__("Create Chart"),fields:[{fieldname:"x_field",label:"X Field",fieldtype:"Select",default:e.chart_fields?e.chart_fields.x_field:null,options:t.non_numeric_fields},{fieldname:"cb_1",fieldtype:"Column Break"},{fieldname:"chart_type",label:"Type of Chart",fieldtype:"Select",options:["Bar","Line","Percentage","Pie","Donut"],default:e.chart_fields?e.chart_fields.chart_type:"Bar"},{fieldname:"sb_1",fieldtype:"Section Break",label:"Y axis"},{fieldname:"y_axis_fields",fieldtype:"Table",fields:[{fieldtype:"Select",fieldname:"y_field",name:"y_field",label:__("Y Field"),options:t.numeric_fields,in_list_view:1},{fieldtype:"Color",fieldname:"color",name:"color",label:__("Color"),in_list_view:1}]},{fieldname:"preview_chart_button",fieldtype:"Button",label:"Preview Chart",click:r},{fieldname:"sb_2",fieldtype:"Section Break",label:"Chart Preview"},{fieldname:"chart_preview",label:"Chart Preview",fieldtype:"HTML"},{fieldname:"create_dashoard_chart",label:"Add Chart to Dashboard",fieldtype:"Button",hidden:1,click:()=>{s.hide(),this.add_chart_to_dashboard()}}],primary_action_label:__("Create"),primary_action:a=>{a=i(a);let l=frappe.report_utils.make_chart_options(this.columns,this.raw_data,a);e.chart_fields=a;let d=t.numeric_fields.filter(m=>m.value==a.y_fields[0])[0].label,p=t.non_numeric_fields.filter(m=>m.value==a.x_field)[0].label;l.title=__("{0}: {1} vs {2}",[this.report_name,d,p]),this.render_chart(l),this.add_chart_buttons_to_toolbar(!0),s.hide()}});s.show(),setTimeout(r,500)}prepare_columns(e){return e.map(t=>{t=frappe.report_utils.prepare_field_from_column(t);let i=(s,a,l,d)=>{if(l.isHeader&&!d&&this.data){let p=1;if(this.report_settings.get_datatable_options){let m=this.report_settings.get_datatable_options({});m&&m.checkboxColumn&&(p=2)}l.colIndex===p&&!s?(s="Total",l={fieldtype:"Data"}):in_list(["Currency","Float"],l.fieldtype)&&(d=this.data[0])}return frappe.format(s,l,{for_print:!1,always_show_decimals:!0},d)},r=null;return t.fieldtype==="Date"&&(r=(s,a)=>{if(!s.content||a.length!==10)return null;let l=frappe.datetime.user_to_obj(a);return[+frappe.datetime.str_to_obj(s.content),+l]}),Object.assign(t,{id:t.fieldname,name:__(t.label,null,`Column of report '${this.report_name}'`),width:parseInt(t.width)||null,editable:!1,compareValue:r,format:(s,a,l,d)=>this.report_settings.formatter?this.report_settings.formatter(s,a,l,d,i):i(s,a,l,d)})})}prepare_data(e){return e.map(t=>{let i={};return Array.isArray(t)?(this.columns.forEach((r,s)=>{i[r.id]=t[s]}),i):t})}get_visible_columns(){return this.datatable.datamanager.getColumns(!0).map(t=>t.id).map(t=>this.columns.find(i=>i.id===t)).filter(Boolean)}get_filter_values(e){let i=this.filters.filter(s=>s.df.reqd||s.df.mandatory).filter(s=>!s.get_value());if(e&&i.length>0){let s=__("Please set filters");throw this.toggle_message(e,s),"Filter missing"}return this.filters.filter(s=>s.get_value()).map(s=>{var a=s.get_value();return s.df.hidden&&(a=s.value),a==="%"&&(a=null),s.df.wildcard_filter&&(a=`%${a}%`),{[s.df.fieldname]:a}}).reduce((s,a)=>(Object.assign(s,a),s),{})}get_filter(e){let t=(this.filters||[]).find(i=>i.df.fieldname===e);return t||console.warn(`[Query Report] Invalid filter: ${e}`),t}get_filter_value(e){let t=this.get_filter(e);return t?t.get_value():null}set_filter_value(e,t){let i={};typeof e=="string"?i[e]=t:i=e,this._no_refresh=!0,Object.keys(i).forEach((r,s,a)=>{let l=i[r];s===a.length-1&&(this._no_refresh=!1),this.get_filter(r).set_value(l)})}set_breadcrumbs(){if(!this.report_doc||!this.report_doc.ref_doctype)return;let e=frappe.get_meta(this.report_doc.ref_doctype);frappe.breadcrumbs.add(e.module)}make_access_log(e,t){frappe.call("frappe.core.doctype.access_log.access_log.make_access_log",{doctype:this.doctype||"",report_name:this.report_name,filters:this.get_filter_values(),file_type:t,method:e})}print_report(e){let t=this.report_settings.html_format||null,i=this.get_filters_html_for_print(),r=e.orientation=="Landscape";this.make_access_log("Print","PDF"),frappe.render_grid({template:e.columns?"print_grid":t,title:__(this.report_name),subtitle:i,print_settings:e,landscape:r,filters:this.get_filter_values(),data:this.get_data_for_print(),columns:this.get_columns_for_print(e,t),original_data:this.data,report:this})}pdf_report(e){let t=frappe.urllib.get_base_url(),i=frappe.boot.print_css,r=e.orientation=="Landscape",s=this.report_settings.html_format||null,a=this.get_columns_for_print(e,s),l=this.get_data_for_print(),d=this.get_filter_values(),p=this.get_filters_html_for_print(),m=e.columns||!s?"print_grid":s,f=frappe.render_template(m,{title:__(this.report_name),subtitle:p,filters:d,data:l,original_data:this.data,columns:a,report:this}),b=frappe.render_template("print_template",{title:__(this.report_name),content:f,base_url:t,print_css:i,print_settings:e,landscape:r,columns:a,lang:frappe.boot.lang,layout_direction:frappe.utils.is_rtl()?"rtl":"ltr"});frappe.render_pdf(b,e)}get_filters_html_for_print(){let e=this.get_filter_values();return Object.keys(e).map(t=>{let i=frappe.query_report.get_filter(t).df.label,r=e[t];return`<h6>${__(i)}: ${r}</h6>`}).join("")}export_report(){if(this.export_dialog){this.export_dialog.clear(),this.export_dialog.show();return}let e=[{label:__("Select File Format"),fieldname:"file_format",fieldtype:"Select",options:["Excel","CSV"],default:"Excel",reqd:1}];this.tree_report&&e.push({label:__("Include indentation"),fieldname:"include_indentation",fieldtype:"Check"}),this.export_dialog=frappe.prompt(e,({file_format:t,include_indentation:i})=>{if(this.make_access_log("Export",t),t==="CSV"){let r=this.columns.reduce((l,d)=>(d.hidden||l.push(__(d.label)),l),[]),s=this.get_data_for_csv(i),a=[r].concat(s);frappe.tools.downloadify(a,null,this.report_name)}else{let r=this.get_filter_values(!0);frappe.urllib.get_dict("prepared_report_name")&&(r=Object.assign(frappe.urllib.get_dict("prepared_report_name"),r));let s=this.datatable.bodyRenderer.visibleRowIndices;s.length+1===this.data.length&&s.push(s.length);let a={cmd:"frappe.desk.query_report.export_query",report_name:this.report_name,custom_columns:this.custom_columns.length?this.custom_columns:[],file_format_type:t,filters:r,visible_idx:s,include_indentation:i};open_url_post(frappe.request.url,a)}},__("Export Report: {0}",[this.report_name]),__("Download"))}get_data_for_csv(e){let t=this.datatable.bodyRenderer.visibleRows;return this.raw_data.add_total_row&&t.push(this.datatable.bodyRenderer.getTotalRow()),t.map(i=>{let r=this.datatable.datamanager.getStandardColumnCount();return i.slice(r).map((s,a)=>(s.column.fieldtype==="Duration"&&(s.content=frappe.utils.get_formatted_duration(s.content)),e&&a===0&&(s.content="   ".repeat(i.meta.indent)+(s.content||"")),s.content||""))})}get_data_for_print(){if(!this.data.length)return[];let e=this.datatable.datamanager.rowViewOrder.map(t=>{if(this.datatable.bodyRenderer.visibleRowIndices.includes(t))return this.data[t]}).filter(Boolean);if(this.raw_data.add_total_row){let t=this.datatable.bodyRenderer.getTotalRow().reduce((i,r)=>(i[r.column.id]=r.content,i.is_total_row=!0,i),{});e.push(t)}return e}get_columns_for_print(e,t){let i=[];return e&&e.columns?i=this.get_visible_columns().filter(r=>e.columns.includes(r.fieldname)):i=t?this.columns:this.get_visible_columns(),i}get_menu_items(){let e=[{label:__("Refresh"),action:()=>this.refresh(),class:"visible-xs"},{label:__("Edit"),action:()=>frappe.set_route("Form","Report",this.report_name),condition:()=>frappe.user.is_report_manager(),standard:!0},{label:__("Print"),action:()=>{let t=frappe.ui.get_print_settings(!1,i=>this.print_report(i),this.report_doc.letter_head,this.get_visible_columns());this.add_portrait_warning(t)},condition:()=>frappe.model.can_print(this.report_doc.ref_doctype),standard:!0},{label:__("PDF"),action:()=>{let t=frappe.ui.get_print_settings(!1,i=>this.pdf_report(i),this.report_doc.letter_head,this.get_visible_columns());this.add_portrait_warning(t)},condition:()=>frappe.model.can_print(this.report_doc.ref_doctype),standard:!0},{label:__("Export"),action:()=>this.export_report(),condition:()=>frappe.model.can_export(this.report_doc.ref_doctype),standard:!0},{label:__("Setup Auto Email"),action:()=>frappe.set_route("List","Auto Email Report",{report:this.report_name}),standard:!0},{label:__("Add Column"),action:()=>{let t=new frappe.ui.Dialog({title:__("Add Column"),fields:[{fieldtype:"Select",fieldname:"doctype",label:__("From Document Type"),options:this.linked_doctypes.map(i=>({label:i.doctype,value:i.doctype})),change:()=>{let i=t.get_value("doctype");frappe.model.with_doctype(i,()=>{let r=frappe.meta.get_docfields(i).filter(frappe.model.is_value_type).map(s=>({label:s.label,value:s.fieldname}));t.set_df_property("field","options",r.sort(function(s,a){return s.label<a.label?-1:s.label>a.label?1:0}))})}},{fieldtype:"Select",label:__("Field"),fieldname:"field",options:[]},{fieldtype:"Select",label:__("Insert After"),fieldname:"insert_after",options:this.columns.map(i=>i.label)}],primary_action:i=>{let r=[],s=frappe.meta.get_docfield(i.doctype,i.field),a=this.columns.findIndex(l=>l.label===i.insert_after);r.push({fieldname:s.fieldname,fieldtype:s.fieldtype,label:s.label,insert_after_index:a,link_field:this.doctype_field_map[i.doctype],doctype:i.doctype,options:s.options,width:100}),this.custom_columns=this.custom_columns.concat(r),frappe.call({method:"frappe.desk.query_report.get_data_for_custom_field",args:{field:i.field,doctype:i.doctype},callback:l=>{let d=l.message,p=this.doctype_field_map[i.doctype];this.add_custom_column(r,d,p,i.field,a),t.hide()}}),this.set_menu_items()}});t.show()},standard:!0},{label:__("User Permissions"),action:()=>frappe.set_route("List","User Permission",{doctype:"Report",name:this.report_name}),condition:()=>frappe.model.can_set_user_permissions("Report"),standard:!0}];return frappe.user.is_report_manager()&&e.push({label:__("Save"),action:()=>{let t=new frappe.ui.Dialog({title:__("Save Report"),fields:[{fieldtype:"Data",fieldname:"report_name",label:__("Report Name"),default:this.report_doc.is_standard=="No"?this.report_name:"",reqd:!0}],primary_action:i=>{frappe.call({method:"frappe.desk.query_report.save_report",args:{reference_report:this.report_name,report_name:i.report_name,columns:this.get_visible_columns()},callback:function(r){this.show_save=!1,t.hide(),frappe.set_route("query-report",r.message)}})}});t.show()},standard:!0}),e}add_portrait_warning(e){this.columns.length>10&&e.set_df_property("orientation","change",()=>{let i=e.get_value("orientation")==="Portrait"?__("Report with more than 10 columns looks better in Landscape mode."):"";e.set_df_property("orientation","description",i)})}add_custom_column(e,t,i,r,s){let a=this.prepare_columns(e);this.columns.splice(s+1,0,a[0]),this.data.forEach(l=>{l[r]=t[l[i]]}),this.render_datatable()}get_linked_doctypes(){let e=[],t=[],i=new Set;return this.doctype_field_map={},this.columns.forEach(r=>{r.fieldtype=="Link"&&r.options&&r.options!="Currency"?e.push({doctype:r.options,fieldname:r.fieldname}):r.fieldtype=="Dynamic Link"&&r.options&&t.push({link_name:r.options,fieldname:r.fieldname})}),this.data.forEach(r=>{t.forEach(s=>{r[s.link_name]&&i.add(r[s.link_name]+":"+s.fieldname)})}),e=e.concat(Array.from(i).map(r=>{let s=r.split(":");return{doctype:s[0],fieldname:s[1]}})),e.forEach(r=>{this.doctype_field_map[r.doctype]=r.fieldname}),e}setup_report_wrapper(){if(this.$report)return;$(".page-head-content").removeClass("border-bottom");let e=this.page.main.find(".page-form");this.$status=$('<div class="form-message text-muted small"></div>').hide().insertAfter(e),this.$summary=$('<div class="report-summary"></div>').hide().appendTo(this.page.main),this.$chart=$('<div class="chart-wrapper">').hide().appendTo(this.page.main),this.$loading=$(this.message_div("")).hide().appendTo(this.page.main),this.$report=$('<div class="report-wrapper">').appendTo(this.page.main),this.$message=$(this.message_div("")).hide().appendTo(this.page.main)}show_status(e){this.$status.html(e).show()}hide_status(){this.$status.hide()}show_footer_message(){this.$report_footer&&this.$report_footer.remove(),this.$report_footer=$('<div class="report-footer text-muted"></div>').appendTo(this.page.main),this.tree_report&&(this.$tree_footer=$(`<div class="tree-footer col-md-6">
				<button class="btn btn-xs btn-default" data-action="expand_all_rows">
					${__("Expand All")}</button>
				<button class="btn btn-xs btn-default" data-action="collapse_all_rows">
					${__("Collapse All")}</button>
			</div>`),$(this.$report_footer).append(this.$tree_footer),this.$tree_footer.find("[data-action=collapse_all_rows]").show(),this.$tree_footer.find("[data-action=expand_all_rows]").hide());let e=__("For comparison, use >5, <10 or =324. For ranges, use 5:10 (for values between 5 & 10)."),t=__("Execution Time: {0} sec",[this.execution_time||.1]);this.$report_footer.append(`<div class="col-md-12">
			<span">${e}</span><span class="pull-right">${t}</span>
		</div>`)}expand_all_rows(){this.$tree_footer.find("[data-action=expand_all_rows]").hide(),this.datatable.rowmanager.expandAllNodes(),this.$tree_footer.find("[data-action=collapse_all_rows]").show()}collapse_all_rows(){this.$tree_footer.find("[data-action=collapse_all_rows]").hide(),this.datatable.rowmanager.collapseAllNodes(),this.$tree_footer.find("[data-action=expand_all_rows]").show()}message_div(e){return`<div class='flex justify-center align-center text-muted' style='height: 50vh;'>
			<div>${e}</div>
		</div>`}reset_report_view(){this.hide_status(),this.toggle_nothing_to_show(!0),this.refresh()}toggle_nothing_to_show(e){let t=this.prepared_report?__("This is a background report. Please set the appropriate filters and then generate a new one."):this.get_no_result_message();this.toggle_message(e,t),e&&this.prepared_report&&(this.prepared_report_action="New",this.primary_button.is(":visible")||this.add_prepared_report_buttons())}toggle_message(e,t){e?(this.$message.find("div").html(t),this.$message.show()):this.$message.hide()}toggle_filter_display(e,t){this.$page.find(`div[data-fieldname=${e}]`).toggleClass("hide-control",t)}toggle_report(e){this.$report.toggle(e),this.$chart.toggle(e),this.$summary.toggle(e)}get_checked_items(e){return this.datatable.rowmanager.getCheckedRows().reduce((i,r)=>{if(r===void 0)return i;let s=this.data[r];return i.push(e?s.name:s),i},[])}get get_values(){return this.get_filter_values}};Object.defineProperty(frappe,"query_report_filters_by_name",{get(){return console.warn("[Query Report] frappe.query_report_filters_by_name is deprecated. Please use the new api: frappe.query_report.get_filter_value(fieldname) and frappe.query_report.set_filter_value(fieldname, value)"),null}});frappe.templates.print_grid=`<!-- title -->
{% if title %}
<h2>{{ __(title) }}</h2>
<hr>
{% endif %}
{% if subtitle %}
{{ subtitle }}
<hr>
{% endif %}
<table class="table table-bordered">
	<!-- heading -->
	<thead>
		<tr>
		<th> # </th>
		{% for col in columns %}
			{% if col.name && col._id !== "_check" %}
			<th
				{% if col.minWidth %}
					style="min-width: {{ col.minWidth }}px"
				{% endif %}
				{% if col.docfield && frappe.model.is_numeric_field(col.docfield) %}
					class="text-right"
				{% endif %}
			>
				{{ __(col.name) }}</th>
			{% endif %}
		{% endfor %}
		</tr>
	</thead>
	<!-- body -->
	<tbody>
		{% for row in data %}
			<tr style="height: 30px">
			<td {% if row.bold == 1 %} style="font-weight: bold" {% endif %}>
				<span> {{ row._index + 1 }} </span>
			</td>
			{% for col in columns %}
				{% if col.name && col._id !== "_check" %}

					{% var value = col.fieldname ? row[col.fieldname] : row[col.id]; %}

					<td {% if row.bold == 1 %} style="font-weight: bold" {% endif %}>
						<span {% if col._index == 0 %} style="padding-left: {%= cint(row.indent) * 2 %}em" {% endif %}>
							{% format_data = row.is_total_row && ["Currency", "Float"].includes(col.fieldtype) ? data[0] : row %}
							{% if (row.is_total_row && col._index == 0) { %}
								{{ __("Total") }}
							{% } else { %}
								{{
									col.formatter
										? col.formatter(row._index, col._index, value, col, format_data, true)
										: col.format
											? col.format(value, row, col, format_data)
											: col.docfield
												? frappe.format(value, col.docfield)
												: value
								}}
							{% } %}
						</span>
					</td>
				{% endif %}
			{% endfor %}
			</tr>
		{% endfor %}
	</tbody>
</table>
`;frappe.templates.print_tree=`<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="">
		<title>{{ title }}</title>
		<link href="{{ base_url }}/assets/frappe/css/bootstrap.css" rel="stylesheet">
		<link type="text/css" rel="stylesheet"
			href="{{ base_url }}/assets/frappe/css/font-awesome.css">
		<link rel="stylesheet" type="text/css" href="{{ base_url }}/assets/frappe/css/tree.css">
		<link rel="stylesheet" type="text/css" href="{{ base_url }}{{ print_format_css_path }}">
		<style>
			{{ print_css }}
		</style>
		<style>
			.tree.opened::before,
			.tree-node.opened::before,
			.tree:last-child::after,
			.tree-node:last-child::after {
				z-index: 1;
				border-left: 1px solid #d1d8dd;
				background: none;
			}
			.tree a,
			.tree-link {
				text-decoration: none;
				cursor: default;
			}
			.tree.opened > .tree-children > .tree-node > .tree-link::before,
			.tree-node.opened > .tree-children > .tree-node > .tree-link::before {
				border-top: 1px solid #d1d8dd;
				z-index: 1;
				background: none;
			}
			i.fa.fa-fw.fa-folder {
				z-index: 2;
				position: relative;
			}
			.tree:last-child::after, .tree-node:last-child::after {
				display: none;
			}
			.tree-node-toolbar {
				display: none;
			}
			i.octicon.octicon-primitive-dot.text-extra-muted {
				width: 7px;
				height: 7px;
				border-radius: 50%;
				background: #d1d8dd;
				display: inline-block;
				position: relative;
				z-index: 2;
			}

			@media (max-width: 767px) {
				ul.tree-children {
					padding-left: 20px;
				}
			}
		</style>
  	</head>
	<body>
		<svg id="frappe-symbols" aria-hidden="true" style="position: absolute; width: 0; height: 0; overflow: hidden;" class="d-block" xmlns="http://www.w3.org/2000/svg">
			<symbol viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg" id="icon-primitive-dot">
				<path d="M9.5 6a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z"></path>
			</symbol>

			<symbol viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="icon-folder-open">
				<path d="M8.024 6.5H3a.5.5 0 0 0-.5.5v8a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V9.5A.5.5 0 0 0 17 9h-6.783a.5.5 0 0 1-.417-.224L8.441 6.724a.5.5 0 0 0-.417-.224z" stroke="var(--icon-stroke)" stroke-miterlimit="10" stroke-linecap="square"></path>
				<path d="M3.88 4.5v-1a.5.5 0 0 1 .5-.5h11.24a.5.5 0 0 1 .5.5V7" stroke="var(--icon-stroke)" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>
			</symbol>

			<symbol viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" id="icon-folder-normal">
				<path d="M2.5 4v10a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V6.5a1 1 0 0 0-1-1h-6.283a.5.5 0 0 1-.417-.224L8.441 3.224A.5.5 0 0 0 8.024 3H3.5a1 1 0 0 0-1 1z" stroke="var(--icon-stroke)" stroke-miterlimit="10" stroke-linecap="square"></path>
			</symbol>
		</svg>
		<div class="print-format-gutter">
			{% if print_settings.repeat_header_footer %}
				<div id="footer-html" class="visible-pdf">
					{% if print_settings.letter_head && print_settings.letter_head.footer %}
						<div class="letter-head-footer">
							{{ print_settings.letter_head.footer }}
						</div>
					{% endif %}
					<p class="text-center small page-number visible-pdf">
						{{ __("Page {0} of {1}", [\`<span class="page"></span>\`, \`<span class="topage"></span>\`]) }}
					</p>
				</div>
			{% endif %}

			<div class="print-format {% if landscape %} landscape {% endif %}">
				{% if print_settings.letter_head %}
				<div {% if print_settings.repeat_header_footer %} id="header-html" class="hidden-pdf" {% endif %}>
					<div class="letter-head">{{ print_settings.letter_head.header }}</div>
				</div>
					{% endif %}
					<div class="tree opened">
						{{ tree }}
					</div>
			</div>
		</div>
	</body>
</html>
`;frappe.templates.group_by=`<div class="group-by-box">
	<div class="visible-xs flex justify-flex-end">
		<span class="remove-group-by">
			{{ __("Remove") }}
		</span>
	</div>
	<div class="list_groupby row">
		<div class="col-sm-8 form-group">
			<select class="group-by form-control input-xs">
				<option value="" disabled selected>{{ __("Select Group By...") }}</option>
				{% for (var parent_doctype in group_by_conditions) { %}
					{% for (var val in group_by_conditions[parent_doctype]) { %}
						{% if (parent_doctype !== doctype) { %}
						<option
							data-doctype="{{parent_doctype}}"
							value="{{group_by_conditions[parent_doctype][val].fieldname}}"
						>
							{{ __(group_by_conditions[parent_doctype][val].label) }}
							({{ __(parent_doctype) }})
						</option>
						{% } else { %}
						<option
							data-doctype="{{parent_doctype}}"
							value="{{group_by_conditions[parent_doctype][val].fieldname}}"
						>
							{{ __(group_by_conditions[parent_doctype][val].label) }}
						</option>
						{% } %}
					{% } %}
				{% } %}
			</select>
		</div>
		<div class="col-sm-3 form-group">
			<select class="aggregate-function form-control input-xs">
				{% for condition in aggregate_function_conditions %}
				<option value="{{condition.name}}">{{ __(condition.label) }}</option>
				{% endfor %}
			</select>
		</div>
		<div class="col-sm-4 col-xs-12" style="display: none">
			<select class="aggregate-on form-control input-xs">
				<option value="" disabled selected>{{ __("Select Field...") }}</option>
			</select>
		</div>
		<div class="groupby-actions pull-left col-sm-1 hidden-xs">
			<span class="remove-group-by">
				<svg class="icon icon-sm">
					<use xlink:href="#icon-close"></use>
				</svg>
			</span>
		</div>
	</div>
</div>
`;frappe.provide("frappe.views");frappe.ui.GroupBy=class{constructor(o){this.report_view=o,this.page=o.page,this.doctype=o.doctype,this.make()}make(){this.make_group_by_button(),this.init_group_by_popover(),this.set_popover_events()}init_group_by_popover(){let o=[{name:"count",label:__("Count")},{name:"sum",label:__("Sum")},{name:"avg",label:__("Average")}],e=$(frappe.render_template("group_by",{doctype:this.doctype,group_by_conditions:this.get_group_by_fields(),aggregate_function_conditions:o}));this.group_by_button.popover({content:e,template:`
				<div class="group-by-popover popover">
					<div class="arrow"></div>
					<div class="popover-body popover-content">
					</div>
				</div>
			`,html:!0,trigger:"manual",container:"body",placement:"bottom",offset:"-100px 0"})}set_popover_events(){$(document.body).on("click",o=>{this.wrapper&&this.wrapper.is(":visible")&&$(o.target).parents(".group-by-popover").length===0&&$(o.target).parents(".group-by-box").length===0&&$(o.target).parents(".group-by-button").length===0&&!$(o.target).is(this.group_by_button)&&this.wrapper&&this.group_by_button.popover("hide")}),this.group_by_button.on("click",()=>{this.group_by_button.popover("toggle")}),this.group_by_button.on("shown.bs.popover",()=>{this.wrapper||(this.wrapper=$(".group-by-popover"),this.setup_group_by_area())}),this.group_by_button.on("hidden.bs.popover",()=>{this.update_group_by_button()}),frappe.router.on("change",()=>{this.group_by_button.popover("hide")})}setup_group_by_area(){this.aggregate_on_html="",this.group_by_select=this.wrapper.find("select.group-by"),this.group_by_field&&this.group_by_select.val(this.group_by_field),this.aggregate_function_select=this.wrapper.find("select.aggregate-function"),this.aggregate_on_select=this.wrapper.find("select.aggregate-on"),this.remove_group_by_button=this.wrapper.find(".remove-group-by"),this.aggregate_function?this.aggregate_function_select.val(this.aggregate_function):(this.aggregate_function_select.val("count"),this.aggregate_function="count"),this.toggle_aggregate_on_field(),this.aggregate_on&&this.aggregate_on_select.val(this.aggregate_on_field),this.set_group_by_events()}set_group_by_events(){this.group_by_select.on("change",()=>{this.group_by_field=this.group_by_select.val(),this.group_by_doctype=this.group_by_select.find(":selected").attr("data-doctype"),this.apply_group_by_and_refresh()}),this.aggregate_function_select.on("change",()=>{this.toggle_aggregate_on_field(),this.aggregate_function=this.aggregate_function_select.val(),this.apply_group_by_and_refresh()}),this.aggregate_on_select.on("change",()=>{this.aggregate_on_field=this.aggregate_on_select.val(),this.aggregate_on_doctype=this.aggregate_on_select.find(":selected").attr("data-doctype"),this.apply_group_by_and_refresh()}),this.remove_group_by_button.on("click",()=>{this.group_by&&(this.remove_group_by(),this.toggle_aggregate_on_field_display(!1))})}toggle_aggregate_on_field(){let o=this.aggregate_function_select.val();if(o==="sum"||o==="avg"){if(!this.aggregate_on_html.length){this.aggregate_on_html=`<option value="" disabled selected>
						${__("Select Field...")}
					</option>`;for(let e in this.all_fields)this.all_fields[e].forEach(i=>{if(frappe.model.is_numeric_field(i.fieldtype)){let r=e==this.doctype?i.label:`${i.label} (${__(e)})`;this.aggregate_on_html+=`<option data-doctype="${e}"
								value="${i.fieldname}">${__(r)}</option>`}})}this.aggregate_on_select.html(this.aggregate_on_html),this.toggle_aggregate_on_field_display(!0)}else this.toggle_aggregate_on_field_display(!1)}toggle_aggregate_on_field_display(o){this.group_by_select.parent().toggleClass("col-sm-5",o),this.group_by_select.parent().toggleClass("col-sm-8",!o),this.aggregate_function_select.parent().toggleClass("col-sm-2",o),this.aggregate_function_select.parent().toggleClass("col-sm-3",!o),this.aggregate_on_select.parent().toggle(o)}get_settings(){return this.group_by?{group_by:this.group_by,aggregate_function:this.aggregate_function,aggregate_on:this.aggregate_on}:null}apply_settings(o){let e=i=>i.split(".")[1].replace(/`/g,""),t=i=>i.split(".")[0].replace(/`/g,"").replace("tab","");if(o.group_by.startsWith("`tab")||(o.group_by="`tab"+this.doctype+"`.`"+o.group_by+"`"),o.aggregate_on&&!o.aggregate_on.startsWith("`tab")){let i=this.get_aggregate_on_doctype(o);o.aggregate_on="`tab"+i+"`.`"+o.aggregate_on+"`"}this.group_by_field=e(o.group_by),this.group_by_doctype=t(o.group_by),this.aggregate_function=o.aggregate_function,o.aggregate_on&&(this.aggregate_on_field=e(o.aggregate_on),this.aggregate_on_doctype=t(o.aggregate_on)),this.apply_group_by(),this.update_group_by_button()}get_aggregate_on_doctype(o){for(let e of Object.keys(this.all_fields))if(this.all_fields[e].find(i=>i.fieldname==o.aggregate_on))return e}make_group_by_button(){this.page.wrapper.find(".sort-selector").before($(`<div class="group-by-selector">
				<button class="btn btn-default btn-sm group-by-button ellipsis">
					<span class="group-by-icon">
						${frappe.utils.icon("group-by")}
					</span>
					<span class="button-label hidden-xs">
						${__("Add Group")}
					</span>
				</button>
			</div>`)),this.group_by_button=this.page.wrapper.find(".group-by-button")}apply_group_by(){return this.group_by="`tab"+this.group_by_doctype+"`.`"+this.group_by_field+"`",this.aggregate_function==="count"?(this.aggregate_on_field=null,this.aggregate_on_doctype=null):this.aggregate_on="`tab"+this.aggregate_on_doctype+"`.`"+this.aggregate_on_field+"`",!(!this.group_by||!this.aggregate_function||!this.aggregate_on_field&&this.aggregate_function!=="count")}apply_group_by_and_refresh(){this.apply_group_by()&&this.report_view.refresh()}set_args(o){this.aggregate_function&&this.group_by&&(this.report_view.group_by=this.group_by,this.report_view.sort_by="_aggregate_column",this.report_view.sort_order="desc",this.report_view.fields.map(e=>e[0]).includes("_aggregate_column")||(this.original_fields=this.report_view.fields.map(e=>e)),this.report_view.fields=[[this.group_by_field,this.group_by_doctype]],o.fields=this.report_view.get_fields(),this.report_view.fields.push(["_aggregate_column",this.aggregate_on_doctype||this.doctype]),this.report_view.setup_columns(),Object.assign(o,{with_comment_count:!1,aggregate_on_field:this.aggregate_on_field||"name",aggregate_on_doctype:this.aggregate_on_doctype||this.doctype,aggregate_function:this.aggregate_function||"count",group_by:this.report_view.group_by||null,order_by:"_aggregate_column desc"}))}get_group_by_docfield(){let o={};return this.aggregate_function==="count"?o={fieldtype:"Int",label:__("Count"),parent:this.doctype,width:200}:(o=Object.assign({},frappe.meta.docfield_map[this.aggregate_on_doctype][this.aggregate_on_field]),this.aggregate_function==="sum"?o.label=__("Sum of {0}",[o.label]):o.label=__("Average of {0}",[o.label])),o.fieldname="_aggregate_column",o}remove_group_by(){this.order_by="",this.group_by=null,this.group_by_field=null,this.report_view.group_by=null,this.aggregate_function="count",this.aggregate_on=null,this.aggregate_on_field=null,this.group_by_select.val(""),this.aggregate_function_select.val("count"),this.aggregate_on_select.empty().val(""),this.aggregate_on_select.parent().hide(),this.original_fields?this.report_view.fields=this.original_fields:this.report_view.set_default_fields(),this.report_view.setup_columns(),this.original_fields=null,this.report_view.refresh()}get_group_by_fields(){this.group_by_fields={},this.all_fields={};let o=this.report_view.meta.fields.filter(r=>["Select","Link","Data","Int","Check"].includes(r.fieldtype)),e={fieldname:"_user_tags",fieldtype:"Data",label:__("Tags")};this.group_by_fields[this.doctype]=o.concat(e),this.all_fields[this.doctype]=this.report_view.meta.fields;let t=r=>!in_list(frappe.model.no_value_type,r.fieldtype)&&!r.report_hide;return frappe.meta.get_table_fields(this.doctype).filter(r=>!r.hidden).forEach(r=>{let s=r.options,a=frappe.meta.get_docfields(s).filter(t);this.group_by_fields[s]=a,this.all_fields[s]=a}),this.group_by_fields}update_group_by_button(){let o=Boolean(this.group_by_field),e=o?__("Group By {0}",[this.get_group_by_field_label()]):__("Add Group");this.group_by_button.toggleClass("btn-default",!o).toggleClass("btn-primary-light",o),this.group_by_button.find(".group-by-icon").toggleClass("active",o),this.group_by_button.find(".button-label").html(e),this.group_by_button.attr("title",e)}get_group_by_field_label(){return this.group_by_fields[this.group_by_doctype].find(o=>o.fieldname==this.group_by_field).label}};frappe.provide("frappe.report_utils");frappe.report_utils={make_chart_options:function(o,e,{y_fields:t,x_field:i,chart_type:r,colors:s,height:a}){let l=r.toLowerCase(),d=e.result.filter(b=>Object.keys(b).length),p=f(i),m=t.map(b=>({name:frappe.model.unscrub(b),values:f(b).map(y=>Number(y))}));return e.add_total_row&&(p=p.slice(0,-1),m.forEach(b=>{b.values=b.values.slice(0,-1)})),{data:{labels:p.length?p:null,datasets:m},truncateLegends:1,type:l,height:a||280,colors:s,axisOptions:{shortenYAxisNumbers:1,xAxisMode:"tick"}};function f(b){if(Array.isArray(d[0])){let y=o.findIndex(v=>v.fieldname==b);return d.map(v=>v[y])}else return d.map(y=>y[b])}},get_field_options_from_report:function(o,e){let t=e.result.filter(m=>Object.keys(m).length),r=(Array.isArray(t[0])?t[0]:o.map(m=>t[0][m.fieldname])).reduce((m,f,b)=>(Number.isFinite(f)&&m.push(b),m),[]);function s(m){return m.map(f=>f.fieldname?{label:f.label,value:f.fieldname}:(f=frappe.report_utils.prepare_field_from_column(f),{label:f.label,value:f.fieldname}))}let a=o.filter((m,f)=>r.includes(f)),l=o.filter((m,f)=>!r.includes(f)),d=s(a),p=s(l);return{numeric_fields:d,non_numeric_fields:p}},prepare_field_from_column:function(o){if(typeof o=="string")if(o.includes(":")){let[e,t,i]=o.split(":"),r;t.includes("/")&&([t,r]=t.split("/")),o={label:e,fieldname:e,fieldtype:t,width:i,options:r}}else o={label:o,fieldname:o,fieldtype:"Data"};return o},get_report_filters:function(o){if(frappe.query_reports[o]){let e=frappe.query_reports[o].filters;return Promise.resolve(e)}return frappe.xcall("frappe.desk.query_report.get_script",{report_name:o}).then(e=>(frappe.dom.eval(e.script||""),frappe.after_ajax(()=>frappe.query_reports[o]&&frappe.query_reports[o].filters)))},get_filter_values(o){return o.map(t=>{var i=t.default;return{[t.fieldname]:i}}).reduce((t,i)=>(Object.assign(t,i),t),{})},get_result_of_fn(o,e){return{Minimum:i=>i.reduce((r,s)=>Math.min(r,s),i[0]),Maximum:i=>i.reduce((r,s)=>Math.max(r,s),i[0]),Average:i=>i.reduce((r,s)=>r+s,0)/i.length,Sum:i=>i.reduce((r,s)=>r+s,0)}[o](e)}};})();
/*! Clusterize.js - v0.17.6 - 2017-03-05
* http://NeXTs.github.com/Clusterize.js/
* Copyright (c) 2015 Denis Lukov; Licensed GPLv3 */
/**!
 * Sortable
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */
//# sourceMappingURL=report.bundle.O5KTMW3A.js.map
